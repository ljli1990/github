<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>7.4.&#160;дз╨к╤╗й╠фВ-LinuxиХ╠╦гЩ╤╞╣зхЩ╟Фё╗жпнд╟Фё╘- - </title>
<meta name="description" content="гЩ╤╞©╙╥╒- - " />
<meta name="keywords" content="LinuxиХ╠╦гЩ╤╞,жпнд╟Ф,╣зхЩ╟Ф,ldd,linux device driver,гЩ╤╞©╙╥╒,╣Гвс╟Ф,ЁлпРиХ╪ф,хМ╪Ч©╙╥╒, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux иХ╠╦гЩ╤╞ Edition 3">
<link rel="up" href="ch07.html" title="╣з&#160;7&#160;уб&#160;й╠╪Д, ясй╠, ╨мяс╨С╧╓вВ">
<link rel="prev" href="ch07s03.html" title="7.3.&#160;яс╨Сж╢пп">
<link rel="next" href="ch07s05.html" title="7.5.&#160;Tasklets ╩Зжф">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">7.4.&#160;дз╨к╤╗й╠фВ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch07s03.html">иор╩рЁ</a>&#160;</td>
<th width="60%" align="center">╣з&#160;7&#160;уб&#160;й╠╪Д, ясй╠, ╨мяс╨С╧╓вВ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch07s05.html">обр╩рЁ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="KernelTimers.sect"></a>7.4.&#160;дз╨к╤╗й╠фВ</h2></div></div></div>
<p>нчбш╨нй╠дЦпХр╙╣В╤хр╩╦Ж╤╞вВрт╨С╥╒иЗ, ╤Ь╡╩вХхШ╣╠г╟╫ЬЁлж╠╣╫╣╫й╠, дз╨к╤╗й╠фВйг╦ЬдЦ╣д╧╓╬ъ. уБп╘╤╗й╠фВсцю╢╣В╤хр╩╦Ж╨╞йЩтз╫╚ю╢р╩╦Жль╤╗╣дй╠╪Дж╢пп, ╩Ысзй╠жсЮжъу, ╡╒гр©исцвВ╦ВюЮхннЯ; юЩхГ, ╣╠с╡╪Чнч╥╗╥╒ЁЖжп╤ой╠, ╡Ия╞р╩╦ЖиХ╠╦м╗╧Щтз╤╗фз╣д╪Д╦Тдз╪Л╡ИкЭ╣дв╢л╛. фДкШ╣ддз╨к╤╗й╠фВ╣д╣Дпмс╕сцйг╧ь╠ухМгЩбМ╢О╩Руъ╫АйЬаМр╩╦ЖЁ╓фзжуж╧╣д╡ывВ. тзуБжжгИ©Жоб, яс╨Сю╢вт close ╣д╥╣╩ь╫╚г©╪ср╩╦Ж╡╩╠ьр╙(╡╒гроехк╣д)©╙оЗтзс╕сцЁлпРио. вН╨С, дз╨квтиМй╧сц╤╗й╠фВтз╪╦╦ЖгИ©Жоб, ╟Эю╗й╣ож schedule_timeout.</p>
<p>р╩╦Ждз╨к╤╗й╠фВйгр╩╦ЖйЩ╬щ╫А╧╧, кЭж╦╣╪дз╨кж╢ппр╩╦Жсц╩╖╤╗рЕ╣д╨╞йЩй╧сцр╩╦Жсц╩╖╤╗рЕ╣д╡нйЩтзр╩╦Жсц╩╖╤╗рЕ╣дй╠╪Д. уБ╦Жй╣ожн╩сз &lt;linux/timer.h&gt; ╨м kernel/timer.c ╡╒гртз"дз╨к╤╗й╠фВ"р╩╫зжпоЙо╦╫Ииэ.</p>
<p>╠╩╣В╤хткпп╣д╨╞йЩ╪╦╨Ух╥╤╗╡╩╩Атзв╒╡АкЭцг╣д╫ЬЁлтзткппй╠ткпп. кЭцгйг, оЮ╥╢, рЛ╡╫ткпп. ж╠╣╫ожтз, нрцгтзнрцг╣дюЩвсгЩ╤╞жпря╬╜вЖ╣дхн╨нйбгИря╬╜тзж╢ппо╣мЁ╣Всц╣д╫ЬЁлиообнджпткпп. ╣╠р╩╦Ж╤╗й╠фВткппй╠, ╣╚йг, уБ╦Ж╣В╤х╫ЬЁл©идэк╞цъ, ©идэтз╡╩м╛╣др╩╦Ж╢╕юМфВиоткпп, ╩Руъ╨э©идэря╬╜р╩фПмкЁЖ.</p>
<p>уБ╦ЖрЛ╡╫ж╢ппюЮкф╣╠╥╒иЗр╩╦Жс╡╪Чжп╤ой╠кЫ╥╒иЗ╣д( уБтз╣з 10 убоЙо╦лжбш ). й╣╪йио, дз╨к╤╗й╠фВ╠╩вВн╙р╩╦Ж"хМ╪Чжп╤о"╣д╫А╧Ш╤Ьй╣ож. ╣╠тзуБжжт╜всиообндткппй╠, дЦ╣д╢ЗбКрвйэ╣╫╤Ю╦Жочжф. ╤╗й╠фВ╨╞йЩ╠ьпКйгт╜вс╣дрткЫсп╣днрцгтз╣з 1 уб"втпЩкЬ╨мт╜всиообнд"р╩╫зжптЬлжбш╧Щ╣д╥╫й╫, ╣╚йгсп╪╦╦Ж╦╫╪с╣днйлБсисзх╠иыр╩╦Ж╫ЬЁлиообнд╤ЬрЩфП╣д. нрцг╫╚╫ИиэуБп╘очжф; тз╨СпЬуб╫з╣д╪╦╦Ж╣ь╥╫╫╚ты╢н©╢╣╫кЭцг. я╜╩╥╠╩╣ВсцрРн╙т╜всиообнд╣д╧ФтР╠ьпКхоуФвЯйь, ╥ЯтРо╣мЁ╩А╥╒ожвт╪╨ощхК╢СбИ╥Ёжп.</p>
<p>н╙дэ╧╩╠╩ж╢пп, ╤Ю╦Ж╤╞вВпХр╙╫ЬЁлиообнд. ╣╠дЦтз╫ЬЁлиообндж╝мБ(╪╢, тзжп╤оиообнд), дЦ╠ьпКвЯйьобап╧ФтР:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>ц╩сптйпМ╢Фх║сц╩╖©у╪Д. рРн╙ц╩сп╫ЬЁлиообнд, ц╩сп╨мхн╨нль╤╗╫ЬЁлоЮ╧ьа╙╣д╣╫сц╩╖©у╪Д╣дм╬╬╤.</p></li>
<li><p>уБ╦Ж current ж╦уКтзт╜всл╛ц╩спрБрЕ, ╡╒гр╡╩дэй╧сцрРн╙оЮ╧ь╣д╢ЗбКц╩сп╨мря╠╩жп╤о╣д╫ЬЁл╣да╙о╣.</p></li>
<li><p>╡╩дэ╫Ьппк╞цъ╩Руъ╣В╤х. т╜вс╢ЗбК╡╩дэ╣Всц schedule ╩РуъдЁжж wait_event, р╡╡╩дэ╣Всцхн╨нфДкШ©идэк╞цъ╣д╨╞йЩ. юЩхГ, ╣Всц kmalloc(..., GFP_KERNEL) йгн╔╥╦╧ФтР╣д. фЛ╠Йр╡╠ьпК╡╩дэй╧сцрРн╙кЭцг©идэк╞цъ.</p></li>
</ul></div>
<p>дз╨к╢ЗбКдэ╧╩╦Фж╙йг╥ЯкЭтзжп╤оиообнджпткпп, м╗╧Щ╣Всц╨╞йЩ in_interrupt(), кЭ╡╩р╙╡нйЩ╡╒грхГ╧Ш╢╕юМфВ╣╠г╟тзжп╤оиообндткпп╬м╥╣╩ь╥гаЦ, р╙ц╢с╡╪Чжп╤ор╙ц╢хМ╪Чжп╤о.</p>
<p>р╩╦Ж╨м in_interrupt() оЮ╧ь╣д╨╞йЩйг in_atomic(). кЭ╣д╥╣╩ьж╣йг╥гаЦнчбш╨нй╠╣В╤х╠╩╫Шж╧; уБ╟Э╨╛с╡╪Ч╨мхМ╪Чжп╤оиообндрт╪╟хн╨нЁжспвтпЩкЬ╣дй╠╨Р. тз╨Ср╩жжгИ©Ж, current ©идэйгспп╖╣д, ╣╚йг╢Фх║сц╩╖©у╪Д╠╩╫Шж╧, рРн╙кЭдэ╣╪жб╣В╤х╥╒иЗ. нчбш╨нй╠дЦй╧сц in_interrupt(), дЦс╕╣╠уФуЩ©╪бгйг╥Я in_atomic йгдЦй╣╪йоКр╙╣д. 2 ╦Ж╨╞йЩ╤╪тз &lt;asm/hardirq.h&gt; жпиЫцВ.</p>
<p>дз╨к╤╗й╠фВ╣даМр╩╦Жжьр╙льптйгр╩╦ЖхннЯ©иртв╒╡АкЭ╠╬иМтз╨СцФй╠╪Джьпбткпп. уБйг©идэ╣д, рРн╙ц©╦Ж timer_list ╫А╧╧тзткппг╟╢с╪╓╩Н╣д╤╗й╠фВа╢╠Мжпх╔а╛╫с, ╡╒гррР╢кдэ╧╩бМиотзфДкШ╣ь╥╫╠╩жьпба╛╫с. ╬║╧э╥╢╦╢жьпб╣В╤хоЮм╛╣дхннЯ©идэ╠Можн╙р╩╦ЖнчрБрЕ╣д╡ывВ, спй╠кЭйгспсц╣д. юЩхГ, кЭ©исцвВй╣ож╤тиХ╠╦╣д╡Ия╞.</p>
<p>р╡ж╣╣цак╫Бтзр╩╦Ж SMP о╣мЁ, ╤╗й╠фВ╨╞йЩ╠╩в╒╡Ай╠оЮм╛╣д CPU ю╢ж╢пп, н╙тзхн╨н©идэ╣дй╠╨Р╩Я╣ц╦Э╨ц╣д╩╨╢Ф╬ж╡©льпт. рР╢к, р╩╦Жжьпбв╒╡АкЭвт╪╨╣д╤╗й╠фВр╩ж╠ткпптзм╛р╩╦Ж CPU.</p>
<p>╡╩с╕╣╠╠╩мЭ╪г╣д╤╗й╠фВ╣др╩╦Жжьр╙льптйг, кЭцгйгр╩╦Жг╠тз╣д╬╨уЫлУ╪Ч╣дт╢, ╪╢╠Цтзр╩╦Ж╣╔╢╕юМфВо╣мЁ. уБйгкЭцгсКфДкШ╢ЗбКрЛ╡╫ткпп╣др╩╦Жж╠╫с╫А╧Ш. рР╢к, хн╨н╠╩╤╗й╠фВ╨╞йЩ╢Фх║╣дйЩ╬щ╫А╧╧с╕╣╠╠ё╩╓╠эцБ╡╒╥╒╢Фх║, р╙ц╢м╗╧Щт╜всюЮпм( тз╣з 1 уб╣д"т╜вс╠Да©"р╩╫з) р╙ц╢й╧сцвтпЩкЬ( тз╣з 9 ублжбш ).</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="TheTimerAPI.sect"></a>7.4.1.&#160;╤╗й╠фВ API</h3></div></div></div>
<p>дз╨клА╧╘╦ЬгЩ╤╞пМ╤Ю╨╞йЩю╢иЫцВ, в╒╡А, рт╪╟х╔ЁЩдз╨к╤╗й╠фВ. обап╣дрЩсцу╧й╬ак╩Ы╠╬╣д╢ЗбК©И:</p>
<pre class="programlisting">
#include &lt;linux/timer.h&gt;
struct timer_list
{
        /* ... */
        unsigned long expires;
        void (*function)(unsigned long);
        unsigned long data;
};
void init_timer(struct timer_list *timer);
struct timer_list TIMER_INITIALIZER(_function, _expires, _data);

void add_timer(struct timer_list * timer);
int del_timer(struct timer_list * timer);
</pre>
<p>уБ╦ЖйЩ╬щ╫А╧╧╟Э╨╛╠хтЬу╧й╬╧Щ╣д╦Э╤Ю╣двж╤н, ╣╚йгуБ 3 ╦Жйг╢РкЦ╢с╤╗й╠фВ╢ЗбКвтиМртмБ╠╩╢Фх║╣д. уБ╦Ж expires вж╤н╠Мй╬╤╗й╠фВфзмШткпп╣д jiffies ж╣; тздг╦Жй╠╪Д, уБ╦Ж function ╨╞йЩ╠╩╣Всцй╧сц data вВн╙р╩╦Ж╡нйЩ. хГ╧ШдЦпХр╙тз╡нйЩжп╢╚╣щ╤ЮоН, дЦ©иртю╕╟СкЭцгвВн╙р╩╦Ж╣╔╦ЖйЩ╬щ╫А╧╧╡╒гр╢╚╣щр╩╦Жв╙╩╩н╙ unsiged long ╣дж╦уК, тзкЫспж╖Ёж╣длЕо╣ио╣др╩╦Ж╟╡х╚вЖ╥╗╡╒гртздз╢Ф╧эюМжпоЮ╣╠фу╠И( хГм╛ 15 убжплжбш╣д ). expires ж╣╡╩йгр╩╦Ж jiffies_64 оНрРн╙╤╗й╠фВ╡╩╠╩фзмШтз╫╚ю╢╨э╬ц╣╫й╠, ╡╒гр 64-н╩╡ывВтз 32-н╩ф╫л╗иобЩ.</p>
<p>уБ╦Ж╫А╧╧╠ьпКтзй╧сцг╟ЁУй╪╩╞. уБ╦Ж╡╫жХ╠ёж╓кЫсп╣дЁит╠╠╩уЩх╥╫╗а╒, ╟Эю╗дгп╘╤т╣Всцуъ╡╩м╦цВ╣д. ЁУй╪╩╞©иртм╗╧Щ╣Всц init_timer ╩Руъ ╟╡ее TIMER_INITIALIZER ╦Ьр╩╦Ж╬╡л╛╫А╧╧, ╦Ы╬щдЦ╣дпХр╙. тзЁУй╪╩╞╨С, дЦ©ирт╦д╠Д 3 ╦Ж╧╚╧╡Ёит╠тз╣Всц add_timer г╟. н╙тз╣╫й╠г╟╫Шж╧р╩╦Жряв╒╡А╣д╤╗й╠фВ, ╣Всц del_timer.</p>
<p>jit дё©И╟Эю╗р╩╦ЖюЩвснд╪Ч, /proc/jitimer ( н╙ "just in timer"), кЭ╥╣╩ьр╩╦Жм╥нд╪Чппрт╪╟ 6 ╦ЖйЩ╬щпп. уБп╘йЩ╬щпп╠Мй╬╣╠г╟╢ЗбКткпп╣д╩╥╬Ё; ╣зр╩╦Жси╤анд╪Ч╡ывВ╡ЗиЗ╡╒грфДкШ╣дси╤╗й╠фВ. обап╣дйДЁЖтз╠ЮрКдз╨кй╠╠╩╪гб╪:</p>
<pre class="screen">
phon% cat /proc/jitimer
 time delta  inirq  pid  cpu command 
 33565837  0  0  1269  0  cat 
 33565847  10  1  1271  0  sh 
 33565857  10  1  1273  0  cpp0 
 33565867  10  1  1273  0  cpp0 
 33565877  10  1  1274  0  cc1 
 33565887  10  1  1274  0  cc1  
</pre>
<p>тзуБ╦ЖйДЁЖ, time вж╤нйг╢ЗбКткппй╠╣д jiffies ж╣, delta йгвтг╟р╩пп╣д jiffies ╦д╠Дж╣, inirq йгси in_interrupt ╥╣╩ь╣д╡╪╤Шж╣, pid ╨м command ж╦╣дйг╣╠г╟╫ЬЁл, рт╪╟ cpu йгтзй╧сц╣д CPU ╣дйЩд©( тз╣╔╢╕юМфВо╣мЁиор╩ж╠н╙ 0).</p>
<p>хГ╧ШдЦ╤а /proc/jitimer ╣╠о╣мЁнч╦╨тьй╠, дЦ╩А╥╒ож╤╗й╠фВ╣диообндйг╫ЬЁл 0, ©уопхннЯ, кЭ╠╩Ёфн╙"╤т╩╩╫ЬЁл"ж╩р╙сисзюЗй╥т╜рР.</p>
<p>сцю╢╡ЗиЗ /proc/jitimer йЩ╬щ╣д╤╗й╠фВйгх╠й║ц© 10 jiffies ткппр╩╢н, ╣╚йгдЦ©ирттз╪стьдё©Ий╠╦д╠ДуБ╦Жж╣м╗╧ЩиХжц tdelay ( timer delay ) ╡нйЩ.</p>
<p>обцФ╣д╢ЗбКрЩсцу╧й╬ак jit ╧ьсз jitimer ╤╗й╠фВ╣д╡©╥ж. ╣╠р╩╦Ж╫ЬЁлйтм╪╤ах║нрцг╣днд╪Ч, нрцг╫╗а╒уБ╦Ж╤╗й╠фВхГоб:</p>
<pre class="programlisting">
unsigned long j = jiffies;
/* fill the data for our timer function */
data-&gt;prevjiffies = j;

data-&gt;buf = buf2;
data-&gt;loops = JIT_ASYNC_LOOPS;

/* register the timer */
data-&gt;timer.data = (unsigned long)data;
data-&gt;timer.function = jit_timer_fn;
data-&gt;timer.expires = j + tdelay; /* parameter */
add_timer(&amp;data-&gt;timer);

/* wait for the buffer to fill */
wait_event_interruptible(data-&gt;wait, !data-&gt;loops);

The actual timer function looks like this:
void jit_timer_fn(unsigned long arg)
{
        struct jit_data *data = (struct jit_data *)arg;
        unsigned long j = jiffies;
        data-&gt;buf += sprintf(data-&gt;buf, "%9li %3li %i %6i %i %s\n",
                             j, j - data-&gt;prevjiffies, in_interrupt() ? 1 : 0,
                             current-&gt;pid, smp_processor_id(), current-&gt;comm);
        if (--data-&gt;loops) {
                data-&gt;timer.expires += tdelay;
                data-&gt;prevjiffies = j;
                add_timer(&amp;data-&gt;timer);

        } else {
                wake_up_interruptible(&amp;data-&gt;wait);
        }
}
</pre>
<p>╤╗й╠фВ API ╟Эю╗╪╦╦Ж╠хиоцФ╫Ииэ╣ддгп╘╦Э╤Ю╣д╧╕дэ. обцФ╣д╪╞╨ойгмЙуШ╣д╨клА╧╘╣д╨╞йЩап╠М:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>int mod_timer(struct timer_list *timer, unsigned long expires);</span></span></dt>
<dd><p>╦Эпбр╩╦Ж╤╗й╠фВ╣дЁ╛й╠й╠╪Д, й╧сцр╩╦ЖЁ╛й╠╤╗й╠фВ╣др╩╦Жфум╗╣дхннЯ(тыр╩╢н, ╧ьбМ╢ОхМгЩ╤╗й╠фВйгр╩╦Ж╣ДпмюЩвс). mod_timer р╡©и╠╩╣Всцсз╥г╪╓╩Н╤╗й╠фВ, дгюОдЦуЩЁё╣ьй╧сц add_timer.</p></dd>
<dt><span class="term"><span>int del_timer_sync(struct timer_list *timer);</span></span></dt>
<dd><p>хГм╛ del_timer р╩яЫ╧╓вВ, ╣╚йг╩╧╠ёж╓╣╠кЭ╥╣╩ьй╠, ╤╗й╠фВ╨╞йЩ╡╩тзхн╨н CPU иоткпп. del_timer_sync сцю╢╠эцБ╬╨уЫгИ©Жтз SMP о╣мЁио, ╡╒гртз UP дз╨кжп╨м del_timer оЮм╛. уБ╦Ж╨╞йЩс╕╣╠тз╢С╡©╥жгИ©Жоб╠х del_timer ╦Эйвохй╧сц. уБ╦Ж╨╞йЩ©идэк╞цъхГ╧ШкЭ╠╩╢с╥гт╜всиообнд╣Всц, ╣╚йгтзфДкШгИ©Жоб╩Ац╕╣х╢Щ. р╙й╝╥жп║пд╣Всц del_timer_sync ╣╠ЁжспкЬй╠; хГ╧ШуБ╦Ж╤╗й╠фВ╨╞йЩйтм╪╩Я╣цм╛р╩╦ЖкЬ, о╣мЁ╩АкюкЬ. хГ╧Ш╤╗й╠фВ╨╞йЩжьпбв╒╡Авт╪╨, ╣Всцуъ╠ьпКйвохх╥╠ёуБ╦Жжьпбв╒╡А╡╩╩А╥╒иЗ; уБЁёЁём╛иХжцр╩╦Ж" ╧ь╠у "╠Йж╬ю╢й╣ож, уБ╦Ж╠Йж╬╠╩╤╗й╠фВ╨╞йЩ╪Л╡И.</p></dd>
<dt><span class="term"><span>int timer_pending(const struct timer_list * timer);</span></span></dt>
<dd><p>╥╣╩ьуФ╩Р╪ыю╢ж╦й╬йг╥Я╤╗й╠фВ╣╠г╟╠╩╣В╤хю╢ткпп, м╗╧Щ╣Всц╫А╧╧╣дфДжпр╩╦Ж╡╩м╦цВ╣дЁит╠.</p></dd>
</dl></div>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="TheImplementaionofKernelTimers.sect"></a>7.4.2.&#160;дз╨к╤╗й╠фВ╣дй╣ож</h3></div></div></div>
<p>н╙акй╧сцкЭцг, ╬║╧эдЦ╡╩╩АпХр╙ж╙╣юдз╨к╤╗й╠фВхГ╨нй╣ож, уБ╦Жй╣ожйгспх╓╣д, ╡╒грж╣╣ц©╢р╩обкЭцг╣ддз╡©.</p>
<p>╤╗й╠фВ╣дй╣ож╠╩иХ╪фю╢╥Ш╨ообапр╙гС╨м╪ыиХ:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>╤╗й╠фВ╧эюМ╠ьпК╬║©идэ╪Р╩╞.</p></li>
<li><p>иХ╪фс╕╣╠кФве╪╓╩Н╣д╤╗й╠фВйЩд©иоиЩ╤Ь╨э╨ц╣ьййс╕.</p></li>
<li><p>╢С╡©╥ж╤╗й╠фВтз╪╦цК╩РвН╤Ю╪╦╥жжсдз╣╫й╠, ╤Ь╢ЬспЁ╓ясй╠╣д╤╗й╠фВйгоЮ╣╠иы╪Ш.</p></li>
<li><p>р╩╦Ж╤╗й╠фВс╕╣╠тзв╒╡АкЭ╣дм╛р╩╦Ж CPU иоткпп.</p></li>
</ul></div>
<p>сидз╨к©╙╥╒уъоКЁЖ╣д╫Б╬Ж╥╫╥╗йг╩Ысзр╩╦Жц©-CPU йЩ╬щ╫А╧╧. уБ╦Ж timer_list ╫А╧╧╟Эю╗р╩╦Жж╦уКж╦оРуБ╦Ж╣дйЩ╬щ╫А╧╧тзкЭ╣д base Ёит╠. хГ╧Ш base йг NULL, уБ╦Ж╤╗й╠фВц╩сп╠╩╣Всцткпп; ╥ЯтР, уБ╦Жж╦уК╦Фж╙дд╦ЖйЩ╬щ╫А╧╧(╡╒гр, рР╢к, дд╦Ж CPU )ткппкЭ. ц©-CPU йЩ╬щоНтз╣з 8 уб╣д"ц©-CPU╠Да©"р╩╫зжпцХйЖ. </p>
<p>нчбш╨нй╠дз╨к╢ЗбКв╒╡Ар╩╦Ж╤╗й╠фВ( м╗╧Щ add_timer ╩Руъ mod_timer), ╡ывВвНжуси internal_add_timer ╫Ьпп( тзkernel/timer.c), кЭрю╢нлМ╪спб╤╗й╠фВ╣╫р╩╦Жк╚оР╤╗й╠фВа╢╠Мтзр╩╦Ж╧ьа╙╣╫╣╠г╟ CPU ╣д"╡Ц╣Ч╠М" жп.</p>
<p>уБ╦Ж╡Ц╣Ч╠МоСуБяЫ╧╓вВ: хГ╧Ш╤╗й╠фВтзобр╩╦Ж 0 ╣╫ 255 jiffies дз╣╫й╠, кЭ╠╩лМ╪с╣╫в╗╧╘╤лй╠╤╗й╠фВ 256 ап╠Мжп╣др╩╦Жио, й╧сц expires Ёит╠╣двН╣мспп╖н╩. хГ╧ШкЭтз╫╚ю╢╦Э╬цй╠╪Д╣╫й╠( ╣╚йгтз 16,384 jiffies ж╝г╟ ), кЭ╠╩лМ╪с╣╫╩Ысз expires Ёит╠╣д 9 - 14 н╩╣д 64 ╦Жап╠Мжпр╩╦Ж. ╤тсз╦ЭЁ╓╣д╤╗й╠фВ, м╛яЫ╣д╪╪гисцтз 15 - 20 н╩, 21 - 26 н╩, ╨м 27 - 31 н╩. ╢Ьспр╩╦Жж╦оР╫╚ю╢╩╧Ё╓й╠╪Д╣д expires Ёит╠╣д╤╗й╠фВ( р╩п╘ж╩©идэ╥╒иЗтз 64-н╩ ф╫л╗ио╣дйбгИ ) ╠╩й╧сцр╩╦Жясй╠ж╣ 0xffffffff ╫Ьпп╧Чоё╢╕юМ, ╡╒гр╢Ьсптз╧Щх╔╣╫й╠╣д╤╗й╠фВ╠╩╣В╤хю╢тзобр╩╦Жй╠жсЮжъуткпп. (р╩╦Жря╬╜╣╫й╠╣д╤╗й╠фВдёдБспй╠тз╦ъ╦╨тьгИ©Жоб╠╩в╒╡А, ль╠П╣дйгхГ╧ШдЦткппр╩╦Ж©игюу╪дз╨к).</p>
<p>╣╠╢╔╥╒ __run_timers, кЭн╙╣╠г╟╤╗й╠фВЮжъуж╢ппкЫсп╧рфП╣д╤╗й╠фВ. хГ╧Ш jiffies ╣╠г╟йг 256 ╣д╠╤йЩ, уБ╦Ж╨╞йЩ╩╧жьпб╧Чоё╢╕юМр╩╦Жобр╩╪╤╠П╣д╤╗й╠фВап╠М╣╫ 256 ╤лфзап╠М, ©идэ╣ь╡Ц╣Чр╩╦Ж╩Р╤Ю╦Ж╠П╣д╪╤╠П, ╦Ы╬щjiffies ╣дн╩╠Мй╬.</p>
<p>уБ╦Ж╥╫╥╗, кДх╩╣зр╩яш©╢х╔оЮ╣╠╦╢тс, тз╪╦╦Ж╨м╢Са©╤╗й╠фВ╣дй╠╨Р╤╪╧╓вВ╣ц╨э╨ц. сцю╢╧эюМц©╦Ж╪╓╩Н╤╗й╠фВ╣дй╠╪Д╤юа╒сзря╬╜в╒╡А╣д╤╗й╠фВйЩд©╡╒грочжфтз╪╦╦Ж╤тсзкЭ╣д expires Ёит╠╣д╤Ч╫Ьжф╠Мй╬╣дбъ╪╜╡ывВио. ╧ьа╙╣╫уБ╦Жй╣ож╣дн╗р╩╣д©╙оЗйг╦Ь 512 а╢╠Мм╥╣ддз╢Ф( 256 ╤лфза╢╠М╨м 4 вИ 64 ╦ЭЁ╓й╠╪Д╣дап╠М) -- ╪╢ 4 KB ╣дхща©.</p>
<p>╨╞йЩ __run_timers, хГм╛ /proc/jitimer кЫй╬, тзт╜всиообндткпп. ЁЩакнрцгря╬╜цХйЖ╧Щ╣дочжф, уБ╦Ж╢Ью╢р╩╦Жспх╓╣дльпт: ╤╗й╠фВ╦у╨цтз╨ойй╣дй╠╪Д╣╫й╠, иУжадЦц╩спткппр╩╦Ж©игюу╪дз╨к, ╡╒гр CPU тздз╨к©у╪Дц╕. дЦ©ирт╪Ш╣╫╥╒иЗакй╡ц╢╣╠дЦтз╨Сл╗╤а /proc/jitbusy й╠рт╪╟тзг╟л╗ /proc/jitimer. ╬║╧эо╣мЁ©╢ю╢юн╧л╣ь╠╩кЬв║╠╩уБ╦Жц╕╣х╢Що╣мЁ╣Всц, дз╨к╤╗й╠фВууяЫ╧╓вВ╣ь╡╩╢М.</p>
<p></p>╣╚йг, ╪гв║, р╩╦Ждз╨к╤╗й╠фВ╩╧т╤н╢мЙиф, рРн╙кЭйэюшсз jitter ╨м фДкШсис╡╪Чжп╤орЩфП╧жнО, ╩╧спфДкШ╤╗й╠фВ╨мфДкШрЛ╡╫хннЯ. кДх╩р╩╦Ж╧ьа╙╣╫╪Р╣╔йЩвж I/O ╣д╤╗й╠фВ╤тсзр╩╦ЖхГм╛ткппр╩╦Ж╡╫╫ЬбМ╢О╩РуъфДкШр╣сЮ╣ГвсиХ╠╦╣х╪Р╣╔хннЯйгвЦ╧╩╣д, кЭЁёЁёйг╡╩╨оййтз╧╓р╣╩╥╬Ёжп╣диЗ╡Зо╣мЁ. ╤тсзуБяЫ╣дхннЯ, дЦ╫╚вН©идэпХр╙рюю╣р╩╦Жй╣й╠дз╨кю╘у╧.</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch07s03.html">иор╩рЁ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch07.html">иор╩╪╤</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch07s05.html">обр╩рЁ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">7.3.&#160;яс╨Сж╢пп&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">фПй╪рЁ</a></td>
<td width="40%" align="right" valign="top">&#160;7.5.&#160;Tasklets ╩Зжф</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ЪйG█┤═б2BфдОЧРщ■x╨Щ8ЭДюШ╨n*щДюШ╨n*щДюШ╨n*щДюШ╨n*щДюШ╨n*щДюШ╨n*щ ┼░▌Ppхd></script>