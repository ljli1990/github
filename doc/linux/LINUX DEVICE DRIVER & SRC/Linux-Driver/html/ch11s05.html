<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>11.5.&#160;Á´±í-LinuxÉè±¸Çı¶¯µÚÈı°æ£¨ÖĞÎÄ°æ£©- - </title>
<meta name="description" content="Çı¶¯¿ª·¢- - " />
<meta name="keywords" content="LinuxÉè±¸Çı¶¯,ÖĞÎÄ°æ,µÚÈı°æ,ldd,linux device driver,Çı¶¯¿ª·¢,µç×Ó°æ,³ÌĞòÉè¼Æ,Èí¼ş¿ª·¢, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux Éè±¸Çı¶¯ Edition 3">
<link rel="up" href="ch11.html" title="µÚ&#160;11&#160;ÕÂ&#160;ÄÚºËÖĞµÄÊı¾İÀàĞÍ">
<link rel="prev" href="ch11s04.html" title="11.4.&#160;ÆäËûÒÆÖ²ĞÔÎÊÌâ">
<link rel="next" href="ch11s06.html" title="11.6.&#160;¿ìËÙ²Î¿¼">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">11.5.&#160;Á´±í</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch11s04.html">ÉÏÒ»Ò³</a>&#160;</td>
<th width="60%" align="center">µÚ&#160;11&#160;ÕÂ&#160;ÄÚºËÖĞµÄÊı¾İÀàĞÍ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch11s06.html">ÏÂÒ»Ò³</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="LinkedLists.sect"></a>11.5.&#160;Á´±í</h2></div></div></div>
<p>²Ù×÷ÏµÍ³ÄÚºË, ÈçÍ¬ÆäËû³ÌĞò, ³£³£ĞèÒªÎ¬»¤Êı¾İ½á¹¹µÄÁĞ±í. ÓĞÊ±, Linux ÄÚºËÒÑ¾­Í¬Ê±ÓĞ¼¸¸öÁĞ±íÊµÏÖ. Îª¼õÉÙ¸´ÖÆ´úÂëµÄÊıÁ¿, ÄÚºË¿ª·¢ÕßÒÑ¾­´´½¨ÁËÒ»¸ö±ê×¼»·ĞÎµÄ, Ë«Á´±í; ¹ÄÀøĞèÒª²Ù×÷ÁĞ±íµÄÈËÊ¹ÓÃÕâ¸öÉèÊ©.</p>
<p>µ±Ê¹ÓÃÁ´±í½Ó¿ÚÊ±, ÄãÓ¦µ±Ò»Ö±¼Ç×¡ÁĞ±íº¯Êı²»×ö¼ÓËø. Èç¹ûÄãµÄÇı¶¯¿ÉÄÜÊÔÍ¼¶ÔÍ¬Ò»¸öÁĞ±í²¢·¢²Ù×÷, ÄãÓĞÔğÈÎÊµÏÖÒ»¸ö¼ÓËø·½°¸. ¿ÉÑ¡Ïî( ÆÆ»µµÄÁĞ±í½á¹¹, Êı¾İ¶ªÊ§, ÄÚºË±ÀÀ£) ¿Ï¶¨ÊÇÄÑÒÔÕï¶ÏµÄ.</p>
<p>ÎªÊ¹ÓÃÁĞ±í»úÖÆ, ÄãµÄÇı¶¯±ØĞë°üº¬ÎÄ¼ş &lt;linux/list.h&gt;. Õâ¸öÎÄ¼ş¶¨ÒåÁËÒ»¸ö¼òµ¥µÄÀàĞÍ list_head ½á¹¹:</p>
<pre class="programlisting">
struct list_head { struct list_head *next, *prev; }; 
</pre>
<p>ÕæÊµ´úÂëÖĞÊ¹ÓÃµÄÁ´±í¼¸ºõÊÇ²»±äµØÓÉ¼¸¸ö½á¹¹ÀàĞÍ×é³É, Ã¿Ò»¸öÃèÊöÒ»¸öÁ´±íÖĞµÄÈë¿ÚÏî. ÎªÔÚÄãµÄ´úÂëÖĞÊ¹ÓÃ Linux ÁĞ±í, ÄãÖ»ĞèÒªÇ¶ÈëÒ»¸ö list_head ÔÚ¹¹³ÉÕâ¸öÁ´±íµÄ½á¹¹ÀïÃæ. ¼ÙÉè, Èç¹ûÄãµÄÇı¶¯Î¬»¤Ò»¸öÁĞ±í, ËüµÄÉùÃ÷¿ÉÄÜ¿´ÆğÀ´ÏóÕâÑù:</p>
<pre class="programlisting">
struct todo_struct
{
        struct list_head list;
        int priority; /* driver specific */
        /* ... add other driver-specific fields */
};
</pre>
<p>ÁĞ±íµÄÍ·³£³£ÊÇÒ»¸ö¶ÀÁ¢µÄ list_head ½á¹¹. Í¼<a href="ch11s05.html#ldd3-11-1.fig" title="Í¼&#160;11.1.&#160;Á´±íÍ·Êı¾İ½á¹¹">Á´±íÍ·Êı¾İ½á¹¹</a>ÏÔÊ¾ÁËÕâ¸ö¼òµ¥µÄ struct list_head ÊÇÈçºÎÓÃÀ´Î¬»¤Ò»¸öÊı¾İ½á¹¹µÄÁĞ±íµÄ.</p>
<div class="figure">
<a name="ldd3-11-1.fig"></a><p class="title"><b>Í¼&#160;11.1.&#160;Á´±íÍ·Êı¾İ½á¹¹</b></p>
<div><img src="images/snagitldd3/ldd3-11-1.png" alt="Á´±íÍ·Êı¾İ½á¹¹"></div>
</div>
<p>Á´±íÍ·±ØĞëÔÚÊ¹ÓÃÇ°ÓÃ INIT_LIST_HEAD ºêÀ´³õÊ¼»¯. Ò»¸ö"Òª×öµÄÊÂÇé"µÄÁ´±íÍ·¿ÉÄÜÉùÃ÷²¢ÇÒ³õÊ¼»¯ÓÃ:</p>
<pre class="programlisting">
struct list_head todo_list; 
INIT_LIST_HEAD(&amp;todo_list); 
&lt;para&gt;¿ÉÑ¡µØ, Á´±í¿ÉÔÚ±àÒëÊ±³õÊ¼»¯:&lt;/para&gt;
LIST_HEAD(todo_list); 
</pre>
<p>¼¸¸öÊ¹ÓÃÁ´±íµÄº¯Êı¶¨ÒåÔÚ &lt;linux/list.h&gt;:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>list_add(struct list_head *new, struct list_head *head);</span></span></dt>
<dd><p>ÔÚ½ô½Ó×ÅÁ´±í head ºóÃæÔö¼ÓĞÂÈë¿ÚÏî -- Õı³£µØÔÚÁ´±íµÄ¿ªÍ·. Òò´Ë, Ëü¿ÉÓÃÀ´¹¹½¨¶ÑÕ». µ«ÊÇ, ×¢Òâ, head ²»ĞèÒªÊÇÁ´±íÃûÒåÉÏµÄÍ·; Èç¹ûÄã´«µİÒ»¸ö list_head ½á¹¹, ËüÔÚÁ´±íÄ³´¦µÄÖĞ¼ä, ĞÂµÄÏî½ô¿¿ÔÚËüºóÃæ. ÒòÎª Linux Á´±íÊÇ»·ĞÎµÄ, Á´±íµÄÍ·Í¨³£ºÍÈÎºÎÆäËûµÄÏîÃ»ÓĞÇø±ğ.</p></dd>
<dt><span class="term"><span>list_add_tail(struct list_head *new, struct list_head *head);</span></span></dt>
<dd><p>¸ÕºÃÔÚ¸ø¶¨Á´±íÍ·Ç°ÃæÔö¼ÓÒ»¸öĞÂÈë¿ÚÏî -- ÔÚÁ´±íµÄÎ²²¿, »»¾ä»°Ëµ. list_add_tail ÄÜ¹», Òò´Ë, ÓÃÀ´¹¹½¨ÏÈÈëÏÈ³ö¶ÓÁĞ.</p></dd>
<dt><span class="term"><span>list_del(struct list_head *entry);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>list_del_init(struct list_head *entry);</span></span></dt>
<dd><p>¸ø¶¨µÄÏî´Ó¶ÓÁĞÖĞÈ¥³ı. Èç¹ûÈë¿ÚÏî¿ÉÄÜ×¢²áÔÚÁíÍâµÄÁ´±íÖĞ, ÄãÓ¦µ±Ê¹ÓÃ list_del_init, ËüÖØĞÂ³õÊ¼»¯Õâ¸öÁ´±íÖ¸Õë.</p></dd>
<dt><span class="term"><span>list_move(struct list_head *entry, struct list_head *head);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>list_move_tail(struct list_head *entry, struct list_head *head);</span></span></dt>
<dd><p>¸ø¶¨µÄÈë¿ÚÏî´ÓËüµ±Ç°µÄÁ´±íÀïÈ¥³ı²¢ÇÒÔö¼Óµ½ head µÄ¿ªÊ¼. Îª°²·ÅÈë¿ÚÏîÔÚĞÂÁ´±íµÄÄ©Î², Ê¹ÓÃ list_move_tail ´úÌæ.</p></dd>
<dt><span class="term"><span>list_empty(struct list_head *head);</span></span></dt>
<dd><p>Èç¹û¸ø¶¨Á´±íÊÇ¿Õ, ·µ»ØÒ»¸ö·ÇÁãÖµ.</p></dd>
<dt><span class="term"><span>list_splice(struct list_head *list, struct list_head *head);</span></span></dt>
<dd><p>½« list ½ô½ÓÔÚ head Ö®ºóÀ´Á¬½Ó 2 ¸öÁ´±í.</p></dd>
</dl></div>
<p>list_head ½á¹¹¶ÔÓÚÊµÏÖÒ»¸öÏàËÆ½á¹¹µÄÁ´±íÊÇºÃµÄ, µ«ÊÇµ÷ÓÃ³ÌĞò³£³£¸ĞĞËÈ¤¸ü´óµÄ½á¹¹, Ëü×é³ÉÁ´±í×÷ÎªÒ»¸öÕûÌå. Ò»¸öºê¶¨Òå, list_entry, Ó³ÉäÒ»¸ö list_head ½á¹¹Ö¸Õëµ½Ò»¸öÖ¸Ïò°üº¬ËüµÄ½á¹¹µÄÖ¸Õë. ËüÈçÏÂ±»µ÷ÓÃ:</p>
<pre class="programlisting">
list_entry(struct list_head *ptr, type_of_struct, field_name); 
</pre>
<p>ÕâÀï ptr ÊÇÒ»¸öÖ¸ÏòÊ¹ÓÃµÄ struct list_head µÄÖ¸Õë, type_of_struct ÊÇ°üº¬ ptr µÄ½á¹¹µÄÀàĞÍ, field_name ÊÇ½á¹¹ÖĞÁĞ±í³ÉÔ±µÄÃû×Ó. ÔÚÎÒÃÇÖ®Ç°µÄ todo_struct ½á¹¹ÖĞ, Á´±í³ÉÔ±³ÆÎª¼òµ¥ÁĞ±í. Òò´Ë, ÎÒÃÇÓ¦µ±×ª±äÒ»¸öÁĞ±íÈë¿ÚÏîÎªËüµÄ°üº¬½á¹¹, Ê¹ÓÃÕâÑùÒ»ĞĞ:</p>
<pre class="programlisting">
struct todo_struct *todo_ptr = list_entry(listptr, struct todo_struct, list); 
</pre>
<p>list_entry ºê¶¨ÒåÊ¹ÓÃÁËÒ»Ğ©Ï°¹ßµÄ¶«Î÷µ«ÊÇ²»ÄÑÓÃ.</p>
<p>Á´±íµÄ±éÀúÊÇÈİÒ×µÄ: Ö»Òª¸úËæ prev ºÍ next Ö¸Õë. ×÷ÎªÒ»¸öÀı×Ó, ¼ÙÉèÎÒÃÇÏë±£³Ö todo_struct ÏîµÄÁĞ±íÒÑ½µĞòµÄÓÅÏÈ¼¶Ë³ĞòÅÅÁĞ. Ò»¸öº¯ÊıÀ´Ìí¼ÓĞÂÏîÓ¦µ±¿´À´Èç´Ë:</p>
<pre class="programlisting">
void todo_add_entry(struct todo_struct *new)
{
        struct list_head *ptr;
        struct todo_struct *entry;

        for (ptr = todo_list.next; ptr != &amp;todo_list; ptr = ptr-&gt;next)
        {
                entry = list_entry(ptr, struct todo_struct, list);
                if (entry-&gt;priority &lt; new-&gt;priority) {

                        list_add_tail(&amp;new-&gt;list, ptr);
                        return;
                }
        }
        list_add_tail(&amp;new-&gt;list, &amp;todo_struct)

}
</pre>
<p>µ«ÊÇ, ×÷ÎªÒ»¸öÍ¨ÓÃµÄ¹æÔò, ×îºÃÊ¹ÓÃÒ»¸öÔ¤¶¨ÒåµÄºêÀ´´´½¨Ñ­»·, Ëü±éÀúÁ´±í. Ç°Ò»¸öÑ­»·, ÀıÈç, ¿ÉÕâÑù±àÂë:</p>
<pre class="programlisting">
void todo_add_entry(struct todo_struct *new)
{
        struct list_head *ptr;
        struct todo_struct *entry;

        list_for_each(ptr, &amp;todo_list)
        {
                entry = list_entry(ptr, struct todo_struct, list);
                if (entry-&gt;priority &lt; new-&gt;priority) {

                        list_add_tail(&amp;new-&gt;list, ptr);
                        return;
                }
        }
        list_add_tail(&amp;new-&gt;list, &amp;todo_struct)

}
</pre>
<p>Ê¹ÓÃÌá¹©µÄºê°ïÖú±ÜÃâ¼òµ¥µÄ±à³Ì´íÎó; ºêµÄ¿ª·¢ÕßÒ²ÒÑ×öÁËĞ©Å¬Á¦À´±£Ö¤ËüÃÇ½øĞĞÕı³£. ´æÔÚ¼¸¸ö±äÌå:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>list_for_each(struct list_head *cursor, struct list_head *list)</span></span></dt>
<dd><p>Õâ¸öºê´´½¨Ò»¸ö for Ñ­»·, Ö´ĞĞÒ»´Î, cursor Ö¸ÏòÁ´±íÖĞµÄÃ¿¸öÁ¬ĞøµÄÈë¿ÚÏî. Ğ¡ĞÄ¸Ä±äÁĞ±íÔÚ±éÀúËüÊ±.</p></dd>
<dt><span class="term"><span>list_for_each_prev(struct list_head *cursor, struct list_head *list)</span></span></dt>
<dd><p>Õâ¸ö°æ±¾ºóÏò±éÀúÁ´±í.</p></dd>
<dt><span class="term"><span>list_for_each_safe(struct list_head *cursor, struct list_head *next, struct list_head *list)</span></span></dt>
<dd><p>Èç¹ûÄãµÄÑ­»·¿ÉÄÜÉ¾³ıÁĞ±íÖĞµÄÏî, Ê¹ÓÃÕâ¸ö°æ±¾. Ëü¼òµ¥µÄ´æ´¢ÁĞ±í next ÖĞÏÂÒ»¸öÏî, ÔÚÑ­»·µÄ¿ªÊ¼, Òò´ËÈç¹û cursor Ö¸ÏòµÄÈë¿ÚÏî±»É¾³ı, Ëü²»»á±»¸ãÂÒ.</p></dd>
<dt><span class="term"><span>list_for_each_entry(type *cursor, struct list_head *list, member)</span></span></dt>
<dd></dd>
<dt><span class="term"><span>list_for_each_entry_safe(type *cursor, type *next, struct list_head *list, member)</span></span></dt>
<dd><p>ÕâĞ©ºê¶¨Òå¼õÇáÁË¶ÔÒ»¸ö°üº¬¸ø¶¨½á¹¹ÀàĞÍµÄÁĞ±íµÄ´¦Àí. ÕâÀï, cursor ÊÇÒ»¸öÖ¸Ïò°üº¬Êı¾İÀàĞÍµÄÖ¸Õë, member ÊÇ°üº¬½á¹¹ÖĞ list_head ½á¹¹µÄÃû×Ó. ÓĞÁËÕâĞ©ºê, Ã»ÓĞ±ØÒª°²·Å list_entry µ÷ÓÃÔÚÑ­»·ÀïÁË.</p></dd>
</dl></div>
<p>Èç¹ûÄã²é¿´ &lt;linux/list.h&gt; ÀïÃæ, Äã¿´µ½ÓĞÒ»Ğ©¸½¼ÓµÄÉùÃ÷. hlist ÀàĞÍÊÇÒ»¸öÓĞÒ»¸öµ¥¶ÀµÄ, µ¥Ö¸ÕëÁĞ±íÍ·ÀàĞÍµÄË«ÏòÁ´±í; Ëü³£ÓÃ×÷´´½¨¹şÏ£±íºÍÀàĞÍ½á¹¹. »¹ÓĞºêÓÃÀ´±éÀú 2 ÖÖÁĞ±íÀàĞÍ, ´òËã×÷Ê¹ÓÃ ¶ÁÈ¡-¿½±´-¸üĞÂ »úÖÆ(ÔÚµÚ 5 ÕÂµÄ"¶ÁÈ¡-¿½±´-¸üĞÂ"Ò»½ÚÖĞÃèÊö ). ÕâĞ©Ô­ÓïÔÚÉè±¸Çı¶¯ÖĞ²»¿ÉÄÜÓĞÓÃ; ¿´Í·ÎÄ¼şÈç¹ûÄãÔ¸ÒâÖªµÀ¸ü¶àĞÅÏ¢¹ØÓÚËüÃÇÊÇÈçºÎ¹¤×÷µÄ.</p>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch11s04.html">ÉÏÒ»Ò³</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch11.html">ÉÏÒ»¼¶</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch11s06.html">ÏÂÒ»Ò³</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">11.4.&#160;ÆäËûÒÆÖ²ĞÔÎÊÌâ&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ÆğÊ¼Ò³</a></td>
<td width="40%" align="right" valign="top">&#160;11.6.&#160;¿ìËÙ²Î¿¼</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ÿÊG‡ Â2BÆÄïşòİ”xºı8üäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İšŠPpÈd></script>