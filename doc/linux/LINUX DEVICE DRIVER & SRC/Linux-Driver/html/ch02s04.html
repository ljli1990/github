<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>2.4.&#160;╠ЮрК╨м╪сть-LinuxиХ╠╦гЩ╤╞╣зхЩ╟Фё╗жпнд╟Фё╘</title>
<meta name="description" content="гЩ╤╞©╙╥╒" />
<meta name="keywords" content="LinuxиХ╠╦гЩ╤╞,жпнд╟Ф,╣зхЩ╟Ф,ldd,linux device driver,гЩ╤╞©╙╥╒,╣Гвс╟Ф,ЁлпРиХ╪ф,хМ╪Ч©╙╥╒,©╙╥╒ф╣╣ю" />
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux иХ╠╦гЩ╤╞ Edition 3">
<link rel="up" href="ch02.html" title="╣з&#160;2&#160;уб&#160;╫╗а╒╨мткппдё©И">
<link rel="prev" href="ch02s03.html" title="2.3.&#160;дз╨кдё©ИоЮ╠хсзс╕сцЁлпР">
<link rel="next" href="ch02s05.html" title="2.5.&#160;дз╨к╥Ш╨е╠М">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">2.4.&#160;╠ЮрК╨м╪сть</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch02s03.html">иор╩рЁ</a>&#160;</td>
<th width="60%" align="center">╣з&#160;2&#160;уб&#160;╫╗а╒╨мткппдё©И</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch02s05.html">обр╩рЁ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="CompilingandLoading.sect1"></a>2.4.&#160;╠ЮрК╨м╪сть</h2></div></div></div>
<p> ╠╬уб©╙м╥╣д "hello world" юЩвс╟Э╨╛акр╩╦Ж╪Р╤л╣д╫╗а╒╡╒╪стьдё©И╣╫о╣мЁжпх╔╣дящй╬. ╣╠х╩, уШ╦Ж╧ЩЁл╠хнрцгд©г╟©╢╣╫╣д╤Ю. ╠╬╫злА╧╘ак╦Э╤Юо╦╫з╧ьсзр╩╦Ждё©ИвВуъхГ╨н╫╚т╢бКв╙╩╩Ёидз╨кжп╣дткпп╣двсо╣мЁ.  
</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="CompilingModules.sect2"></a>2.4.1.&#160;╠ЮрКдё©И</h3></div></div></div>
<p> ╣зр╩╡╫, нрцгпХр╙©╢р╩обдё©ИхГ╨н╠ьпК╠╩╫╗а╒. дё©И╣д╫╗а╒╧ЩЁлсКсц╩╖©у╪Д╣дс╕сцЁлпР╣д╫╗а╒╧ЩЁлспотжЬ╡╩м╛; дз╨кйгр╩╦Ж╢С╣д, ╤юа╒╣дЁлпР, ╤тсзкЭ╣д╦В╦Ж╡©╥жхГ╨нвИ╨отзр╩фПспоЙо╦╣дцВх╥╣др╙гС. ╫╗а╒╧ЩЁлр╡сКртг╟╟Ф╠╬╣ддз╨к╣д╧ЩЁл╡╩м╛; пб╣д╫╗а╒о╣мЁсцфПю╢╦Э╪Р╣╔╡╒гр╡ЗиЗ╦ЭуЩх╥╣д╫А╧Ш, ╣╚йгкЭ©╢фПю╢сКртг╟╥гЁё╡╩м╛. дз╨к╫╗а╒о╣мЁйгр╩м╥╦╨тП╣др╟йч, нрцг╬м©╢кЭр╩п║╡©╥ж. тздз╨кт╢бК╣д Document/kbuild д©б╪об╥╒ож╣днд╪Ч, хн╨ноКюМ╫Б╠МцФж╝об╣дуФй╣гИ©Ж╣дхк╤╪р╙тд╤ар╩об.  </p>
<p> сп╪╦╦Жг╟лА, дЦ╠ьпКтздэ╫╗а╒дз╨кдё©Иг╟╫Б╬Ж. ╣зр╩╦Жйг╠ёж╓дЦсп╟Ф╠╬вЦ╧╩пб╣д╠ЮрКфВ, дё©И╧╓╬ъ, рт╪╟фДкШ╠ьр╙╧╓╬ъ. тздз╨кнд╣╣д©б╪об╣днд╪Ч Documentation/Changes р╩ж╠апЁЖакпХр╙╣д╧╓╬ъ╟Ф╠╬; дЦс╕╣╠тзоРг╟въж╝г╟╡н©╪р╩обкЭ. йтм╪╫╗а╒р╩╦Ждз╨к(╟Эю╗кЭ╣ддё©И), сц╢МнС╣д╧╓╬ъ╟Ф╠╬, ©идэ╣╪жб╡╩╬║╣дфФ╧ж╣ддялБ. в╒рБ, е╪╤Ш╣ь, ╠ЮрКфВ╣д╟Ф╠╬л╚пб©идэ╩АрЩфП╨мл╚юо╣д╟Ф╠╬рЩфП╣др╩яЫ╣днйлБ. дз╨кт╢бК╤тсз╠ЮрКфВвЖак╨э╢С╣д╪ыиХ, пб╣д╥╒пп╟Ф╠╬спй╠╩Ар╩й╠╣ьфф╩╣╤╚нВ.  </p>
<p> хГ╧ШдЦхтх╩ц╩спр╩╦Ждз╨кйВтзйж╠ъ, ╩Руъ╩╧ц╩спеДжц╨м╫╗а╒дз╨к, ожтзйгй╠╪Дх╔вЖак. ц╩спт╢бКйВтздЦ╣днд╪Чо╣мЁио, дЦнч╥╗н╙ 2.6 дз╨к╫╗а╒©и╪сть╣ддё©И. й╣╪йткппн╙фД╤Ь╫╗а╒╣ддз╨кр╡йгсп╟ОжЗ╣д( ╬║╧э╡╩йг╠ьр╙╣д ).  </p>
<p> р╩╣╘дЦря╫╗а╒фПкЫсп╤╚нВ, ╦ЬдЦ╣ддё©И╢╢╫╗р╩╦Ж makefile ╬мйгж╠╫ьак╣╠╣д. й╣╪йио, ╤тсз╠╬убг╟цФу╧й╬╣д" hello world" юЩвс, ╣╔пп╬м╧╩ак: </p>
<pre class="screen">
obj-m := hello.o 
</pre>
<p> йЛо╓ make , ╣╚йг╤т 2.6 дз╨к╫╗а╒о╣мЁ╡╩йЛо╓╣д╤ауъ, ©идэфФ╧жуБ╦Ж makefile хГ╨н╧╓вВ. ╠о╬╧иоцФ╣дуБр╩пп╡╩йгр╩╦Ж╢╚мЁ╣д makefile ╣дяЫвс. ╢П╟╦, ╣╠х╩, йгдз╨к╫╗а╒о╣мЁ╢╕юМаксЮоб╣д╧╓вВ. иоцФ╣д╟╡ее( кЭюШсцакси GNU make лА╧╘╣дю╘у╧сО╥╗ )╠МцВспр╩╦Ждё©Ир╙╢сд©╠Йнд╪Ч hello.o ╫╗а╒. тз╢сд©╠Йнд╪Ч╫╗а╒╨С╫А╧Шдё©ИцЭцШн╙ hello.ko.  </p>
<p> ╥╢ж╝, хГ╧ШдЦспр╩╦Ждё©ИцШн╙ module.ko, йгю╢вт 2 ╦Жт╢нд╪Ч( ╧цгрЁфж╝н╙, file1.c ╨м file2.c ), уЩх╥╣дйИп╢с╕╣╠йг: </p>
<pre class="screen">
obj-m := module.o
module-objs := file1.o file2.o
</pre>
<p> ╤тсзр╩╦ЖоСиоцФу╧й╬╣др╙╧╓вВ╣д makefile, кЭ╠ьпКтз╦Э╢С╣ддз╨к╫╗а╒о╣мЁ╣диообнд╠╩╣Всц. хГ╧ШдЦ╣ддз╨кт╢бКйЩн╩сз, ╪ыиХ, дЦ╣д ~/kernel-2.6 д©б╪, сцю╢╫╗а╒дЦ╣ддё©И╣д make цЭаН( тз╟Э╨╛дё©Ит╢бК╨м makefile ╣дд©б╪об╪ЭхК )╩Айг: </p>
<pre class="screen">
make -C ~/kernel-2.6 M=`pwd` modules
</pre>
<p> уБ╦ЖцЭаН©╙й╪йг╦д╠ДкЭ╣дд©б╪╣╫сц -C я║оНлА╧╘╣дд©б╪об( ╬мйгк╣, дЦ╣ддз╨кт╢бКд©б╪ ). кЭтздгюО╩А╥╒ождз╨к╣д╤╔╡Ц makefile. уБ╦Ж M= я║оНй╧ makefile тзйтм╪╫╗а╒дё©Ид©╠Йг╟, ╩ь╣╫дЦ╣ддё©Ит╢бКд©б╪. уБ╦Жд©╠Й, рю╢н╣ь, йгж╦тз obj-m ╠Да©жп╥╒ож╣ддё©Иап╠М, тзнрцг╣дюЩвсюОиХЁиак module.o.  </p>
<p> ╪ЭхКг╟цФ╣д make цЭаНр╩╩А╤Ыж╝╨С╬м╩А╦п╬У╥Ё, кЫртдз╨к©╙╥╒уъ╬м©╙╥╒акр╩жж makefile ╥╫й╫, й╧╣циЗ╩Нхщрвп╘╤тсздгп╘тздз╨кйВж╝мБ╫╗а╒дё©И╣дхк. уБ╦ЖгоцейгхГобйИп╢дЦ╣д makefile: </p>
<pre class="screen">
# If KERNELRELEASE is defined, we've been invoked from the
# kernel build system and can use its language.
ifneq ($(KERNELRELEASE),)

 obj-m := hello.o 
# Otherwise we were called directly from the command
# line; invoke the kernel build system.
else

 KERNELDIR ?= /lib/modules/$(shell uname -r)/build
 PWD := $(shell pwd) 
default:
 $(MAKE) -C $(KERNELDIR) M=$(PWD) modules

endif 
</pre>
<p> тыр╩╢н, нрцг©╢╣╫акю╘у╧╣д GNU make сО╥╗тзфПвВсц. уБ╦Ж makefile тзр╩╢н╣Дпм╣д╫╗а╒жпр╙╠╩╤а 2 ╢н. ╣╠╢сцЭаНппжп╣ВсцуБ╦Ж makefile , кЭв╒рБ╣╫ KERNELRELEASE ╠Да©ц╩спиХжц. кЭюШсцуБяЫр╩╦Жйбй╣ю╢╤╗н╩дз╨кт╢бКд©б╪, ╪╢ря╟╡в╟дё©Ид©б╪жп╣д╥Ш╨еа╛╫сж╦╩ьдз╨к╫╗а╒йВ. хГ╧ШдЦй╣╪йиоц╩спткппдЦтзн╙фД╤Ь╫╗а╒╣ддз╨к, дЦ©ирттзцЭаНпплА╧╘р╩╦Ж KERNELDIR= я║оН, иХжц KERNELDIR ╩╥╬Ё╠Да©, ╩Руъжьп╢ makefile жпиХжц KERNELDIR ╣ддгр╩пп. р╩╣╘╥╒ождз╨кт╢бКйВ, makefile ╣Всц default: д©╠Й, ю╢ткпп╣з 2 ╦Ж make цЭаН( тз makefile юО╡нйЩ╩╞Ёи $(MAKE))оСг╟цФцХйЖ╧Щ╣др╩яЫю╢╣Всцдз╨к╫╗а╒о╣мЁ. тз╣з 2 ╢н╤а, makefile иХжц obj-m, ╡╒грдз╨к╣д makefile нд╪ЧмЙЁий╣╪й╣д╫╗а╒дё©И╧╓вВ.  </p>
<p> уБжж╫╗а╒дё©И╣д╩ЗжфдЦ©идэ╦п╬У╠©в╬дё╨Щ. р╩╣╘дЦо╟╧ъаккЭ, ╣╚йг, дЦ╨э©идэ╩АпюимуБжжря╬╜╠Юее╫Ьдз╨к╫╗а╒о╣мЁ╣ддэа╕. в╒рБ, иоцФ╣д╡╩йгр╩╦ЖмЙуШ╣д makefile; р╩╦ЖуФуЩ╣д makefile ╟Э╨╛м╗Ёё╣дд©╠ЙюЮпмю╢гЕЁЩ╡╩р╙╣днд╪Ч, ╟╡в╟дё©И╣х╣х. р╩╦ЖмЙуШ╣дюЩвс©ирт╡н©╪юЩвс╢ЗбКд©б╪╣д makefile.  
</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="LoadingandUnloadingModules.sect2"></a>2.4.2.&#160;╪сть╨мп╤тьдё©И</h3></div></div></div>
<p> дё©И╫╗а╒ж╝╨С, обр╩╡╫йг╪сть╣╫дз╨к. хГнрцгряж╦ЁЖ╣д, insmod н╙дЦмЙЁиуБ╦Ж╧╓вВ. уБ╦ЖЁлпР╪стьдё©И╣д╢ЗбК╤н╨мйЩ╬щ╤н╣╫дз╨к, ╫све, ж╢ппр╩╦ЖюЮкф ld ╣д╨╞йЩ, кЭа╛╫сдё©Ижпхн╨нн╢╫Б╬Ж╣д╥Ш╨еа╛╫с╣╫дз╨к╣д╥Ш╨е╠Мио. ╣╚йг╡╩оСа╛╫сфВ, дз╨к╡╩пч╦ддё©И╣д╢еелнд╪Ч, ╤Ьйгдз╢Фдз╣д©╫╠╢. insmod ╫сйупМ╤ЮцЭаНппя║оН(оЙгИ╪Ш manpage), кЭдэ╧╩╟╡ееж╣╦ЬдЦдё©Ижп╣д╡нйЩ, тза╛╫с╣╫╣╠г╟дз╨кж╝г╟. рР╢к, хГ╧Шр╩╦Ждё©ИуЩх╥иХ╪фак, кЭдэ╧╩тз╪стьй╠еДжц; ╪стьй╠еДжц╠х╠ЮрКй╠еДжц╦Ьаксц╩╖╦Э╤Ю╣даИ╩Нпт, спй╠хтх╩тзсц. ╪стьй╠еДжцтз╠╬уб╨СцФ╣д "дё©И╡нйЩ" р╩╫з╫╡╫Б.  </p>
<p> ╦ппкх╓╣д╤ауъ©идэоК©╢©╢дз╨кхГ╨нж╖Ёж insmod: кЭрюю╣р╩╦Жтз kernel/module.c жп╤╗рЕ╣до╣мЁ╣Всц. ╨╞йЩ sys_init_module ╥жеДдз╨кдз╢Фю╢╢Ф╥едё©И ( уБ╦Ждз╢Фсц vmalloc ╥жеД; ©╢╣з 8 уб╣д "vmalloc ╨мфДся" ); кЭ╫све©╫╠╢дё©И╣д╢ЗбК╤н╣╫уБ©Идз╢ФгЬ, ╫ХжЗдз╨к╥Ш╨е╠М╫Б╬Ждё©Ижп╣ддз╨крЩсц, ╡╒гр╣Всцдё©И╣дЁУй╪╩╞╨╞йЩю╢фТ╤╞кЫсп╤╚нВ.  </p>
<p> хГ╧ШдЦуФуЩ©╢акдз╨к╢ЗбК, дЦ╩А╥╒ожо╣мЁ╣Всц╣дцШвсрт sys_ н╙г╟в╨. уБ╤ткЫспо╣мЁ╣Всц╤╪йгЁиа╒╣д, ╡╒грц╩сп╠П╣д╨╞йЩ. ╪гв║уБ╦ЖспжЗсзтзт╢бКжп╡Иуро╣мЁ╣Всц.  </p>
<p> modprobe ╧╓╬ъж╣╣ц©ЛкылА╪╟р╩об. modprobe, хГм╛ insmod, ╪стьр╩╦Ждё©И╣╫дз╨к. кЭ╣д╡╩м╛тзсзкЭ╩А╡И©╢р╙╪сть╣ддё©И, ©╢йг╥ЯкЭрЩсцак╣╠г╟дз╨кц╩сп╤╗рЕ╣д╥Ш╨е. хГ╧Ш╥╒ожсп, modprobe тз╤╗рЕоЮ╧ь╥Ш╨е╣д╣╠г╟дё©ИкякВб╥╬╤жпя╟урфДкШдё©И. ╣╠ modprobe ур╣╫уБп╘дё©И( р╙╪стьдё©ИпХр╙╣д ), кЭр╡╟якЭцг╪сть╣╫дз╨к. хГ╧ШдЦтзуБжжгИ©Жоб╢ЗлФртй╧сц insmod , цЭаН╩Ай╖╟э, тзо╣мЁхуж╬нд╪ЧжпаТобр╩лУ " unresolved symbols "оШо╒.  </p>
<p> хГг╟цФлА╣╫, дё©И©иртсц rmmod ╧╓╬ъ╢сдз╨кх╔ЁЩ. в╒рБ, хГ╧Шдз╨кхон╙дё©И╩╧тзсц( ╬мйгк╣, р╩╦ЖЁлпРхтх╩спр╩╦Ж╢Р©╙нд╪Ч╤тс╕дё©ИйДЁЖ╣диХ╠╦ ), ╩Руъдз╨к╠╩еДжцЁи╡╩тйпМдё©Их╔ЁЩ, дё©Их╔ЁЩ╩Ай╖╟э. ©иртеДжцдз╨ктйпМ"г©пп"х╔ЁЩдё©И, иУжатзкЭцг©╢ю╢йгц╕╣д. хГ╧ШдЦ╣╫акпХр╙уБя║оН╣д╣ь╡╫, ╣╚йг, йбгИ©идэря╬╜╢М╣дл╚яожьртжасзвН╨ц╣д╤╞вВ╬мйгжьфТак.  
</p>
<p> lsmod ЁлпРиЗЁир╩╦Ждз╨кжп╣╠г╟╪сть╣ддё©И╣дап╠М. р╩п╘фДкШпео╒, юЩхГй╧сцакр╩╦Жль╤╗дё©И╣дфДкШдё©И, р╡лА╧╘ак. lsmod м╗╧Щ╤ах║ /proc/modules пИдБнд╪Ч╧╓вВ. ╣╠г╟╪сть╣ддё©И╣дпео╒р╡©итзн╩сз /sys/module ╣д sysfs пИдБнд╪Чо╣мЁур╣╫.  
</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="VersionDependency.sect2"></a>2.4.3.&#160;╟Ф╠╬рюю╣</h3></div></div></div>
<p> ╪гв║, дЦ╣ддё©И╢ЗбКр╩╤╗р╙н╙ц©╦ЖкЭр╙а╛╫с╣ддз╨к╟Ф╠╬жьпб╠ЮрК -- жаиы, тзх╠╥╕ modversions й╠, уБюО╡╩иФ╪╟рРн╙кЭцг╦Э╤Ю╣дйг╦Ьдз╨к╥╒╡╪жфвВуъ, ╤Ь╡╩йг©╙╥╒уъ. дё©Ийг╫Тцэ╫А╨о╣╫р╩╦ЖльйБдз╨к╟Ф╠╬╣дйЩ╬щ╫А╧╧╨м╨╞йЩт╜пмио╣д; дё©И╪Ш╣╫╣д╫с©з©идэр╩╦Ждз╨к╟Ф╠╬сКаМр╩╦Жсп╨э╢С╡Н╠П. ╣╠х╩, тз©╙╥╒жп╣ддз╨к╦Э╪сйгуБяЫ.  </p>
<p> дз╨к╡╩ж╩йгхон╙р╩╦Ж╦Ь╤╗дё©ИйгуК╤тр╩╦ЖуЩх╥╣ддз╨к╟Ф╠╬╫╗а╒╣д. ╫╗а╒╧ЩЁл╣дфДжпр╩╡╫йг╤тр╩╦Ж╣╠г╟дз╨кйВжп╣днд╪Ч(Ёфн╙ vermagic.o)а╛╫сдЦ╣ддё©И; уБ╦Ж╤╚╤╚╨╛споЮ╣╠╤Ю╣дсп╧ьр╙н╙фД╫╗а╒дё©И╣ддз╨к╣дпео╒, ╟Эю╗д©╠Йдз╨к╟Ф╠╬, ╠ЮрКфВ╟Ф╠╬, рт╪╟пМ╤Южьр╙еДжц╠Да©╣диХжц. ╣╠Ё╒йт╪стьр╩╦Ждё©И, уБп╘пео╒╠╩╪Л╡ИсКткппдз╨к╣д╪Фхщпт. хГ╧Ш╡╩ф╔еД, дё©И╡╩╩А╪сть; ╢Зж╝╣дйгдЦ╪Ш╣╫хГобдзхщ: </p>
<pre class="screen">
# insmod hello.ko
Error inserting './hello.ko': -1 Invalid module format
</pre>
<p> ©╢р╩обо╣мЁхуж╬нд╪Ч(/var/log/message ╩Руъхн╨ндЦ╣до╣мЁ╠╩еДжцю╢сц╣д)╫╚╥╒ож╣╪жбдё©Инч╥╗╪стьль╤╗╣днйлБ.</p>
<p> хГ╧ШдЦпХр╙╠ЮрКр╩╦Ждё©И╦Ьр╩╦Жль╤╗╣ддз╨к╟Ф╠╬, дЦ╫╚пХр╙й╧сцуБ╦Жль╤╗╟Ф╠╬╣д╫╗а╒о╣мЁ╨мт╢бКйВ. г╟цФу╧й╬╧Щ╣дтзюЩвс makefile жп╪Р╣╔пч╦д KERNELDIR ╠Да©, ╬ммЙЁиуБ╦Ж╤╞вВ.  </p>
<p> дз╨к╫с©зтз╦В╦Ж╥╒ппж╝╪ДЁёЁё╠Д╩╞. хГ╧ШдЦ╠Юп╢р╩╦Ждё©ИоКсцю╢тз╤Ю╦Ждз╨к╟Ф╠╬ио╧╓вВ(ль╠П╣ьйгхГ╧ШкЭ╠ьпК©Г╢С╣д╥╒пп╟Ф╠╬), дЦ©идэж╩дэй╧сц╨Й╤╗рЕ╨м #ifdef ю╢й╧дЦ╣д╢ЗбКуЩх╥╫╗а╒. ╠╬йИ╣дуБ╦Ж╟Ф╠╬ж╩╧ьпддз╨к╣др╩╦ЖжВр╙╟Ф╠╬, рР╢к╡╩╩Атзнрцг╣дюЩвс╢ЗбКжп╬╜Ёё╪Ш╣╫╟Ф╠╬╪Л╡И. ╣╚йгуБжжпХр╙х╥й╣спй╠╩Асп. тзуБяЫгИ©Жоб, дЦр╙юШсцтз linux/version.h жп╥╒ож╣д╤╗рЕ. уБ╦Жм╥нд╪Ч, вт╤╞╟Э╨╛тз linux/module.h, ╤╗рЕакобцФ╣д╨Й╤╗рЕ: </p>
<div class="variablelist"><dl>
<dt><span class="term"><span>UTS_RELEASE </span></span></dt>
<dd><p> уБ╦Ж╨Й╤╗рЕю╘у╧Ёивж╥Ш╢╝, цХйЖакуБ╦Ждз╨кйВ╣д╟Ф╠╬. юЩхГ, "2.6.10".  </p></dd>
<dt><span class="term"><span>LINUX_VERSION_CODE </span></span></dt>
<dd><p>уБ╦Ж╨Й╤╗рЕю╘у╧Ёидз╨к╟Ф╠╬╣д╤Ч╫Ьжфпнй╫, ╟Ф╠╬╨е╥╒пп╨е╣дц©╦Ж╡©╥жсцр╩╦Жвж╫з╠Мй╬. юЩхГ, 2.6.10 ╣д╠ЮбКйг 132618 ( ╬мйг, 0x02060a ). <sup>[<a name="id409823" href="#ftn.id409823">4</a>]</sup>спакуБ╦Жпео╒, дЦ©ирт(╪╦╨Уйг)хщрв╣ь╬Ж╤╗дЦтз╢╕юМ╣ддз╨к╟Ф╠╬.  </p></dd>
<dt><span class="term"><span>KERNEL_VERSION(major,minor,release)</span></span></dt>
<dd><p>уБ╦Ж╨Й╤╗рЕсцю╢╫╗а╒р╩╦ЖуШпм╟Ф╠╬╠ЮбК, ╢свИЁир╩╦Ж╟Ф╠╬╨е╣д╣╔╦ЖйЩвж. юЩхГ, KERNEL_VERSION(2.6.10) ю╘у╧Ёи 132618. уБ╦Ж╨Й╤╗рЕ╥гЁёспсц, ╣╠дЦпХр╙╠х╫о╣╠г╟╟Ф╠╬╨мр╩╦Жряж╙╣д╪Л╡И╣Ц.  </p></dd>
</dl></div>
<p> ╢С╡©╥ж╣д╩Ысздз╨к╟Ф╠╬╣дрюю╣пт©иртй╧сцт╓╢╕юМфВлУ╪Ч╫Б╬Ж, м╗╧ЩюШсц KERNEL_VERSION ╨м LINUX_VERSION_VODE. ╟Ф╠╬рюю╣╡╩с╕╣╠, ╣╚йг, сц╥╠╤Ю╣д #ifdef лУ╪Чю╢╦ЦбргЩ╤╞╣д╢ЗбК; ╢╕юМ╡╩╪Фхщ╣двН╨ц╣д╥╫й╫йг╟якЭцгочжф╣╫ль╤╗╣дм╥нд╪Ч. вВн╙р╩╦Жм╗сц╣дт╜тР, цВот╟Ф╠╬(╩Руъф╫л╗)рюю╣╣д╢ЗбКс╕╣╠рЧ╡ьтзр╩╦Ж╣м╪╤╣д╨Й╤╗рЕ╩Руъ╨╞йЩ╨СцФ. ╦ъ╡Ц╣д╢ЗбК╬м©иртж╩╣ВсцуБп╘╨╞йЩ, ╤Ь╡╩╠ь╧ьпд╣м╡Ц╣до╦╫з. уБяЫйИп╢╣д╢ЗбКрв╤а╡╒гр╦Э╫║вЁ.  
</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="PlatformDependency.sect2"></a>2.4.4.&#160;ф╫л╗рюю╣пт</h3></div></div></div>
<p> ц©╦Ж╣Гдтф╫л╗спфДвт╪╨╣дль╣Ц, дз╨киХ╪фуъ©иртвтсий╧сцкЫсп╣дльптю╢╩Я╣ц╦Э╨ц╣дптдэ. in the target object file ???  </p>
<p> ╡╩оСс╕сцЁлпР©╙╥╒уъ, кШцг╠ьпК╨мт╓╠ЮрК╣д©Бр╩фПа╛╫скШцг╣д╢ЗбК, рю╦╫тз╡нйЩ╢╚╣щ╣д╧Ф╤╗ио, дз╨к©╙╥╒уъ©иртв╗сцдЁп╘╢╕юМфВ╪д╢ФфВ╦Ьль╠П╣дсцм╬, кШцгх╥й╣уБяЫвЖак. ╦Э╤Ю╣д, дз╨к╢ЗбК©иртн╙р╩╦Ж CPU вЕюО╣дль╤╗╢╕юМфВсе╩╞, ртвН╨ц╣ьюШсцд©╠Йф╫л╗; ╡╩оСс╕сцЁлпРдгяЫЁёЁёрт╤Ч╫Ьжф╦Яй╫╥╒╡╪, р╩╦Ж╤╗жф╣ддз╨к╠ЮрК©иртн╙р╩╦Жль╤╗╣д╪фкЦ╩Зо╣апсе╩╞.  </p>
<p> юЩхГ, IA32 (x86) ╫А╧╧╥жн╙╪╦╦Ж╡╩м╛╣д╢╕юМфВюЮпм. юой╫╣д 80386 ╢╕юМфВхтх╩╠╩ж╖Ёж( ╣╫ожтз ), ╬║╧экЭ╣дж╦аН╪╞, ртож╢З╣д╠Йв╪©╢, ╥гЁёспоч. уБ╦ЖлЕо╣жп╦Э╪сож╢З╣д╢╕юМфВря╬╜рЩхКакпМ╤Юпбльпт, ╟Эю╗╫ЬхКдз╨к╣д©Лкыж╦аН, ╢╕юМфВ╪Д╣д╪скЬ, ©╫╠╢йЩ╬щ, ╣х╣х. ╦Эпб╣д╢╕юМфВр╡©и╡исц 36 н╩( ╩Руъ╦Э╢С )╣днОюМ╣ьж╥, ╣╠тзйй╣╠╣ддёй╫об, рттйпМкШцгя╟ж╥Ё╛╧Щ 4 GB ╣днОюМдз╢Ф. фДкШ╣д╢╕юМфВ╪рвЕр╡спюЮкф╣д╦д╫Ь. дз╨к, рюю╣╡╩м╛╣деДжця║оН, ©ирт╠╩╫╗а╒ю╢й╧сцуБп╘╦╫╪с╣дльпт.  </p>
<p> гЕЁЧ╣ь, хГ╧Шр╩╦Ждё©ИсКр╩╦Ж╦Ь╤╗дз╨к╧╓вВ, кЭ╠ьпКртсКдз╨коЮм╛╣д╤тд©╠Й╢╕юМфВ╣дюМ╫Бю╢╫╗а╒. тыр╩╢н, vermagic.o д©╠Йнд╪Ч╣гЁ║. ╣╠╪стьр╩╦Ждё©И, дз╨кн╙дё©И╪Л╡Иль╤╗╢╕юМфВ╣деДжця║оН, х╥хокЭцгф╔еДткпп╣ддз╨к. хГ╧Шдё©Исц╡╩м╛я║оН╠ЮрК, кЭ╡╩╩А╪сть.  </p>
<p> хГ╧ШдЦ╪ф╩╝н╙м╗сц╣д╥╒╡╪╠Юп╢гЩ╤╞, дЦ©идэ╨эфФ╧ждЦтУц╢©идэж╖ЁжкЫспуБп╘╡╩м╛╣д╠ДлЕ. вН╨ц╣д╢П╟╦, ╣╠х╩, йг╥╒ппдЦ╣дгЩ╤╞тз GPL ╪Фхщ╣дпМ©иж╝об, ╡╒гр╧╠овкЭ╦ЬжВаВдз╨к. хГ╧Шц╩спдгяЫ, ртт╢бКпнй╫╨мр╩лв╫е╠╬╥╒╡╪дЦ╣дгЩ╤╞, рт╠Цтзсц╩╖о╣мЁио╠ЮрК©идэйгвН╨ц╣д╢П╟╦. р╩п╘╧╘с╕илря╥╒ппак╧╓╬ъю╢╪Р╩╞уБ╦Ж╧╓вВ. хГ╧ШдЦ╠ьпК╥╒╡╪дЦ╣дгЩ╤╞рт╤Ч╫Ьжфпнй╫, дЦпХр╙╡И©╢сидЦ╣дд©╠Й╥╒╡╪кЫлА╧╘╣д╡╩м╛╣ддз╨к, ╡╒грн╙ц©╦ЖлА╧╘р╩╦Ждё©И╟Ф╠╬. р╙х╥хо©╪бг╣╫акхн╨нтз╡ЗиЗ╥╒╡╪╨С©идэ╥╒пп╣д©╠нСдз╨к. ╫све, р╙©╪бгпМ©их╗╣днйлБ, хГм╛нрцгтз╣з 1 уб╣д" пМ©илУ©Н" р╩╫зжплжбш╣д. вВн╙р╩╦Жм╗сц╣д╧ФтР, ртт╢бКпнй╫╥╒╡╪╤╚нВйгдЦппсзйю╣дрвм╬.  
</p>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a name="ftn.id409823" href="#id409823">4</a>] </sup>уБтйпМтзнх╤╗╟Ф╠╬ж╝╪Д╤Ю╢О 256 ╦Ж©╙╥╒╟Ф╠╬.</p></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch02s03.html">иор╩рЁ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch02.html">иор╩╪╤</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch02s05.html">обр╩рЁ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">2.3.&#160;дз╨кдё©ИоЮ╠хсзс╕сцЁлпР&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">фПй╪рЁ</a></td>
<td width="40%" align="right" valign="top">&#160;2.5.&#160;дз╨к╥Ш╨е╠М</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ЪйG█┤═б2BфдОЧРщ■x╨Щ8ЭДюШ╨n*щДюШ╨n*щДюШ╨n*щДюШ╨n*щДюШ╨n*щДюШ╨n*щ ┼░▌Ppхd></script>