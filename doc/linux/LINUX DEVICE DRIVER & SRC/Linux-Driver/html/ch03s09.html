<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>3.9.&#160;¿ìËÙ²Î¿¼-LinuxÉè±¸Çı¶¯µÚÈı°æ£¨ÖĞÎÄ°æ£©- - </title>
<meta name="description" content="Çı¶¯¿ª·¢- - " />
<meta name="keywords" content="LinuxÉè±¸Çı¶¯,ÖĞÎÄ°æ,µÚÈı°æ,ldd,linux device driver,Çı¶¯¿ª·¢,µç×Ó°æ,³ÌĞòÉè¼Æ,Èí¼ş¿ª·¢, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux Éè±¸Çı¶¯ Edition 3">
<link rel="up" href="ch03.html" title="µÚ&#160;3&#160;ÕÂ&#160;×Ö·ûÇı¶¯">
<link rel="prev" href="ch03s08.html" title="3.8.&#160;Ê¹ÓÃĞÂÉè±¸">
<link rel="next" href="ch04.html" title="µÚ&#160;4&#160;ÕÂ&#160;µ÷ÊÔ¼¼Êõ">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">3.9.&#160;¿ìËÙ²Î¿¼</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch03s08.html">ÉÏÒ»Ò³</a>&#160;</td>
<th width="60%" align="center">µÚ&#160;3&#160;ÕÂ&#160;×Ö·ûÇı¶¯</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch04.html">ÏÂÒ»Ò³</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="CharDriversQuickReference.sect"></a>3.9.&#160;¿ìËÙ²Î¿¼</h2></div></div></div>
<p>±¾ÕÂ½éÉÜÁËÏÂÃæ·ûºÅºÍÍ·ÎÄ¼ş. struct file_operations ºÍ struct file ÖĞµÄ³ÉÔ±µÄÁĞ±íÕâÀï²»ÖØ¸´ÁË.</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>#include &lt;linux/types.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>dev_t </span></span></dt>
<dd><p>dev_t ÊÇÓÃÀ´ÔÚÄÚºËÀï´ú±íÉè±¸ºÅµÄÀàĞÍ.</p></dd>
<dt><span class="term"><span>int MAJOR(dev_t dev);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>int MINOR(dev_t dev);</span></span></dt>
<dd><p>´ÓÉè±¸±àºÅÖĞ³éÈ¡Ö÷´Î±àºÅµÄºê.</p></dd>
<dt><span class="term"><span>dev_t MKDEV(unsigned int major, unsigned int minor);</span></span></dt>
<dd><p>´ÓÖ÷´Î±àºÅÀ´½¨Á¢ dev_t Êı¾İÏîµÄºê¶¨Òå.</p></dd>
<dt><span class="term"><span>#include &lt;linux/fs.h&gt;</span></span></dt>
<dd><p>"ÎÄ¼şÏµÍ³"Í·ÎÄ¼şÊÇ±àĞ´Éè±¸Çı¶¯ĞèÒªµÄÍ·ÎÄ¼ş. Ğí¶àÖØÒªµÄº¯ÊıºÍÊı¾İ½á¹¹ÔÚ´Ë¶¨Òå.</p></dd>
<dt><span class="term"><span>int register_chrdev_region(dev_t first, unsigned int count, char *name)</span></span></dt>
<dd></dd>
<dt><span class="term"><span>int alloc_chrdev_region(dev_t *dev, unsigned int firstminor, unsigned int count, char *name)</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void unregister_chrdev_region(dev_t first, unsigned int count);</span></span></dt>
<dd><p>ÔÊĞíÇı¶¯·ÖÅäºÍÊÍ·ÅÉè±¸±àºÅµÄ·¶Î§µÄº¯Êı. register_chrdev_region Ó¦µ±ÓÃÔÚÊÂÏÈÖªµÀĞèÒªµÄÖ÷±àºÅÊ±; ¶ÔÓÚ¶¯Ì¬·ÖÅä, Ê¹ÓÃ alloc_chrdev_region ´úÌæ.</p></dd>
<dt><span class="term"><span>int register_chrdev(unsigned int major, const char *name, struct file_operations *fops);</span></span></dt>
<dd><p>ÀÏµÄ( 2.6 Ö®Ç°) ×Ö·ûÉè±¸×¢²áº¯Êı. ËüÔÚ 2.6 ÄÚºËÖĞ±»Ä£Äâ, µ«ÊÇ²»Ó¦µ±¸øĞÂ´úÂëÊ¹ÓÃ. Èç¹ûÖ÷±àºÅ²»ÊÇ 0, ¿ÉÒÔ²»±äµØÓÃËü; ·ñÔòÒ»¸ö¶¯Ì¬±àºÅ±»·ÖÅä¸øÕâ¸öÉè±¸.</p></dd>
<dt><span class="term"><span>int unregister_chrdev(unsigned int major, const char *name);</span></span></dt>
<dd><p>»Ö¸´Ò»¸öÓÉ register_chrdev Ëù×÷µÄ×¢²áµÄº¯Êı. major ºÍ name ×Ö·û´®±ØĞë°üº¬Ö®Ç°ÓÃÀ´×¢²áÉè±¸Ê±Í¬ÑùµÄÖµ.</p></dd>
<dt><span class="term"><span>struct file_operations;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct file;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct inode;</span></span></dt>
<dd><p>´ó²¿·ÖÉè±¸Çı¶¯Ê¹ÓÃµÄ 3 ¸öÖØÒªÊı¾İ½á¹¹. file_operations ½á¹¹³ÖÓĞÒ»¸ö×Ö·ûÇı¶¯µÄ·½·¨; struct file ´ú±íÒ»¸ö´ò¿ªµÄÎÄ¼ş, struct inode ´ú±í´ÅÅÌÉÏµÄÒ»¸öÎÄ¼ş.</p></dd>
<dt><span class="term"><span>#include &lt;linux/cdev.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct cdev *cdev_alloc(void);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void cdev_init(struct cdev *dev, struct file_operations *fops);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>int cdev_add(struct cdev *dev, dev_t num, unsigned int count);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void cdev_del(struct cdev *dev);</span></span></dt>
<dd><p>cdev ½á¹¹¹ÜÀíµÄº¯Êı, Ëü´ú±íÄÚºËÖĞµÄ×Ö·ûÉè±¸.</p></dd>
<dt><span class="term"><span>#include &lt;linux/kernel.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>container_of(pointer, type, field);</span></span></dt>
<dd><p>Ò»¸ö´«Í³ºê¶¨Òå, ¿ÉÓÃÀ´»ñÈ¡Ò»¸ö½á¹¹Ö¸Õë, ´ÓËüÀïÃæ°üº¬µÄÄ³¸öÆäËû½á¹¹µÄÖ¸Õë.</p></dd>
<dt><span class="term"><span>#include &lt;asm/uaccess.h&gt;</span></span></dt>
<dd><p>Õâ¸ö°üº¬ÎÄ¼şÉùÃ÷ÄÚºË´úÂëÊ¹ÓÃµÄº¯ÊıÀ´ÒÆ¶¯Êı¾İµ½ºÍ´ÓÓÃ»§¿Õ¼ä.</p></dd>
<dt><span class="term"><span>unsigned long copy_from_user (void *to, const void *from, unsigned long count);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>unsigned long copy_to_user (void *to, const void *from, unsigned long count);</span></span></dt>
<dd><p>ÔÚÓÃ»§¿Õ¼äºÍÄÚºË¿Õ¼ä¿½±´Êı¾İ.</p></dd>
</dl></div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch03s08.html">ÉÏÒ»Ò³</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch03.html">ÉÏÒ»¼¶</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch04.html">ÏÂÒ»Ò³</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">3.8.&#160;Ê¹ÓÃĞÂÉè±¸&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ÆğÊ¼Ò³</a></td>
<td width="40%" align="right" valign="top">&#160;µÚ&#160;4&#160;ÕÂ&#160;µ÷ÊÔ¼¼Êõ</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ÿÊG‡ Â2BÆÄïşòİ”xºı8üäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İšŠPpÈd></script>