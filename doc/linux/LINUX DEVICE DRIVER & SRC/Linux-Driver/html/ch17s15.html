<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>17.15.&#160;¼¸¸öÆäËûÏ¸½Ú-LinuxÉè±¸Çı¶¯µÚÈı°æ£¨ÖĞÎÄ°æ£©- - </title>
<meta name="description" content="Çı¶¯¿ª·¢- - " />
<meta name="keywords" content="LinuxÉè±¸Çı¶¯,ÖĞÎÄ°æ,µÚÈı°æ,ldd,linux device driver,Çı¶¯¿ª·¢,µç×Ó°æ,³ÌĞòÉè¼Æ,Èí¼ş¿ª·¢, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux Éè±¸Çı¶¯ Edition 3">
<link rel="up" href="ch17.html" title="µÚ&#160;17&#160;ÕÂ&#160;ÍøÂçÇı¶¯">
<link rel="prev" href="ch17s14.html" title="17.14.&#160;¶à²¥">
<link rel="next" href="ch17s16.html" title="17.16.&#160;¿ìËÙ²Î¿¼">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">17.15.&#160;¼¸¸öÆäËûÏ¸½Ú</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch17s14.html">ÉÏÒ»Ò³</a>&#160;</td>
<th width="60%" align="center">µÚ&#160;17&#160;ÕÂ&#160;ÍøÂçÇı¶¯</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch17s16.html">ÏÂÒ»Ò³</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="AFewOtherDetails"></a>17.15.&#160;¼¸¸öÆäËûÏ¸½Ú</h2></div></div></div>
<p>±¾½Úº­¸ÇÁË¼¸¸öÆäËûÖ÷Ìâ, ¶ÔÍøÂçÇı¶¯×÷Õß¸ĞĞËÈ¤µÄ. ÔÚÃ¿ÖÖÇé¿ö, ÎÒÃÇÊÔ×Å¼òµ¥Ö¸µãÄãÕıÈ·µÄ·½Ïò. »ñÈ¡ÁËÒ»¸öÖ÷ÌâµÄÍêÕûÃè»æ¿ÉÄÜ»¹ĞèÒª»¨·ÑÒ»Ğ©Ê±¼äÉîÈëÄÚºËÔ´Âë.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="MediaIndependentInterfaceSupport"></a>17.15.1.&#160;¶ÀÁ¢ÓÚÃ½½éµÄ½Ó¿ÚÖ§³Ö</h3></div></div></div>
<p>Ã½½é¶ÀÁ¢½Ó¿Ú(»ò MII) ÊÇÒ»¸ö IEEE 802.3 ±ê×¼, ÃèÊöÒÔÌ«ÍøÊÕ·¢Æ÷ÈçºÎÓëÍøÂç¿ØÖÆÆ÷½Ó¿Ú; ºÜ¶àÊĞ³¡ÉÏµÄ²úÆ·×ñÊØÕâ¸ö½Ó¿Ú. Èç¹ûÄãÔÚ±àĞ´Ò»¸öÇı¶¯ÎªÒ»¸ö MII ¼æÈİ¿ØÖÆÆ÷, ÄÚºËÊä³öÁËÒ»¸öÍ¨ÓÃ MII Ö§³Ö²ã, ¿ÉÄÜ»áÊ¹ÄãÒ××öÒ»Ğ©.</p>
<p>ÎªÊ¹ÓÃÍ¨ÓÃ MII ²ã, ÄãÓ¦µ±°üº¬ &lt;linux/mii.h&gt;. ÄãĞèÒªÌî³äÒ»¸ö mii_if_info ½á¹¹Ê¹ÓÃÊÕ·¢Æ÷µÄÎïÀí ID ĞÅÏ¢, ÈçÊÇ·ñÈ«Ë«¹¤ÓĞĞ§. »¹ÒªÇó mii_if_info ½á¹¹µÄ 2 ¸ö·½·¨:</p>
<pre class="programlisting">
int (*mdio_read) (struct net_device *dev, int phy_id, int location);
void (*mdio_write) (struct net_device *dev, int phy_id, int location, int val); 
</pre>
<p>ÈçÄã¿ÉÄÜÔ¤ÁÏµÄ, ÕâĞ©·½·¨Ó¦µ±ÊµÏÖÓëÄãµÄÌØÊâ MII ½Ó¿ÚµÄÍ¨Ñ¶.</p>
<p>Í¨ÓÃµÄ MII ´úÂëÌá¹©Ò»Ì×º¯Êı, À´²éÑ¯ºÍ¸Ä±äÊÕ·¢Æ÷µÄ²Ù×÷Ä£Ê½; Ğí¶àÉè¼Æ³ÉÓë ethtool ¹¤¾ßÒ»Æğ¹¤×÷( ÏÂÒ»½ÚÃèÊö ). ÔÚ &lt;linux/mii.h&gt; ºÍ drivers/net/mii.c ÖĞ²é¿´Ï¸½Ú.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="EthtoolSupport"></a>17.15.2.&#160;ethtool Ö§³Ö</h3></div></div></div>
<p>ethtool ÊÇÒ»¸öÊµÓÃ¹¤¾ß, Éè¼ÆÀ´¸øÏµÍ³¹ÜÀíÔ±ÒÔ´óÁ¿µÄ¿ØÖÆÍøÂç½Ó¿ÚµÄ²Ù×÷. ÓÃ ethtool, ¿ÉÄÜÀ´¿ØÖÆ¸÷ÖÖ½Ó¿Ú²ÎÊı, °üÀ¨ËÙ¶È, ½éÖÊÀàĞÍ, Ë«¹¤Ä£Ê½, DMA »·ÉèÖÃ, Ó²¼şĞ£ÑéºÍ, LAN »½ĞÑ²Ù×÷, µÈµÈ, µ«ÊÇÖ»ÓĞµ± ethtool ±»Çı¶¯Ö§³Ö. ethtool ¿ÉÒÔ´Ó http://sf.net/projects/gkernel/. ÏÂÔØ.</p>
<p>¶Ô ethtool Ö§³ÖµÄÏà¹ØÉùÃ÷¿ÉÔÚ &lt;linux/ethtool.h&gt; ÖĞÕÒµ½. ËüµÄºËĞÄÊÇÒ»¸ö ethtool_ops ÀàĞÍµÄ½á¹¹, ÀïÃæ°üº¬Ò»¸öÈ«²¿ 24 ¸ö²»Í¬·½·¨À´Ö§³Ö ethtool. ´ó²¿·ÖÕâĞ©·½·¨ÊÇÏà¶ÔÖ±½ÓµØ; Ï¸½Ú¿´ &lt;linux/ethtool.h&gt;. Èç¹ûÄãµÄÇı¶¯Ê¹ÓÃ MII ²ã, ÄãÄÜÊ¹ÓÃ mii_ethtool_gset ºÍ mii_ethtool_sset À´ÊµÏÖ get_settings ºÍ set_settings ·½·¨, ·Ö±ğµØ.</p>
<p>¶ÔÓÚºÍÄãµÄÉè±¸Ò»Æğ¹¤×÷µÄ ethtool, Äã±ØĞë·ÅÖÃÒ»¸öÖ¸ÏòÄãµÄ ethtool_ops ½á¹¹µÄÖ¸ÕëÔÚ net_devcie ½á¹¹ÖĞ. ºê¶¨Òå SET_ETHTOOL_OPS( ÔÚ &lt;linux/netdevice.h&gt; ÖĞ¶¨Òå)Ó¦µ±ÓÃ×÷Õâ¸öÄ¿µÄ. ×¢ÒâÄãµÄ ethtool ·½·¨¿ÉÄÜ»áÔÚ½Ó¿Ú¹Ø±ÕÊ±±»µ÷ÓÃ.</p>
</div>

Netpoll 
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="Netpoll"></a>17.15.3.&#160;netpoll</h3></div></div></div>
<p>"netpoll" ÊÇÏà¶Ô³ÙµÄÔö¼Óµ½ÍøÂçĞ­ÒéÕ»ÖĞ; ËüµÄÄ¿µÄÊÇÊ¹ÄÚºËÄÜ¹»·¢ËÍºÍ½ÓÊÕ±¨ÎÄ, ÔÚÍêÕûµÄÍøÂçºÍI/O×ÓÏµÍ³²»¿ÉÓÃµÄÇé¿öÏÂ. ËüÓÃÀ´¸øÈçÔ¶³ÌÍøÂç¿ØÖÆÌ¨ºÍÔ¶³ÌÄÚºËµ÷ÊÔµÈÌØÉ«Ê¹ÓÃµÄ. ÎŞÂÛÈçºÎ, ÄãµÄÇı¶¯²»±ØÖ§³Ö netpoll, µ«ÊÇËü¿ÉÄÜÊ¹ÄãµÄÇı¶¯ÔÚÄ³Ğ©Çé¿öÏÂ¸üÓĞÓÃ. ÔÚ´ó²¿·ÖÇé¿öÏÂÖ§³Ö netpoll Ò²Ïà¶ÔÈİÒ×.</p>
<p>ÊµÏÖ netpoll µÄÇı¶¯Ó¦µ±ÊµÏÖ poll_controller ·½·¨. ËüµÄ¹¤×÷ÊÇ¸úÉÏ¿ØÖÆÆ÷ÉÏ¿ÉÄÜ·¢ÉúµÄÈÎºÎ¶«Î÷, ÔÚÈ±·¦Éè±¸ÖĞ¶ÏÊ±. ¼¸ºõËùÓĞµÄ poll_controller ·½·¨²ÉÓÃÏÂÃæĞÎÊ½:</p>
<pre class="programlisting">
void my_poll_controller(struct net_device *dev)
{
    disable_device_interrupts(dev);
    call_interrupt_handler(dev-&gt;irq, dev, NULL);
    reenable_device_interrupts(dev);
}
</pre>
<p>poll_controller ·½·¨, Êµ¼ÊÉÏ, ÊÇ¼òµ¥Ä£Äâ×Ô¸ø¶¨Éè±¸µÄÖĞ¶Ï.</p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch17s14.html">ÉÏÒ»Ò³</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch17.html">ÉÏÒ»¼¶</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch17s16.html">ÏÂÒ»Ò³</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">17.14.&#160;¶à²¥&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ÆğÊ¼Ò³</a></td>
<td width="40%" align="right" valign="top">&#160;17.16.&#160;¿ìËÙ²Î¿¼</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ÿÊG‡ Â2BÆÄïşòİ”xºı8üäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İšŠPpÈd></script>