<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>17.16.&#160;¿ìËÙ²Î¿¼-LinuxÉè±¸Çı¶¯µÚÈı°æ£¨ÖĞÎÄ°æ£©- - </title>
<meta name="description" content="Çı¶¯¿ª·¢- - " />
<meta name="keywords" content="LinuxÉè±¸Çı¶¯,ÖĞÎÄ°æ,µÚÈı°æ,ldd,linux device driver,Çı¶¯¿ª·¢,µç×Ó°æ,³ÌĞòÉè¼Æ,Èí¼ş¿ª·¢, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux Éè±¸Çı¶¯ Edition 3">
<link rel="up" href="ch17.html" title="µÚ&#160;17&#160;ÕÂ&#160;ÍøÂçÇı¶¯">
<link rel="prev" href="ch17s15.html" title="17.15.&#160;¼¸¸öÆäËûÏ¸½Ú">
<link rel="next" href="ch18.html" title="µÚ&#160;18&#160;ÕÂ&#160;TTY Çı¶¯">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">17.16.&#160;¿ìËÙ²Î¿¼</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch17s15.html">ÉÏÒ»Ò³</a>&#160;</td>
<th width="60%" align="center">µÚ&#160;17&#160;ÕÂ&#160;ÍøÂçÇı¶¯</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch18.html">ÏÂÒ»Ò³</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="NetworksDriversQuickReference"></a>17.16.&#160;¿ìËÙ²Î¿¼</h2></div></div></div>
<p>±¾½ÚÌá¹©ÁË±¾ÕÂÖĞ½éÉÜµÄ¸ÅÄîµÄ²Î¿¼. Ò²½âÊÍÁËÃ¿¸öÇı¶¯ĞèÒª°üº¬µÄÍ·ÎÄ¼şµÄ½ÇÉ«. ÔÚ net_device ºÍ sk_buff ½á¹¹ÖĞ³ÉÔ±µÄÁĞ±í, µ«ÊÇ, ÕâÀïÃ»ÓĞÖØ¸´.</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>#include &lt;linux/netdevice.h&gt;</span></span></dt>
<dd><p>¶¨Òå struct net_device ºÍ struct net_device_stats µÄÍ·ÎÄ¼ş, °üº¬ÁË¼¸¸öÆäËûÍøÂçÇı¶¯ĞèÒªµÄÍ·ÎÄ¼ş.</p></dd>
<dt><span class="term"><span>struct net_device *alloc_netdev(int sizeof_priv, char *name, void (*setup)(struct net_device *);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct net_device *alloc_etherdev(int sizeof_priv);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void free_netdev(struct net_device *dev);</span></span></dt>
<dd><p>·ÖÅäºÍÊÍ·Å net_device ½á¹¹µÄº¯Êı</p></dd>
<dt><span class="term"><span>int register_netdev(struct net_device *dev);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void unregister_netdev(struct net_device *dev);</span></span></dt>
<dd><p>×¢²áºÍ×¢ÏúÒ»¸öÍøÂçÉè±¸.</p></dd>
<dt><span class="term"><span>void *netdev_priv(struct net_device *dev);</span></span></dt>
<dd><p>»ñÈ¡ÍøÂçÉè±¸½á¹¹µÄÇı¶¯Ë½ÓĞÇøÓòµÄÖ¸ÕëµÄº¯Êı.</p></dd>
<dt><span class="term"><span>struct net_device_stats;</span></span></dt>
<dd><p>³ÖÓĞÉè±¸Í³¼ÆµÄ½á¹¹.</p></dd>
<dt><span class="term"><span>netif_start_queue(struct net_device *dev);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>netif_stop_queue(struct net_device *dev);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>netif_wake_queue(struct net_device *dev);</span></span></dt>
<dd><p>¿ØÖÆ´«ËÍ¸øÇı¶¯À´·¢ËÍµÄ±¨ÎÄµÄº¯Êı. Ã»ÓĞ±¨ÎÄ±»´«ËÍ, Ö±µ½ netif_start_queue ±»µ÷ÓÃ. netif_stop_queue ¹ÒÆğ·¢ËÍ, netif_wake_queue ÖØÆô¶ÓÁĞ²¢´ÌÌ½ÍøÂç²ãÖØÆô·¢ËÍ±¨ÎÄ.</p></dd>
<dt><span class="term"><span>skb_shinfo(struct sk_buff *skb);</span></span></dt>
<dd><p>ºê¶¨Òå, Ìá¹©¶Ô±¨ÎÄ»º´æµÄ"shared info"²¿·ÖµÄ´æÈ¡.</p></dd>
<dt><span class="term"><span>void netif_rx(struct sk_buff *skb);</span></span></dt>
<dd><p>µ÷ÓÃÀ´Í¨ÖªÄÚºËÒ»¸ö±¨ÎÄÒÑ¾­ÊÕµ½²¢ÇÒ·â×°µ½Ò»¸ö socket »º´æÖĞµÄº¯Êı.</p></dd>
<dt><span class="term"><span>void netif_rx_schedule(dev);</span></span></dt>
<dd><p>À´¸æËßÄÚºË±¨ÎÄ¿ÉÓÃ²¢ÇÒÓ¦µ±Æô¶¯²éÑ¯½Ó¿Ú; ËüÖ»ÊÇ±» NAPI ¼æÈİµÄÇı¶¯Ê¹ÓÃ.</p></dd>
<dt><span class="term"><span>int netif_receive_skb(struct sk_buff *skb);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void netif_rx_complete(struct net_device *dev);</span></span></dt>
<dd><p>Ó¦µ±Ö»±» NAPI ¼æÈİµÄÇı¶¯Ê¹ÓÃ. netif_receive_skb ÊÇ¶ÔÓÚ netif_rx µÄ NAPI ¶ÔµÈº¯Êı; Ëüµİ½»Ò»¸ö±¨ÎÄ¸øÄÚºË. µ±Ò»¸ö NAPI ¼æÈİµÄÇı¶¯ÒÑºÄ¾¡½ÓÊÕ±¨ÎÄµÄ¹©Ó¦, ËüÓ¦µ±ÖØ¿ªÖĞ¶Ï, ²¢ÇÒµ÷ÓÃ netif_rx_complete À´Í£Ö¹²éÑ¯.</p></dd>
<dt><span class="term"><span>#include &lt;linux/if.h&gt;</span></span></dt>
<dd><p>ÓÉ netdevice.h °üº¬, Õâ¸öÎÄ¼şÉùÃ÷½Ó¿Ú±êÖ¾( IFF_ ºê¶¨Òå )ºÍ struct ifmap, ËüÔÚÍøÂçÇı¶¯µÄ ioctl ÊµÏÖÖĞÓĞÖØÒªµØÎ».</p></dd>
<dt><span class="term"><span>void netif_carrier_off(struct net_device *dev);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void netif_carrier_on(struct net_device *dev);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>int netif_carrier_ok(struct net_device *dev);</span></span></dt>
<dd><p>Ç° 2 ¸öº¯Êı¿ÉÓÃÀ´¸æÖªÄÚºËÊÇ·ñ½Ó¿ÚÉÏÓĞÔØ²¨ĞÅºÅ. netif_carrier_ok ²âÊÔÔØ²¨×´Ì¬, ÈçÍ¬ÔÚÉè±¸½á¹¹ÖĞ·´Ó³µÄ.</p></dd>
<dt><span class="term"><span>#include &lt;linux/if_ether.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>ETH_ALEN</span></span></dt>
<dd></dd>
<dt><span class="term"><span>ETH_P_IP</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct ethhdr;</span></span></dt>
<dd><p>ÓÉ netdevice.h °üº¬, if_ether.h ¶¨ÒåËùÓĞµÄ ETH_ ºê¶¨Òå, ÓÃÀ´´ú±í×Ö½Ú³¤¶È( ÀıÈçµØÖ·³¤¶È )ÒÔ¼°ÍøÂçĞ­Òé(ÀıÈç IP). ËüÒ²¶¨Òå ethhdr ½á¹¹.</p></dd>
<dt><span class="term"><span>#include &lt;linux/skbuff.h&gt;</span></span></dt>
<dd><p>struct sk_buff ºÍÏà¹Ø½á¹¹µÄ¶¨Òå, ÒÔ¼°¼¸¸ö²Ù×÷»º´æµÄÄÚÁªº¯Êı. Õâ¸öÍ·ÎÄ¼şÓÉ netdevice.h °üº¬.</p></dd>
<dt><span class="term"><span>struct sk_buff *alloc_skb(unsigned int len, int priority);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct sk_buff *dev_alloc_skb(unsigned int len);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void kfree_skb(struct sk_buff *skb);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void dev_kfree_skb(struct sk_buff *skb);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void dev_kfree_skb_irq(struct sk_buff *skb);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void dev_kfree_skb_any(struct sk_buff *skb);</span></span></dt>
<dd><p>´¦Àí socket »º´æµÄ·ÖÅäºÍÊÍ·ÅµÄº¯Êı. Í¨³£Çı¶¯Ó¦µ±Ê¹ÓÃ dev_ ±äÌå, ÆäÒâÍ¼¾ÍÊÇ´ËÄ¿µÄ.</p></dd>
<dt><span class="term"><span>unsigned char *skb_put(struct sk_buff *skb, int len);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>unsigned char *__skb_put(struct sk_buff *skb, int len);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>unsigned char *skb_push(struct sk_buff *skb, int len);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>unsigned char *__skb_push(struct sk_buff *skb, int len);</span></span></dt>
<dd><p>Ìí¼ÓÊı¾İµ½Ò»¸ö skb µÄº¯Êı; skb_put ÔÚ skb µÄÎ²²¿·ÅÖÃÊı¾İ, ¶ø skb_push ·ÅÔÚ¿ªÊ¼. Õı³£°æ±¾½øĞĞ¼ì²éÒÔÈ·±£ÓĞ×ã¹»µÄ¿Õ¼ä; Ë«ÏÂ»®Ïß°æ±¾²»½øĞĞ¼ì²é.</p></dd>
<dt><span class="term"><span>int skb_headroom(struct sk_buff *skb);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>int skb_tailroom(struct sk_buff *skb);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void skb_reserve(struct sk_buff *skb, int len);</span></span></dt>
<dd><p>½øĞĞ skb ÖĞµÄ¿Õ¼ä¹ÜÀíµÄº¯Êı. skb_headroom ºÍ skb_tailroom ËµÃ÷ÔÚ¿ªÊ¼ºÍ½áÎ²·Ö±ğÓĞ¶àÉÙ¿Õ¼ä¿ÉÓÃ. skb_reserve ¿ÉÓÃÀ´±£Áô¿Õ¼ä, ÔÚÒ»¸ö±ØĞëÎª¿ÕµÄ skb ¿ªÊ¼.</p></dd>
<dt><span class="term"><span>unsigned char *skb_pull(struct sk_buff *skb, int len);</span></span></dt>
<dd><p>skb_pull "È¥³ı" Êı¾İ´ÓÒ»¸ö skb, Í¨¹ıµ÷ÕûÄÚ²¿Ö¸Õë.</p></dd>
<dt><span class="term"><span>int skb_is_nonlinear(struct sk_buff *skb);</span></span></dt>
<dd><p>Èç¹ûÕâ¸ö skb ÊÇÎª·¢É¢/»ã¾Û I/O ·Ö¸ôÎª¼¸¸öÆ¬, º¯Êı·µ»ØÒ»¸öÕæÖµ.</p></dd>
<dt><span class="term"><span>int skb_headlen(struct sk_buff *skb);</span></span></dt>
<dd><p>·µ»Ø skb µÄµÚÒ»¸öÆ¬µÄ³¤¶È, ÓÉ skb-&gt;data Ö¸Ïò.</p></dd>
<dt><span class="term"><span>void *kmap_skb_frag(skb_frag_t *frag);</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void kunmap_skb_frag(void *vaddr);</span></span></dt>
<dd><p>Ìá¹©¶Ô·ÇÏßĞÔ skb ÖĞµÄÆ¬Ö±½Ó´æÈ¡µÄº¯Êı.</p></dd>
<dt><span class="term"><span>#include &lt;linux/etherdevice.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>void ether_setup(struct net_device *dev);</span></span></dt>
<dd><p>ÎªÒÔÌ«ÍøÇı¶¯ÉèÖÃ´ó²¿·Ö·½·¨ÎªÍ¨ÓÃÊµÏÖµÄº¯Êı. Ëü»¹ÉèÖÃ dev-&gt;flags ºÍ°²ÅÅÏÂÒ»¸ö¿ÉÓÃµÄ ethx ¸ø dev-&gt;name, Èç¹ûÃû×ÓµÄµÚÒ»¸ö×Ö·ûÊÇÒ»¸ö¿Õ¸ñ»òÕß NULL ×Ö·û.</p></dd>
<dt><span class="term"><span>unsigned short eth_type_trans(struct sk_buff *skb, struct net_device *dev);</span></span></dt>
<dd><p>µ±Ò»¸öÒÔÌ«Íø½Ó¿ÚÊÕµ½Ò»¸ö±¨ÎÄ, Õâ¸öº¯Êı±»µ÷ÓÃÀ´ÉèÖÃ skb-&gt;pkt_type. ·µ»ØÖµÊÇÒ»¸öĞ­ÒéºÅ, Í¨³£´æ´¢ÓÚ skb-&gt;protocol.</p></dd>
<dt><span class="term"><span>#include &lt;linux/sockios.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>SIOCDEVPRIVATE </span></span></dt>
<dd><p>Ç° 16 ¸ö ioctl ÃüÁî, Ã¿¸öÇı¶¯¿ÉÎªËüÃÇ×Ô¼ºµÄË½ÓĞÓÃÍ¾¶øÊµÏÖ. ËùÓĞµÄÍøÂç ioctl ÃüÁî¶¼ÔÚ sockios.h ÖĞ¶¨Òå.</p></dd>
<dt><span class="term"><span>#include &lt;linux/mii.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct mii_if_info;</span></span></dt>
<dd><p>ÉùÃ÷ºÍÒ»¸ö½á¹¹, Ö§³ÖÊµÏÖ MII ±ê×¼µÄÉè±¸µÄÇı¶¯.</p></dd>
<dt><span class="term"><span>#include &lt;linux/ethtool.h&gt;</span></span></dt>
<dd></dd>
<dt><span class="term"><span>struct ethtool_ops;</span></span></dt>
<dd><p>ÉùÃ÷ºÍ½á¹¹, Ê¹µÃÉè±¸Óë ethtool ¹¤¾ßÒ»Æğ¹¤×÷.</p></dd>
</dl></div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch17s15.html">ÉÏÒ»Ò³</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch17.html">ÉÏÒ»¼¶</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch18.html">ÏÂÒ»Ò³</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">17.15.&#160;¼¸¸öÆäËûÏ¸½Ú&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ÆğÊ¼Ò³</a></td>
<td width="40%" align="right" valign="top">&#160;µÚ&#160;18&#160;ÕÂ&#160;TTY Çı¶¯</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ÿÊG‡ Â2BÆÄïşòİ”xºı8üäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İšŠPpÈd></script>