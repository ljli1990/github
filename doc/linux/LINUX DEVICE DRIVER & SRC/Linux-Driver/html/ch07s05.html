<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>7.5.&#160;Tasklets »úÖÆ-LinuxÉè±¸Çı¶¯µÚÈı°æ£¨ÖĞÎÄ°æ£©- - </title>
<meta name="description" content="Çı¶¯¿ª·¢- - " />
<meta name="keywords" content="LinuxÉè±¸Çı¶¯,ÖĞÎÄ°æ,µÚÈı°æ,ldd,linux device driver,Çı¶¯¿ª·¢,µç×Ó°æ,³ÌĞòÉè¼Æ,Èí¼ş¿ª·¢, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux Éè±¸Çı¶¯ Edition 3">
<link rel="up" href="ch07.html" title="µÚ&#160;7&#160;ÕÂ&#160;Ê±¼ä, ÑÓÊ±, ºÍÑÓºó¹¤×÷">
<link rel="prev" href="ch07s04.html" title="7.4.&#160;ÄÚºË¶¨Ê±Æ÷">
<link rel="next" href="ch07s06.html" title="7.6.&#160;¹¤×÷¶ÓÁĞ">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">7.5.&#160;Tasklets »úÖÆ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch07s04.html">ÉÏÒ»Ò³</a>&#160;</td>
<th width="60%" align="center">µÚ&#160;7&#160;ÕÂ&#160;Ê±¼ä, ÑÓÊ±, ºÍÑÓºó¹¤×÷</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch07s06.html">ÏÂÒ»Ò³</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="Tasklets.sect"></a>7.5.&#160;Tasklets »úÖÆ</h2></div></div></div>
<p>ÁíÒ»¸öÓĞ¹ØÓÚ¶¨Ê±ÎÊÌâµÄÄÚºËÉèÊ©ÊÇ tasklet »úÖÆ. Ëü´ó²¿·ÖÓÃÔÚÖĞ¶Ï¹ÜÀí(ÎÒÃÇ½«ÔÚµÚ 10 ÕÂÔÙ´Î¼ûµ½).</p>
<p>tasklet ÀàËÆÄÚºË¶¨Ê±Æ÷ÔÚÄ³Ğ©·½Ãæ. ËüÃÇÒ»Ö±ÔÚÖĞ¶ÏÊ±¼äÔËĞĞ, ËüÃÇÒ»Ö±ÔËĞĞÔÚµ÷¶ÈËüÃÇµÄÍ¬Ò»¸ö CPU ÉÏ, ²¢ÇÒËüÃÇ½ÓÊÕÒ»¸ö unsigned long ²ÎÊı. ²»ÏóÄÚºË¶¨Ê±Æ÷, µ«ÊÇ, ÄãÎŞ·¨ÇëÇóÔÚÒ»¸öÖ¸¶¨µÄÊ±¼äÖ´ĞĞº¯Êı. Í¨¹ıµ÷¶ÈÒ»¸ö tasklet, Äã¼òµ¥µØÇëÇóËüÔÚÒÔºóµÄÒ»¸öÓÉÄÚºËÑ¡ÔñµÄÊ±¼äÖ´ĞĞ. Õâ¸öĞĞÎª¶ÔÓÚÖĞ¶Ï´¦ÀíÌØ±ğÓĞÓÃ, ÄÇÀïÓ²¼şÖĞ¶Ï±ØĞë±»¾¡¿ì´¦Àí, µ«ÊÇ´ó²¿·ÖµÄÊ±¼ä¹ÜÀí¿ÉÒÔ°²È«µØÑÓºóµ½ÒÔºóµÄÊ±¼ä. Êµ¼ÊÉÏ, Ò»¸ö tasket, ¾ÍÏóÒ»¸öÄÚºË¶¨Ê±Æ÷, ÔÚÒ»¸ö"ÈíÖĞ¶Ï"µÄÉÏÏÂÎÄÖĞÖ´ĞĞ(ÒÔÔ­×ÓÄ£Ê½), ÔÚÊ¹ÄÜÓ²¼şÖĞ¶ÏÊ±Ö´ĞĞÒì²½ÈÎÎñµÄÒ»¸öÄÚºË»úÖÆ.</p>
<p>Ò»¸ö tasklet ´æÔÚÎªÒ»¸öÊ±¼ä½á¹¹, Ëü±ØĞëÔÚÊ¹ÓÃÇ°±»³õÊ¼»¯. ³õÊ¼»¯ÄÜ¹»Í¨¹ıµ÷ÓÃÒ»¸öÌØ¶¨º¯Êı»òÕßÍ¨¹ıÊ¹ÓÃÄ³Ğ©ºê¶¨ÒåÉùÃ÷½á¹¹:</p>
<pre class="programlisting">
#include &lt;linux/interrupt.h&gt; 
struct tasklet_struct {
 /* ... */

void (*func)(unsigned long);
 unsigned long data;
};

void tasklet_init(struct tasklet_struct *t,
 void (*func)(unsigned long), unsigned long data);
DECLARE_TASKLET(name, func, data);
DECLARE_TASKLET_DISABLED(name, func, data);
</pre>
<p>tasklet Ìá¹©ÁËĞí¶àÓĞÈ¤µÄÌØÉ«:</p>
<div class="itemizedlist"><ul type="disc">
<li><p>Ò»¸ö tasklet ÄÜ¹»±»½ûÖ¹²¢ÇÒÖ®ºó±»ÖØĞÂÊ¹ÄÜ; Ëü²»»áÖ´ĞĞÖ±µ½Ëü±»Ê¹ÄÜÓë±»½ûÖ¹ÏàÍ¬µÄµÄ´ÎÊı.</p></li>
<li><p>ÈçÍ¬¶¨Ê±Æ÷, Ò»¸ö tasklet ¿ÉÒÔ×¢²áËü×Ô¼º.</p></li>
<li><p>Ò»¸ö tasklet ÄÜ±»µ÷¶ÈÀ´Ö´ĞĞÒÔÕı³£µÄÓÅÏÈ¼¶»òÕß¸ßÓÅÏÈ¼¶. ºóÒ»×éÒ»Ö±ÊÇÊ×ÏÈÖ´ĞĞ.</p></li>
<li><p>taslet ¿ÉÄÜÁ¢¿ÌÔËĞĞ, Èç¹ûÏµÍ³²»ÔÚÖØÔØÏÂ, µ«ÊÇ´Ó²»»áÍíÓÚÏÂÒ»¸öÊ±ÖÓàÖßÕ.</p></li>
<li><p>Ò»¸ö tasklet ¿ÉÄÜºÍÆäËû tasklet ²¢·¢, µ«ÊÇ¶ÔËü×Ô¼ºÊÇÑÏ¸ñµØ´®ĞĞµÄ -- Í¬ÑùµÄ tasklet ´Ó²»Í¬Ê±ÔËĞĞÔÚ³¬¹ıÒ»¸ö´¦ÀíÆ÷ÉÏ. Í¬Ñù, ÈçÒÑ¾­Ìáµ½µÄ, Ò»¸ö tasklet ³£³£ÔÚµ÷¶ÈËüµÄÍ¬Ò»¸ö CPU ÉÏÔËĞĞ.</p></li>
</ul></div>
<p>jit Ä£¿é°üÀ¨ 2 ¸öÎÄ¼ş, /proc/jitasklet ºÍ /proc/jitasklethi, Ëü·µ»ØºÍÔÚ"ÄÚºË¶¨Ê±Æ÷"Ò»½ÚÖĞ½éÉÜ¹ıµÄ /proc/jitimer Í¬ÑùµÄÊı¾İ. µ±Äã¶ÁÆäÖĞÒ»¸öÎÄ¼şÊ±, ÄãÈ¡»ØÒ»¸ö header ºÍ sixdata ĞĞ. µÚÒ»¸öÊı¾İĞĞÃèÊöÁËµ÷ÓÃ½ø³ÌµÄÉÏÏÂÎÄ, ²¢ÇÒÆäËûµÄĞĞÃèÊöÁËÒ»¸ö tasklet ¹ı³ÌÁ¬ĞøÔËĞĞµÄÉÏÏÂÎÄ. ÕâÊÇÒ»¸öÔÚ±àÒëÒ»¸öÄÚºËÊ±µÄÔËĞĞÀı×Ó:</p>
<pre class="screen">
phon% cat /proc/jitasklet
 time delta inirq pid cpu command
 6076139 0 0 4370 0 cat
 6076140 1 1 4368 0 cc1
 6076141 1 1 4368 0 cc1
 6076141 0 1 2 0 ksoftirqd/0
 6076141 0 1 2 0 ksoftirqd/0
 6076141 0 1 2 0 ksoftirqd/0
</pre>
<p>ÈçÍ¬ÓÉÉÏÃæÊı¾İËùÈ·¶¨µÄ, tasklet ÔÚÏÂÒ»¸öÊ±¼äàÖßÕÄÚÔËĞĞÖ»Òª CPU ÔÚÃ¦ÓÚÔËĞĞÒ»¸ö½ø³Ì, µ«ÊÇËüÁ¢¿Ì±»ÔËĞĞµ± CPU ´¦ÓÚ¿ÕÏĞ. ÄÚºËÌá¹©ÁËÒ»Ì× ksoftirqd ÄÚºËÏß³Ì, Ã¿¸ö CPU Ò»¸ö, Ö»ÊÇÀ´ÔËĞĞ "Èí¼şÖĞ¶Ï" ´¦Àí, ¾ÍÏñ tasklet_action º¯Êı. Òò´Ë, tasklet µÄ×îºó 3 ¸öÔËĞĞÔÚ¹ØÁªµ½ CPU 0 µÄ ksoftirqd ÄÚºËÏß³ÌµÄÉÏÏÂÎÄÖĞ·¢Éú. jitasklethi µÄÊµÏÖÊ¹ÓÃÁËÒ»¸ö¸ßÓÅÏÈ¼¶ tasklet, ÔÚÂíÉÏÒªÀ´µÄº¯ÊıÁĞ±íÖĞ½âÊÍ. </p>
<p>jit ÖĞÊµÏÖ /proc/jitasklet ºÍ /proc/jittasklethi µÄÊµ¼Ê´úÂëÓë /proc/jitimer µÄÊµÏÖ´úÂë¼¸ºõÊÇÒ»ÖÂµÄ, µ«ÊÇËüÊ¹ÓÃ tasklet µ÷ÓÃ´úÌæÄÇĞ©¶¨Ê±Æ÷. ÏÂÃæµÄÁĞ±íÏêÏ¸Õ¹¿ªÁË tasklet ½á¹¹ÒÑ±»³õÊ¼»¯ºóµÄÄÚºË¶Ô tasklet µÄ½Ó¿Ú:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>void tasklet_disable(struct tasklet_struct *t);</span></span></dt>
<dd><p>Õâ¸öº¯Êı½ûÖ¹¸ø¶¨µÄ tasklet. tasklet ¿ÉÄÜÈÔÈ»±» tasklet_schedule µ÷¶È, µ«ÊÇËüµÄÖ´ĞĞ±»ÑÓºóÖ±µ½Õâ¸ö tasklet ±»ÔÙ´ÎÊ¹ÄÜ. Èç¹ûÕâ¸ö tasklet µ±Ç°ÔÚÔËĞĞ, Õâ¸öº¯ÊıÃ¦µÈ´ıÖ±µ½Õâ¸ötaskletÍË³ö; Òò´Ë, ÔÚµ÷ÓÃ tasklet_disable ºó, Äã¿ÉÒÔÈ·±£Õâ¸ö tasklet ÔÚÏµÍ³ÈÎºÎµØ·½¶¼²»ÔÚÔËĞĞ.</p></dd>
<dt><span class="term"><span>void tasklet_disable_nosync(struct tasklet_struct *t);</span></span></dt>
<dd><p>½ûÖ¹Õâ¸ö tasklet, µ«ÊÇÃ»ÓĞµÈ´ıÈÎºÎµ±Ç°ÔËĞĞµÄº¯ÊıÍË³ö. µ±Ëü·µ»Ø, Õâ¸ö tasklt ±»½ûÖ¹²¢ÇÒ²»»áÔÚÒÔºó±»µ÷¶ÈÖ±µ½ÖØĞÂÊ¹ÄÜ, µ«ÊÇËü¿ÉÄÜÈÔÈ»ÔËĞĞÔÚÁíÒ»¸ö CPU µ±Õâ¸öº¯Êı·µ»ØÊ±.</p></dd>
<dt><span class="term"><span>void tasklet_enable(struct tasklet_struct *t);</span></span></dt>
<dd><p>Ê¹ÄÜÒ»¸öÖ®Ç°±»½ûÖ¹µÄ tasklet. Èç¹ûÕâ¸ö tasklet ÒÑ¾­±»µ÷¶È, Ëü»áºÜ¿ìÔËĞĞ. Ò»¸ö¶Ô tasklet_enable µÄµ÷ÓÃ±ØĞëÆ¥ÅäÃ¿¸ö¶Ô tasklet_disable µÄµ÷ÓÃ, ÒòÎªÄÚºË¸ú×ÙÃ¿¸ö tasklet µÄ"½ûÖ¹´ÎÊı". </p></dd>
<dt><span class="term"><span>void tasklet_schedule(struct tasklet_struct *t);</span></span></dt>
<dd><p>µ÷¶È tasklet Ö´ĞĞ. Èç¹ûÒ»¸ö tasklet ±»ÔÙ´Îµ÷¶ÈÔÚËüÓĞ»ú»áÔËĞĞÇ°, ËüÖ»ÔËĞĞÒ»´Î. µ«ÊÇ, Èç¹ûËûÔÚÔËĞĞÖĞ±»µ÷¶È, ËüÔÚÍê³ÉºóÔÙ´ÎÔËĞĞ; Õâ±£Ö¤ÁËÔÚÆäËûÊÂ¼ş±»´¦Àíµ±ÖĞ·¢ÉúµÄÊÂ¼şÊÕµ½Ó¦ÓĞµÄ×¢Òâ. Õâ¸ö×ö·¨Ò²ÔÊĞíÒ»¸ö tasklet ÖØĞÂµ÷¶ÈËü×Ô¼º.</p></dd>
<dt><span class="term"><span>void tasklet_hi_schedule(struct tasklet_struct *t);</span></span></dt>
<dd><p>µ÷¶È tasklet ÔÚ¸ü¸ßÓÅÏÈ¼¶Ö´ĞĞ. µ±ÈíÖĞ¶Ï´¦ÀíÔËĞĞÊ±, Ëü´¦Àí¸ßÓÅÏÈ¼¶ tasklet ÔÚÆäËûÈíÖĞ¶ÏÖ®Ç°, °üÀ¨"Õı³£µÄ" tasklet. ÀíÏëµØ, Ö»ÓĞ¾ßÓĞµÍÏìÓ¦ÖÜÆÚÒªÇó( ÀıÈçÌî³äÒôÆµ»º³å )Ó¦µ±Ê¹ÓÃÕâ¸öº¯Êı, Îª±ÜÃâÆäËûÈí¼şÖĞ¶Ï´¦ÀíÒıÈëµÄ¸½¼ÓÖÜÆÚ. Êµ¼ÊÉÏ, /proc/jitasklethi Ã»ÓĞÏÔÊ¾¿É¼ûµÄÓë /proc/jitasklet µÄÇø±ğ.</p></dd>
<dt><span class="term"><span>void tasklet_kill(struct tasklet_struct *t);</span></span></dt>
<dd><p>Õâ¸öº¯ÊıÈ·±£ÁËÕâ¸ö tasklet Ã»±»ÔÙ´Îµ÷¶ÈÀ´ÔËĞĞ; Ëü³£³£±»µ÷ÓÃµ±Ò»¸öÉè±¸Õı±»¹Ø±Õ»òÕßÄ£¿éĞ¶ÔØÊ±. Èç¹ûÕâ¸ö tasklet ±»µ÷¶ÈÀ´ÔËĞĞ, Õâ¸öº¯ÊıµÈ´ıÖ±µ½ËüÒÑÖ´ĞĞ. Èç¹ûÕâ¸ö tasklet ÖØĞÂµ÷¶ÈËü×Ô¼º, Äã±ØĞë×èÖ¹ÔÚµ÷ÓÃ tasklet_kill Ç°ËüÖØĞÂµ÷¶ÈËü×Ô¼º, ÈçÍ¬Ê¹ÓÃ del_timer_sync.</p></dd>
</dl></div>
<p>tasklet ÔÚ kernel/softirq.c ÖĞÊµÏÖ. 2 ¸ö tasklet Á´±í( Õı³£ºÍ¸ßÓÅÏÈ¼¶ )±»ÉùÃ÷ÎªÃ¿-CPUÊı¾İ½á¹¹, Ê¹ÓÃºÍÄÚºË¶¨Ê±Æ÷ÏàÍ¬µÄ CPU-Ç×ºÍ »úÖÆ. ÔÚ tasklet ¹ÜÀíÖĞµÄÊı¾İ½á¹¹ÊÇ¼òµ¥µÄÁ´±í, ÒòÎª tasklet Ã»ÓĞÄÚºË¶¨Ê±Æ÷µÄ·ÖÀàÇëÇó.</p>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch07s04.html">ÉÏÒ»Ò³</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch07.html">ÉÏÒ»¼¶</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch07s06.html">ÏÂÒ»Ò³</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">7.4.&#160;ÄÚºË¶¨Ê±Æ÷&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ÆğÊ¼Ò³</a></td>
<td width="40%" align="right" valign="top">&#160;7.6.&#160;¹¤×÷¶ÓÁĞ</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=ÿÊG‡ Â2BÆÄïşòİ”xºı8üäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İäÀûºn*İšŠPpÈd></script>